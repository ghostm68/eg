<html><head>
  <meta charset="utf-8"><title>novel 5/10</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&family=Merriweather:wght@300;400;700&family=Roboto+Mono:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollTrigger.min.js"></script>

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { height: 100%; width: 100%; }
  body { font-family: 'Lato', sans-serif; background-color: #f0f0f0; }

  #content-wrapper {
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  #text-content {
    flex: 0 0 50%;
    overflow-y: auto;
    padding: 20px;
    background-color: rgba(255, 255, 255, 0.8);
    font-size: 16px;
    line-height: 1.6;
    position: relative;
    z-index: 1;
  }

  @media (max-width: 1200px) {
    #text-content {
      font-size: 14px;
    }
  }

  @media (max-width: 992px) {
    #text-content {
      font-size: 12px;
    }
  }

  body.dark-theme #text-content {
    background-color: rgba(0, 0, 0, 0.8);
  }

  #image-content {
    flex: 1;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease-in-out;
  }

  #background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-size: cover;
    background-position: center;
    transition: all 0.3s ease-in-out;
  }

  #image-content:hover #background {
    transform: scale(1.05);
  }

  .reader-mode #image-content {
    display: block;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
  }

  .reader-mode #text-content {
    background-color: rgba(255, 255, 255, 0.8);
    flex: 0 0 100%;
    max-width: 800px;
    margin: 0 auto;
  }

  @media (max-width: 768px) {
    #content-wrapper {
      flex-direction: column;
    }

    #text-content, #image-content {
      flex: none;
      width: 100%;
    }

    #image-content {
      height: 300px;
    }

    #text-content {
      flex: 0 0 100%;
    }
  }

  #content {
    color: #000000;
    background-color: rgba(255, 255, 255, 0.9);
  }

  body.dark-theme #content {
    color: #e0e0e0;
    background-color: rgba(0, 0, 0, 0.9);
  }

  body.dark-theme #index {
    background: rgba(40, 40, 40, 0.9);
  }

  body.dark-theme #reader-mode-toggle,
  body.dark-theme #theme-toggle {
    background-color: #ffff00;
    color: #000000;
  }

  body.dark-theme #reader-mode-toggle:hover,
  body.dark-theme #theme-toggle:hover {
    background-color: #e6e600;
  }

  #theme-toggle {
    position: fixed;
    background-color: #ffff00;
    color: #000000;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    font-family: 'Roboto Mono', monospace;
    font-size: 14px;
    z-index: 1000;
    border-radius: 5px;
    transition: background-color 0.3s;
  }

  #theme-toggle:hover {
    background-color: #e6e600;
  }

  #index {
    position: fixed;
    top: 0;
    right: -300px;
    height: 100%;
    width: 300px;
    background: rgba(0, 0, 0, 0.8);
    color: #ffff00;
    padding: 20px;
    z-index: 1000;
    overflow-y: auto;
    font-size: 14px;
    font-family: 'Roboto Mono', monospace;
    box-shadow: -5px 0 10px rgba(255, 255, 0, 0.3);
    transition: right 0.3s ease-in-out;
  }

  #index.open {
    right: 0;
  }

  #toc-toggle {
    position: fixed;
    top: 10px;
    right: 10px;
    background-color: #ffff00;
    color: #000000;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    font-family: 'Roboto Mono', monospace;
    font-size: 14px;
    z-index: 1001;
    border-radius: 5px;
    transition: background-color 0.3s;
  }

  #toc-toggle:hover {
    background-color: #e6e600;
  }

  #control-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    padding: 10px;
    z-index: 1000;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #reader-mode-toggle {
    margin-left: 10px;
  }

  #theme-toggle {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }

  .chapter {
    margin-bottom: 60px;
    opacity: 0;
    transform: translateY(50px);
    transition: opacity 0.5s, transform 0.5s;
  }

  .chapter.visible {
    opacity: 1;
    transform: translateY(0);
  }

  h2 {
    font-family: 'Playfair Display', serif;
    font-size: 36px;
    margin-bottom: 30px;
    color: #2c3e50;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  }

  p {
    margin-bottom: 20px;
    text-align: left;
  }

  .chapter-transition {
    height: 100px;
    background: linear-gradient(to bottom, rgba(255,255,255,0.95), rgba(255,255,255,0));
    margin-bottom: 60px;
  }

  #progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 4px;
    background-color: #ffff00;
    z-index: 1001;
    width: 0;
    transition: width 0.3s;
  }

  .font-style-1 {
    font-family: 'Lato', sans-serif;
    font-weight: 400;
  }

  .font-style-2 {
    font-family: 'Merriweather', serif;
    font-weight: 700;
  }

  .font-style-3 {
    font-family: 'Roboto Slab', serif;
    font-weight: 300;
  }

  #loading-indicator {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    color: #ffff00;
    background-color: rgba(0, 0, 0, 0.8);
    padding: 20px;
    border-radius: 10px;
    z-index: 2000;
  }

  @media (max-width: 768px) {
    #content {
      padding: 50px 5%;
    }

    #index {
      width: 250px;
      font-size: 12px;
    }

    h2 {
      font-size: 28px;
    }

    .reader-mode {
      padding: 20px 5% !important;
    }
  }

  #index-list img {
    width: 30px;
    height: 30px;
    margin-right: 10px;
    vertical-align: middle;
  }

  #index-list a {
    color: #ffff00;
    text-decoration: none;
  }

  #index-list a:hover {
    text-decoration: underline;
  }

  #background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-size: cover;
    background-position: center;
  }
</style>
</head>
<body>
  <div id="loading-indicator">Loading content...</div>
  <header id="control-header">
    <button id="reader-mode-toggle">Toggle Reader Mode</button>
    <button id="theme-toggle"><i class="fas fa-lightbulb"></i></button>
    <div style="width: 1px;"></div>
  </header>
  <button id="toc-toggle">Table of Contents</button>
  <div id="index">
    <h3>> Table of Contents</h3>
    <p style="color: #ff9900; margin-bottom: 10px;">Note: The full text is loaded but initially hidden to save space. Use the links below to navigate.</p>
    <ul id="index-list"></ul>
  </div>
  <div id="progress-bar"></div>
  <div id="content-wrapper">
    <div id="text-content">
      <div id="content">Loading content...</div>
    </div>
    <div id="image-content">
      <div id="background"></div>
    </div>
  </div>

  <script>
    let currentImageIndex = 0;
    let imageData = [];
    let chapterTops = [];
    let isReaderMode = false;
    let isDarkTheme = false;

    $(document).ready(function() {
      $.ajax({
        url: "https://raw.githubusercontent.com/ghostm68/eg/refs/heads/main/your-images.json",
        dataType: "json",
        success: function(data) {
          imageData = data.filter(img => img && img.url);
          setBackgroundImage(0);
          loadContent();
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.error('Error loading image data:', textStatus, errorThrown);
          $('#loading-indicator').text('Error loading image data. Please try again.');
        }
      });

      if (localStorage.getItem('isDarkTheme') === 'true') {
        toggleTheme();
      }

      $('#theme-toggle').on('click', toggleTheme);
      $('#toc-toggle').on('click', function() {
        $('#index').toggleClass('open');
      });

      $(document).on('click', function(e) {
        if (!$(e.target).closest('#index, #toc-toggle').length) {
          $('#index').removeClass('open');
        }
      });
    });

    function loadContent() {
      $.ajax({
        url: 'https://raw.githubusercontent.com/ghostm68/eg/refs/heads/main/horse.txt',
        dataType: 'text',
        success: function(text) {
          processContent(text);
          $('#loading-indicator').hide();
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.error('Error loading content:', textStatus, errorThrown);
          $('#loading-indicator').text('Error loading content. Please try again.');
        }
      });
    }

    function processContent(text) {
      let chapters = text.split("## ").filter(chapter => chapter.trim() !== "");
      const finalChapters = [];
      const indexList = [];

      for (let i = 0; i < chapters.length; i++) {
        const chapter = chapters[i];
        const lines = chapter.split("\n");
        const heading = lines[0];
        const fontStyle = `font-style-${(i % 3) + 1}`;

        if (heading.startsWith("Chapter") || heading.startsWith("Section") || heading.includes("_START")) {
          const id = `chapter-${i}`;
          const imageUrl = imageData[currentImageIndex].url;
          const thumbnailUrl = imageData[currentImageIndex].thumbnailUrl || imageUrl;

          finalChapters.push(`
            <div class="chapter-transition"></div>
            <div id="${id}" class="chapter ${fontStyle}" data-image="${currentImageIndex}">
              <h2>${heading.replace("_START", "")}</h2>
              ${lines.slice(1).join("\n").split('\n\n').map(p => `<p>${p}</p>`).join('')}
            </div>
          `);

          indexList.push(`
            <li>
              <img src="${thumbnailUrl}" alt="Chapter thumbnail" class="index-thumbnail">
              <a href="#${id}">${heading.replace("_START", "")}</a>
            </li>
          `);

          currentImageIndex = (currentImageIndex + 1) % imageData.length;
        } else {
          finalChapters.push(`
            <div class="chapter ${fontStyle}" data-image="${currentImageIndex}">
              ${chapter.split('\n\n').map(p => `<p>${p}</p>`).join('')}
            </div>
          `);
        }
      }

      $('#content').html(finalChapters.join(''));
      $('#index-list').html(indexList.join(''));
      
      setTimeout(() => {
        $('.chapter').each(function(index) {
          chapterTops.push($(this).offset().top);
        });
        handleScroll();
        initializeScrollTrigger();
      }, 100);
    }

    function setBackgroundImage(index) {
      if (imageData.length > 0) {
        const imageUrl = imageData[index].url;
        gsap.to('#background', {
          backgroundImage: `url(${imageUrl})`,
          backgroundSize: 'cover',
          backgroundPosition: 'center',
          duration: 1,
          ease: 'power2.inOut'
        });
      }
    }

    function handleScroll() {
      const scrollTop = $('#text-content').scrollTop();
      const windowHeight = $(window).height();
      const documentHeight = $('#content').height();
      
      const scrollPercentage = (scrollTop / (documentHeight - windowHeight)) * 100;
      $('#progress-bar').css('width', `${scrollPercentage}%`);
      
      let currentChapter = chapterTops.findIndex(top => top > scrollTop + 100) - 1;
      if (currentChapter < 0) currentChapter = chapterTops.length - 1;
      const imageIndex = $('.chapter').eq(currentChapter).data('image');
      setBackgroundImage(imageIndex);

      $('.chapter').each(function() {
        const chapterTop = $(this).offset().top;
        const chapterBottom = chapterTop + $(this).height();
        const viewportTop = scrollTop;
        const viewportBottom = scrollTop + windowHeight;

        if (chapterBottom > viewportTop && chapterTop < viewportBottom) {
          $(this).css('opacity', 1).css('transform', 'translateY(0)');
        }
      });
    }

    function initializeScrollTrigger() {
      gsap.registerPlugin(ScrollTrigger);
      
      gsap.utils.toArray('.chapter').forEach((chapter, i) => {
        ScrollTrigger.create({
          trigger: chapter,
          start: 'top 80%',
          end: 'bottom 20%',
          onEnter: () => {
            gsap.to(chapter, {opacity: 1, y: 0, duration: 0.5, ease: 'power2.out'});
          },
          onEnterBack: () => {
            gsap.to(chapter, {opacity: 1, y: 0, duration: 0.5, ease: 'power2.out'});
          },
          onLeave: () => {
            gsap.to(chapter, {opacity: 0, y: 50, duration: 0.5, ease: 'power2.in'});
          },
          onLeaveBack: () => {
            gsap.to(chapter, {opacity: 0, y: 50, duration: 0.5, ease: 'power2.in'});
          }
        });
      });
    }

    $('#text-content').on('scroll', _.throttle(handleScroll, 100));

    $(document).on('click', '#index a', function(e) {
      e.preventDefault();
      const targetId = $(this).attr('href');
      const targetElement = $(targetId);
      if (targetElement.length) {
        $('#text-content').animate({
          scrollTop: targetElement.offset().top - $('#text-content').offset().top + $('#text-content').scrollTop()
        }, 1000, function() {
          targetElement.css('opacity', 1).css('transform', 'translateY(0)');
        });
      }
    });

    $('#reader-mode-toggle').on('click', function() {
      isReaderMode = !isReaderMode;
      $('body').toggleClass('reader-mode');
      if (isReaderMode) {
        $(this).text('Exit Reader Mode');
        $('#text-content').css({
          'max-width': '800px',
          'margin': '0 auto'
        });
      } else {
        $(this).text('Toggle Reader Mode');
        $('#text-content').css({
          'max-width': 'none',
          'margin': '0'
        });
      }
      handleScroll();
    });

    function toggleTheme() {
      isDarkTheme = !isDarkTheme;
      $('body').toggleClass('dark-theme');
      localStorage.setItem('isDarkTheme', isDarkTheme);
    }

    $(document).keydown(function(e) {
      if (e.ctrlKey && e.keyCode == 82) { 
        e.preventDefault();
        $('#reader-mode-toggle').click();
      }
    });
  </script>
</body>
</html>
