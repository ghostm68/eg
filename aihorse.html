<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI RIDER - A Horse Struck Down By Lightning</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://js.puter.com/v2/"></script>
 <style>
    /* Theme Setup: Wordstar Red / Black / White / Grey */
    body { 
      font-family: 'Courier New', monospace; 
      background-color: #000000; /* Pitch Black */
      color: #e0e0e0; /* Off-White/Light Grey for text */
    }

    /* Custom Scrollbar */
    .custom-scrollbar::-webkit-scrollbar { 
      width: 8px; 
    }
    
    .custom-scrollbar::-webkit-scrollbar-track { 
      background: #111111; /* Dark Grey Track */
      border-left: 1px solid #333333; /* Mechanical border */
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb { 
      background-color: #666666; /* Industrial Grey Handle */
      border: 1px solid #000000; 
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { 
      background-color: #ff0000; /* Bright Red on Interaction */
    }

    /* Selection Highlighting */
    ::selection { 
      background: #ff0000; /* Red Background */
      color: #ffffff;      /* White Text */
    }
    
    /* Form Elements */
    select, textarea, input { 
      color-scheme: dark; 
      background-color: #1a1a1a;
      color: #fff;
      border-color: #333;
    }

    /* Animation for loading/processing */
    @keyframes pulse-red {
      0%, 100% { opacity: 1; color: #ff0000; }
      50% { opacity: 0.5; color: #800000; }
    }
    
    .animate-pulse-red {
      animation: pulse-red 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
</style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            theme: {
              dark: '#1a120b',
              panel: '#271c19',
              tan: '#d6c0b3',
              gold: '#fbbf24',
              brown: '#78350f',
              border: '#4a3b32'
            }
          }
        }
      }
    }
  </script>
</head>
<body class="p-4 h-screen flex flex-col items-center justify-center">
  <div class="w-full max-w-3xl">
    
    <!-- AI Assistant Card -->
    <div class="bg-theme-panel border border-theme-border rounded-lg p-4 shadow-2xl shadow-black/50">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-theme-gold tracking-widest flex items-center gap-2">
            <span>‚ö°</span> AI RIDER
        </h3>
        <span id="statusBadge" class="text-[10px] text-theme-tan opacity-50 uppercase tracking-widest border border-theme-border px-2 py-1 rounded">
          Initializing...
        </span>
      </div>
      
      <!-- Model Selection -->
      <div class="mb-4">
        <label class="block text-[10px] uppercase tracking-widest text-theme-gold mb-2 opacity-80">Transmission Channel (Model):</label>
        <select id="model" class="w-full p-2 bg-[#120c06] border border-theme-border rounded text-xs text-theme-tan focus:border-theme-gold focus:outline-none focus:ring-1 focus:ring-theme-gold transition-all cursor-pointer">
            
            <!-- TOP PICKS -->
            <optgroup label="üèÜ TOP PICKS">
                <option value="deepseek-chat" selected>DeepSeek Chat V3 (Best Free) üèÜ</option>
                <option value="openrouter/anthropic/claude-sonnet-4-20250514">Claude Sonnet 4 (Best Overall) üëë</option>
                <option value="deepseek-reasoner">DeepSeek R1 (Deep Analysis) üß†</option>
                <option value="google/gemma-3-12b-it:free">Gemma 3 12B (Solid Free) ‚ú®</option>
            </optgroup>

            <!-- GPT 5 SERIES -->
            <optgroup label="üî• GPT-5 SERIES (Latest 2025)">
                <option value="gpt-5.2-pro">GPT-5.2 Pro (Maximum Quality) üíé</option>
                <option value="gpt-5.2">GPT-5.2 (Deep Reasoning) üß†</option>
                <option value="gpt-5.2-chat">GPT-5.2 Chat (Fast & Conversational) ‚ö°</option>
            </optgroup>

            <!-- LIQUID AI -->
            <optgroup label="üíß LIQUID AI (Next-Gen Architecture)">
                <option value="liquid/lfm-40b">LFM 40B (Flagship) üåä</option>
                <option value="liquid/lfm-40b:free">LFM 40B (Free Tier)</option>
                <option value="liquid/lfm-7b">LFM 7B (Efficient)</option>
                <option value="liquid/lfm-3b">LFM 3B (Compact)</option>
            </optgroup>

            <!-- RELIABLE -->
            <optgroup label="üü¢ RELIABLE (Tested & Working)">
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Baseline)</option>
                <option value="google/gemma-2-9b-it:free">Gemma 2 9B (Free)</option>
                <option value="google/gemma-3-4b-it:free">Gemma 3 4B (Free)</option>
            </optgroup>

            <!-- PREMIUM OPENROUTER -->
            <optgroup label="üîµ PREMIUM (OpenRouter)">
                <option value="openrouter/openai/gpt-4o">GPT-4o (Dec 2024)</option>
                <option value="openrouter/openai/o1">OpenAI o1 (Reasoning)</option>
                <option value="openrouter/anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                <option value="openrouter/google/gemini-2.0-flash-exp:free">Gemini 2.0 Flash (Free)</option>
                <option value="openrouter/meta-llama/llama-3.1-405b-instruct">Llama 3.1 405B (Massive)</option>
            </optgroup>

            <!-- EXPERIMENTAL -->
            <optgroup label="üü° EXPERIMENTAL">
                <option value="openrouter/xai/grok-beta">Grok Beta (xAI)</option>
                <option value="openrouter/xai/grok-2-1212">Grok 2 (Latest)</option>
                <option value="openrouter/mistralai/mistral-large-2411">Mistral Large (Latest)</option>
            </optgroup>

        </select>
      </div>

      <!-- Context Toggle -->
      <div class="mb-4 bg-[#120c06] p-2 rounded border border-theme-border">
        <div class="flex justify-between items-center mb-2">
            <label class="block text-[10px] uppercase tracking-widest text-theme-gold opacity-80">Context Scope:</label>
            <p id="contextInfo" class="text-[10px] text-theme-tan italic opacity-70">Linking to wordstar.nexus...</p>
        </div>
        <div class="flex gap-2">
          <button class="context-btn flex-1 bg-yellow-700 text-black border border-yellow-600 px-3 py-1 text-xs font-bold hover:bg-theme-gold transition uppercase tracking-wider" data-context="novel">Full Novel</button>
          <button class="context-btn flex-1 bg-[#1a120b] text-gray-500 border border-theme-border px-3 py-1 text-xs hover:text-theme-tan hover:border-theme-tan transition uppercase tracking-wider" data-context="none">No Context</button>
        </div>
      </div>

      <!-- Input -->
      <div class="mb-4">
        <label class="block text-[10px] uppercase tracking-widest text-theme-gold mb-2 opacity-80">Input Query:</label>
        <textarea id="input" class="w-full p-3 bg-[#120c06] border border-theme-border rounded text-sm text-theme-tan focus:border-theme-gold focus:outline-none min-h-[80px] placeholder-gray-700 font-mono" placeholder="Query the manuscript..."></textarea>
      </div>

      <!-- Ask Button -->
      <button id="ask" class="w-full bg-yellow-700 text-black py-3 rounded font-bold hover:bg-theme-gold transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-widest border border-yellow-600 shadow-lg shadow-yellow-900/20">
        Execute Protocol
      </button>

      <!-- Response -->
      <div class="mt-6">
        <label class="block text-[10px] uppercase tracking-widest text-theme-gold mb-2 opacity-80">System Output:</label>
        <div id="response" class="bg-[#120c06] border border-theme-border rounded p-4 text-sm min-h-[120px] max-h-[400px] overflow-y-auto custom-scrollbar whitespace-pre-wrap font-mono leading-relaxed text-gray-400">
          <p class="italic opacity-30">...Waiting for input signal...</p>
        </div>
      </div>
    </div>
    
    <div class="mt-2 text-center text-[10px] text-theme-border uppercase tracking-[0.3em]">
        Terminal Access // GhostM68 // Wordstar.Nexus
    </div>
  </div>

  <script>
    // THE SPECIFIC URL PROVIDED
    const NOVEL_URL = 'https://wordstar.nexus/horse.txt';
    
    let novelText = '';
    let aiContext = 'novel';
    let isLoading = false;

    // Elements
    const modelSelect = document.getElementById('model');
    const input = document.getElementById('input');
    const askBtn = document.getElementById('ask');
    const response = document.getElementById('response');
    const contextInfo = document.getElementById('contextInfo');
    const statusBadge = document.getElementById('statusBadge');

    // Load novel text
    async function loadNovel() {
      try {
        contextInfo.textContent = 'Contacting Wordstar.Nexus...';
        statusBadge.textContent = 'DOWNLOADING';
        statusBadge.classList.add('text-theme-gold', 'animate-pulse');
        
        const res = await fetch(NOVEL_URL);
        if (!res.ok) throw new Error(`HTTP Error: ${res.status}`);
        
        novelText = await res.text();
        
        console.log(`Novel loaded: ${novelText.length} characters`);
        contextInfo.textContent = 'Manuscript loaded & indexed.';
        statusBadge.textContent = 'ONLINE';
        statusBadge.classList.remove('text-theme-gold', 'animate-pulse');
        statusBadge.classList.add('text-green-500');
        
      } catch (error) {
        console.error('Could not load novel:', error);
        contextInfo.innerHTML = 'Error loading file. <span class="text-red-500">Check CORS/Connection.</span>';
        statusBadge.textContent = 'CONNECTION FAILED';
        statusBadge.classList.remove('animate-pulse');
        statusBadge.classList.add('text-red-500');
        
        // Add a manual paste box if fetch fails
        const manualArea = document.createElement('textarea');
        manualArea.placeholder = "Link failed (likely CORS). Paste novel text here to proceed manually...";
        manualArea.className = "w-full p-2 bg-[#120c06] border border-red-900 rounded text-xs text-gray-400 mt-2 min-h-[50px]";
        manualArea.addEventListener('input', (e) => {
            novelText = e.target.value;
            if(novelText.length > 0) {
                contextInfo.textContent = 'Manual text loaded.';
                statusBadge.textContent = 'MANUAL OVERRIDE';
            }
        });
        contextInfo.parentNode.appendChild(manualArea);
      }
    }

    // Build prompt with context
    function buildPrompt(userMessage) {
      if (aiContext === 'novel' && novelText) {
        // We take a larger chunk of the novel for context
        // Most models handle 12k-100k context now, but we'll safeguard at ~15k chars
        const preview = novelText.substring(0, 15000); 
        const truncated = novelText.length > 15000 ? '\n\n[System Note: Novel continues beyond this excerpt...]' : '';
        
        return `You are an AI editor and literary analyst. You are analyzing a novel titled "A Horse Struck Down By Lightning".
        
CONTEXT DATA (EXCERPT):
${preview}${truncated}

---

USER QUERY: ${userMessage}`;
      }
      return userMessage;
    }

    // Call Puter AI
    async function callAI(prompt) {
      const selectedModelText = modelSelect.options[modelSelect.selectedIndex].text;
      response.innerHTML = `<p class="text-theme-gold animate-pulse-gold">>> CONTACTING ${selectedModelText}...\n>> STREAMING DATA...</p>`;
      
      try {
        const result = await puter.ai.chat(prompt, {
          model: modelSelect.value,
          temperature: 0.7,
          max_tokens: 2500
        });
        
        response.innerHTML = `<span class="text-theme-gold block mb-2 border-b border-theme-border pb-1 text-xs">>> TRANSMISSION RECEIVED:</span>${result}`;
      } catch (error) {
        console.error('AI Error:', error);
        let msg = error.message;
        if (msg.includes('rate limit')) msg = 'RATE LIMIT EXCEEDED - STANDBY';
        else if (msg.includes('auth')) msg = 'AUTHENTICATION REQUIRED';
        else if (msg.includes('Network')) msg = 'NETWORK CONNECTION FAILURE';
        response.innerHTML = `<p class="text-red-500 font-bold">>> ERROR: ${msg}</p>`;
      }
    }

    // Event listeners
    askBtn.addEventListener('click', async () => {
      const msg = input.value.trim();
      if (!msg) {
        response.innerHTML = '<p class="text-theme-brown">>> ERROR: NO INPUT DETECTED</p>';
        return;
      }
      if (isLoading) return;
      
      isLoading = true;
      askBtn.disabled = true;
      askBtn.classList.add('opacity-50');
      
      const prompt = buildPrompt(msg);
      await callAI(prompt);
      
      isLoading = false;
      askBtn.disabled = false;
      askBtn.classList.remove('opacity-50');
    });

    // Context switching logic
    document.addEventListener('click', e => {
      if (e.target.classList.contains('context-btn')) {
        document.querySelectorAll('.context-btn').forEach(btn => {
          // Inactive State
          btn.classList.remove('bg-yellow-700', 'text-black', 'border-yellow-600', 'font-bold');
          btn.classList.add('bg-[#1a120b]', 'text-gray-500', 'border-theme-border');
        });
        
        // Active State
        e.target.classList.remove('bg-[#1a120b]', 'text-gray-500', 'border-theme-border');
        e.target.classList.add('bg-yellow-700', 'text-black', 'border-yellow-600', 'font-bold');
        
        aiContext = e.target.dataset.context;
        
        if (aiContext === 'novel') {
             contextInfo.textContent = novelText ? 'Manuscript loaded & indexed.' : 'Waiting for data...';
        } else {
             contextInfo.textContent = 'Context disconnected (Chat Mode).';
        }
      }
    });

    // Enter to submit
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        askBtn.click();
      }
    });

    // Initial Load
    loadNovel();
  </script>
</body>
</html>
