<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI RIDER</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    /* Theme Setup */
    body { 
      font-family: 'Courier New', monospace; 
      background-color: #1a120b; /* Dark Coffee */
      color: #d6c0b3; /* Tan/Beige */
    }

    /* Custom Scrollbar - Amber & Brown */
    .custom-scrollbar::-webkit-scrollbar { width: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #120c06; border-left: 1px solid #3e2723; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #d97706; border: 1px solid #1a120b; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: #fbbf24; }

    /* Selection Color */
    ::selection {
      background: #d97706;
      color: #000;
    }
    
    /* Input Reset */
    select, textarea, input {
        color-scheme: dark;
    }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            theme: {
              dark: '#1a120b',
              panel: '#271c19',
              tan: '#d6c0b3',
              gold: '#fbbf24',
              brown: '#78350f',
              border: '#4a3b32'
            }
          }
        }
      }
    }
  </script>
</head>
<body class="p-4 h-screen flex flex-col items-center justify-center">
  <div class="w-full max-w-3xl">
    
    <!-- AI Assistant Card -->
    <div class="bg-theme-panel border border-theme-border rounded-lg p-4 shadow-2xl shadow-black/50">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-theme-gold tracking-widest flex items-center gap-2">
            <span>‚ö°</span> AI RIDER
        </h3>
        <span class="text-[10px] text-theme-tan opacity-50 uppercase tracking-widest border border-theme-border px-2 py-1 rounded">Horse Struck Down By Lightning</span>
      </div>
      
      <!-- Model Selection -->
      <div class="mb-4">
        <label class="block text-[10px] uppercase tracking-widest text-theme-gold mb-2 opacity-80">Transmission Channel (Model):</label>
        <select id="model" class="w-full p-2 bg-[#120c06] border border-theme-border rounded text-xs text-theme-tan focus:border-theme-gold focus:outline-none focus:ring-1 focus:ring-theme-gold transition-all cursor-pointer">
            
            <!-- TOP PICKS -->
            <optgroup label="üèÜ TOP PICKS">
                <option value="deepseek-chat" selected>DeepSeek Chat V3 (Best Free) üèÜ</option>
                <option value="openrouter/anthropic/claude-sonnet-4-20250514">Claude Sonnet 4 (Best Overall) üëë</option>
                <option value="deepseek-reasoner">DeepSeek R1 (Deep Analysis) üß†</option>
                <option value="google/gemma-3-12b-it:free">Gemma 3 12B (Solid Free) ‚ú®</option>
            </optgroup>

            <!-- GPT 5 SERIES -->
            <optgroup label="üî• GPT-5 SERIES (Latest 2025)">
                <option value="gpt-5.2-pro">GPT-5.2 Pro (Maximum Quality) üíé</option>
                <option value="gpt-5.2">GPT-5.2 (Deep Reasoning) üß†</option>
                <option value="gpt-5.2-chat">GPT-5.2 Chat (Fast & Conversational) ‚ö°</option>
            </optgroup>

            <!-- LIQUID AI -->
            <optgroup label="üíß LIQUID AI (Next-Gen Architecture)">
                <option value="liquid/lfm-40b">LFM 40B (Flagship) üåä</option>
                <option value="liquid/lfm-40b:free">LFM 40B (Free Tier)</option>
                <option value="liquid/lfm-7b">LFM 7B (Efficient)</option>
                <option value="liquid/lfm-3b">LFM 3B (Compact)</option>
            </optgroup>

            <!-- RELIABLE -->
            <optgroup label="üü¢ RELIABLE (Tested & Working)">
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Baseline)</option>
                <option value="google/gemma-2-9b-it:free">Gemma 2 9B (Free)</option>
                <option value="google/gemma-3-4b-it:free">Gemma 3 4B (Free)</option>
            </optgroup>

            <!-- PREMIUM OPENROUTER -->
            <optgroup label="üîµ PREMIUM (OpenRouter)">
                <option value="openrouter/openai/gpt-4o">GPT-4o (Dec 2024)</option>
                <option value="openrouter/openai/o1">OpenAI o1 (Reasoning)</option>
                <option value="openrouter/anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                <option value="openrouter/google/gemini-2.0-flash-exp:free">Gemini 2.0 Flash (Free)</option>
                <option value="openrouter/meta-llama/llama-3.1-405b-instruct">Llama 3.1 405B (Massive)</option>
            </optgroup>

            <!-- EXPERIMENTAL -->
            <optgroup label="üü° EXPERIMENTAL">
                <option value="openrouter/xai/grok-beta">Grok Beta (xAI)</option>
                <option value="openrouter/xai/grok-2-1212">Grok 2 (Latest)</option>
                <option value="openrouter/mistralai/mistral-large-2411">Mistral Large (Latest)</option>
            </optgroup>

        </select>
      </div>

      <!-- Context Toggle -->
      <div class="mb-4 bg-[#120c06] p-2 rounded border border-theme-border">
        <div class="flex justify-between items-center mb-2">
            <label class="block text-[10px] uppercase tracking-widest text-theme-gold opacity-80">Context Scope:</label>
            <p id="contextInfo" class="text-[10px] text-theme-tan italic opacity-70">Linking to full novel text...</p>
        </div>
        <div class="flex gap-2">
          <button class="context-btn flex-1 bg-yellow-700 text-black border border-yellow-600 px-3 py-1 text-xs font-bold hover:bg-theme-gold transition uppercase tracking-wider" data-context="novel">Full Novel</button>
          <button class="context-btn flex-1 bg-[#1a120b] text-gray-500 border border-theme-border px-3 py-1 text-xs hover:text-theme-tan hover:border-theme-tan transition uppercase tracking-wider" data-context="none">No Context</button>
        </div>
      </div>

      <!-- Input -->
      <div class="mb-4">
        <label class="block text-[10px] uppercase tracking-widest text-theme-gold mb-2 opacity-80">Input Query:</label>
        <textarea id="input" class="w-full p-3 bg-[#120c06] border border-theme-border rounded text-sm text-theme-tan focus:border-theme-gold focus:outline-none min-h-[80px] placeholder-gray-700 font-mono" placeholder="Query the manuscript..."></textarea>
      </div>

      <!-- Ask Button -->
      <button id="ask" class="w-full bg-yellow-700 text-black py-3 rounded font-bold hover:bg-theme-gold transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-widest border border-yellow-600 shadow-lg shadow-yellow-900/20">
        Execute Protocol
      </button>

      <!-- Response -->
      <div class="mt-6">
        <label class="block text-[10px] uppercase tracking-widest text-theme-gold mb-2 opacity-80">System Output:</label>
        <div id="response" class="bg-[#120c06] border border-theme-border rounded p-4 text-sm min-h-[120px] max-h-[400px] overflow-y-auto custom-scrollbar whitespace-pre-wrap font-mono leading-relaxed text-gray-400">
          <p class="italic opacity-30">...Waiting for input signal...</p>
        </div>
      </div>
    </div>
    
    <div class="mt-2 text-center text-[10px] text-theme-border uppercase tracking-[0.3em]">
        Terminal Access // GhostM68
    </div>
  </div>

  <script>
    const NOVEL_URL = 'https://raw.githubusercontent.com/ghostm68/literary-works/refs/heads/main/horse/horse.txt';
    
    let novelText = '';
    let aiContext = 'novel';
    let isLoading = false;

    const modelSelect = document.getElementById('model');
    const input = document.getElementById('input');
    const askBtn = document.getElementById('ask');
    const response = document.getElementById('response');
    const contextInfo = document.getElementById('contextInfo');

    // Load novel text
    async function loadNovel() {
      try {
        contextInfo.textContent = 'Downloading manuscript...';
        const res = await fetch(NOVEL_URL);
        novelText = await res.text();
        console.log(`Novel loaded: ${novelText.length} characters`);
        contextInfo.textContent = 'Manuscript loaded & indexed.';
      } catch (error) {
        console.error('Could not load novel:', error);
        contextInfo.textContent = 'Error loading manuscript.';
        contextInfo.classList.add('text-red-500');
      }
    }

    // Build prompt with context
    function buildPrompt(userMessage) {
      if (aiContext === 'novel' && novelText) {
        // Included a bit more context for the larger models
        const preview = novelText.substring(0, 12000);
        const truncated = novelText.length > 12000 ? '\n\n[System Note: Novel continues beyond this excerpt...]' : '';
        return `You are an AI editor analyzing a novel-in-progress titled "A Horse Struck Down By Lightning". 
        
CONTEXT DATA:
${preview}${truncated}

---

USER QUERY: ${userMessage}`;
      }
      return userMessage;
    }

    // Call Puter AI
    async function callAI(prompt) {
      const selectedModelText = modelSelect.options[modelSelect.selectedIndex].text;
      response.innerHTML = `<p class="text-theme-gold animate-pulse">>> CONTACTING ${selectedModelText}...\n>> STREAMING DATA...</p>`;
      
      try {
        const result = await puter.ai.chat(prompt, {
          model: modelSelect.value,
          temperature: 0.7,
          max_tokens: 2500 // Increased for better analysis
        });
        
        response.innerHTML = `<span class="text-theme-gold block mb-2 border-b border-theme-border pb-1 text-xs">>> TRANSMISSION RECEIVED:</span>${result}`;
      } catch (error) {
        console.error('AI Error:', error);
        let msg = error.message;
        if (msg.includes('rate limit')) msg = 'RATE LIMIT EXCEEDED - STANDBY';
        else if (msg.includes('auth')) msg = 'AUTHENTICATION REQUIRED';
        else if (msg.includes('Network')) msg = 'NETWORK CONNECTION FAILURE';
        response.innerHTML = `<p class="text-red-500 font-bold">>> ERROR: ${msg}</p>`;
      }
    }

    // Event listeners
    askBtn.addEventListener('click', async () => {
      const msg = input.value.trim();
      if (!msg) {
        response.innerHTML = '<p class="text-theme-brown">>> ERROR: NO INPUT DETECTED</p>';
        return;
      }
      if (isLoading) return;
      
      isLoading = true;
      askBtn.disabled = true;
      askBtn.classList.add('opacity-50');
      
      const prompt = buildPrompt(msg);
      await callAI(prompt);
      
      isLoading = false;
      askBtn.disabled = false;
      askBtn.classList.remove('opacity-50');
    });

    // Context switching
    document.addEventListener('click', e => {
      if (e.target.classList.contains('context-btn')) {
        document.querySelectorAll('.context-btn').forEach(btn => {
          // Reset to inactive brown style
          btn.classList.remove('bg-yellow-700', 'text-black', 'border-yellow-600', 'font-bold');
          btn.classList.add('bg-[#1a120b]', 'text-gray-500', 'border-theme-border');
        });
        
        // Set active style
        e.target.classList.remove('bg-[#1a120b]', 'text-gray-500', 'border-theme-border');
        e.target.classList.add('bg-yellow-700', 'text-black', 'border-yellow-600', 'font-bold');
        
        aiContext = e.target.dataset.context;
        contextInfo.textContent = aiContext === 'novel' 
          ? 'Manuscript loaded & indexed.'
          : 'Context disconnected.';
      }
    });

    // Enter to submit
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        askBtn.click();
      }
    });

    // Load novel on page load
    loadNovel();
  </script>
</body>
</html>
