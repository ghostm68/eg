<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Atlas</title>
    <style>
        body {
            background: #0a0a0a;
            color: #f0f0f0;
            font-family: 'Georgia', serif;
            text-align: center;
            padding: 2rem;
            margin: 0;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }
        .subtitle {
            font-style: italic;
            color: #aaa;
            margin-bottom: 2rem;
        }
        #art-container {
            margin: 2rem auto;
            min-height: 400px;
        }
        #artwork {
            max-width: 90vw;
            max-height: 60vh;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
            border: 1px solid #333;
        }
        #info {
            margin-top: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.5;
        }
        #title {
            font-weight: bold;
        }
        #artist {
            font-style: italic;
            color: #ccc;
        }
        button {
            margin: 0.5rem;
            padding: 0.8rem 1.5rem;
            background: transparent;
            color: #eee;
            border: 1px solid #555;
            cursor: pointer;
            font-family: 'Georgia', serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #222;
            border-color: #777;
        }
        .api-status {
            margin-top: 2rem;
            font-size: 0.9rem;
            color: #666;
        }
        .loading {
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <h1>INFINITE ATLAS</h1>
    <p class="subtitle">A cartography of the world's art, one chance encounter at a time.</p>

    <div id="art-container">
        <img id="artwork" src="" alt="A discovery from the Infinite Atlas">
        <div id="info">
            <div id="title"></div>
            <div id="artist"></div>
        </div>
    </div>

    <div>
        <button id="newArtButton">Chart a New Course</button>
    </div>

    <div class="api-status">
        Powered by the Cleveland Museum of Art and The Metropolitan Museum of Art
    </div>

    <script>
        const newArtButton = document.getElementById('newArtButton');
        newArtButton.addEventListener('click', fetchRandomArt);

        // Only use the most reliable APIs
        const apiFunctions = [
            fetchClevelandArt,
            fetchMetropolitanArt
        ];

        // Track current API attempts
        let currentAttempts = 0;
        const maxAttempts = 5;

        // SPECIFIC ARTWORK YOU WANTED - Gaspar de Crayer
        const preferredArtworkId = 80313; // This is the Cleveland Museum ID for "The Meeting of Alexander the Great and Diogenes"

        async function fetchRandomArt() {
            console.log("Button clicked! Fetching new art...");
            currentAttempts = 0;
            
            // Disable button during loading
            newArtButton.disabled = true;
            newArtButton.textContent = 'Navigating...';
            document.body.classList.add('loading');
            
            document.getElementById('artwork').src = '';
            document.getElementById('title').innerText = 'Consulting the atlas...';
            document.getElementById('artist').innerText = '';

            await tryAllApis();
        }

        async function tryAllApis() {
            if (currentAttempts >= maxAttempts) {
                showError("The atlas cannot be read. Please try again.");
                return;
            }

            currentAttempts++;
            
            // Shuffle APIs for better distribution
            const shuffledApis = [...apiFunctions].sort(() => Math.random() - 0.5);
            
            for (const apiFunction of shuffledApis) {
                try {
                    await apiFunction();
                    // Success - re-enable button
                    newArtButton.disabled = false;
                    newArtButton.textContent = 'Chart a New Course';
                    document.body.classList.remove('loading');
                    return;
                } catch (error) {
                    console.log(`API ${apiFunction.name} failed:`, error.message);
                    // Continue to next API
                }
            }

            // If all APIs failed, try again with delay
            setTimeout(tryAllApis, 500);
        }

        // 1. Cleveland Museum of Art API - IMPROVED RANDOMNESS
        async function fetchClevelandArt() {
            // 20% chance to show the specific artwork you wanted
            if (Math.random() < 0.2) {
                await fetchSpecificClevelandArtwork(preferredArtworkId);
            } else {
                await fetchRandomClevelandArtwork();
            }
        }

        async function fetchSpecificClevelandArtwork(artworkId) {
            const response = await fetch(`https://openaccess-api.clevelandart.org/api/artworks/${artworkId}/`);
            
            if (!response.ok) throw new Error('Network response was not ok');
            
            const data = await response.json();
            
            if (data.data && data.data.images?.web?.url) {
                const art = data.data;
                
                // Test if image loads
                await testImageLoad(art.images.web.url);
                
                document.getElementById('artwork').src = art.images.web.url;
                document.getElementById('title').innerText = art.title || 'Untitled';
                document.getElementById('artist').innerText = art.creators?.[0]?.description || 'Artist Unknown';
                console.log("Success - Showing specific artwork:", art.title);
            } else {
                throw new Error("Specific artwork not available");
            }
        }

        async function fetchRandomClevelandArtwork() {
            // Better randomness: get multiple artworks and pick one randomly
            const response = await fetch(`https://openaccess-api.clevelandart.org/api/artworks/?has_image=1&limit=50`);
            
            if (!response.ok) throw new Error('Network response was not ok');
            
            const data = await response.json();
            
            if (data.data && data.data.length > 0) {
                // Pick a truly random artwork from the 50 results
                const randomIndex = Math.floor(Math.random() * data.data.length);
                const art = data.data[randomIndex];
                
                if (art.images?.web?.url) {
                    // Test if image loads
                    await testImageLoad(art.images.web.url);
                    
                    document.getElementById('artwork').src = art.images.web.url;
                    document.getElementById('title').innerText = art.title || 'Untitled';
                    document.getElementById('artist').innerText = art.creators?.[0]?.description || 'Artist Unknown';
                    console.log("Success from Cleveland Museum - Random selection");
                } else {
                    throw new Error("No valid image from Cleveland API");
                }
            } else {
                throw new Error("No data from Cleveland API");
            }
        }

        // 2. The Metropolitan Museum of Art API
        async function fetchMetropolitanArt() {
            // Use a curated list of known good object IDs from The Met
            const goodObjectIds = [
                436535, 437329, 437327, 436528, 436101, 437994, 436121, 
                436048, 437430, 436931, 437879, 436944, 436532, 437329,
                459106, 459107, 459108, 436535, 437327, 436528
            ];
            
            const randomObjectId = goodObjectIds[Math.floor(Math.random() * goodObjectIds.length)];
            
            const response = await fetch(`https://collectionapi.metmuseum.org/public/collection/v1/objects/${randomObjectId}`);
            
            if (!response.ok) throw new Error('Network response was not ok');
            
            const art = await response.json();
            
            if (art.primaryImage && art.primaryImage.length > 0) {
                // Test if image loads
                await testImageLoad(art.primaryImage);
                
                document.getElementById('artwork').src = art.primaryImage;
                document.getElementById('title').innerText = art.title || 'Untitled';
                document.getElementById('artist').innerText = art.artistDisplayName || 'Artist Unknown';
                console.log("Success from The Met");
            } else {
                throw new Error("No image available from The Met");
            }
        }

        // Helper function to test if an image loads successfully
        function testImageLoad(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve();
                img.onerror = () => reject(new Error('Image failed to load'));
                img.src = url;
                
                // Timeout after 5 seconds
                setTimeout(() => reject(new Error('Image load timeout')), 5000);
            });
        }

        function showError(message) {
            document.getElementById('title').innerText = message;
            document.getElementById('artist').innerText = '';
            newArtButton.disabled = false;
            newArtButton.textContent = 'Chart a New Course';
            document.body.classList.remove('loading');
        }

        // Begin the journey when the page loads - start with your preferred artwork!
        async function initialize() {
            try {
                await fetchSpecificClevelandArtwork(preferredArtworkId);
            } catch (error) {
                // If specific artwork fails, fall back to random
                console.log("Preferred artwork failed, falling back to random:", error.message);
                fetchRandomArt();
            }
        }

        initialize();
    </script>
</body>
</html>
