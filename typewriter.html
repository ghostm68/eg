<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base href="https://wordstar-online.com/">
    <meta name="viewport" content="width=1024">
    <meta name="keywords" content="typewriter, writing, retro, vintage, text editor, AI, generative, creative writing">
    <meta name="description" content="Experience the nostalgia of a classic typewriter with Wordstar, a web-based app that combines vintage aesthetics with modern AI-powered writing tools. Generate creative text, experiment with different writing styles, and rediscover the joy of putting words on paper (virtually!).">
    <title>WordStar Nexus - Modern Text Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #2d2d2d;
            color: #f0f0f0;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        #toolbar {
            background-color: #1e1e1e;
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }
        #editor {
            flex-grow: 1;
            padding: 20px;
            font-size: 16px;
            line-height: 1.6;
            background-color: #1e1e1e;
            color: #f0f0f0;
            border: none;
            resize: none;
        }
        #statusbar {
            background-color: #cc0000;
            color: white;
            padding: 5px 10px;
            font-size: 14px;
        }
        button {
            background-color: #cc0000;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-right: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #990000;
        }
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        #dictionary-select {
            margin-right: 10px;
        }
        #notebook {
            background-color: #cc0000;
            padding: 10px;
            border-radius: 5px;
            margin-left: 10px;
        }
        #notebookText {
            width: 200px;
            background-color: #1e1e1e;
            color: #f0f0f0;
            border: 1px solid black;
            padding: 5px;
        }
        #ace-editor {
            width: 80%;
            height: 100%;
        }
        #main-text-area {
            width: 100%;
            height: 100%;
            background-color: #1e1e1e;
            color: #f0f0f0;
            border: none;
            resize: none;
            font-family: 'Courier New', monospace;
            font-size: 16pt;
            font-weight: bold;
            padding: 10px;
        }
        #dictionary-results {
            flex-grow: 1;
            overflow-y: auto;
            background-color: #2d2d2d;
            padding: 10px;
            border: 1px solid #444;
            font-size: 12px;
        }
        #ai-response {
            white-space: pre-wrap;
            min-height: 200px;
        }
        #word-info {
            display: none;
        }
        select, textarea {
            background-color: #2d2d2d;
            color: white;
            border: 1px solid #444;
        }
        .loading {
            color: #cc0000;
            font-style: italic;
        }
        .error {
            color: #ff6666;
        }
        .success {
            color: #66ff66;
        }
    </style>
</head>
<body>
<div class="container">
    <div id="toolbar">
        <div>
            <button onclick="newDocument()">New</button>
            <button onclick="saveDocument()">Save</button>
            <button onclick="exportTxt()">Export TXT</button>
            <button onclick="exportRtf()">Export RTF</button>
            <button onclick="exportPdf()">Export PDF</button>
            <button onclick="insertPoeticParagraph()">Insert Random Poetic Paragraph</button>
            <button onclick="insertRandomScientificWord()">Random Word</button>
        </div>
        <div id="notebook">
            <textarea id="notebookText" rows="3" placeholder="Write your note here..."></textarea>
            <div>
                <button onclick="insertNoteToEditor()" style="background-color: black; color: #cc0000; border: none; padding: 5px 10px; margin-top: 5px; cursor: pointer;">Insert Note</button>
            </div>
        </div>
    </div>
    
    <div id="editor" style="display: flex; justify-content: space-between;">
        <div id="ace-editor" style="width: 80%; height: 100%;">
            <textarea id="main-text-area" style="width: 100%; height: 100%; background-color: #1e1e1e; color: #f0f0f0; border: none; resize: none; font-family: 'Courier New', monospace; font-size: 16pt; font-weight: bold; padding: 10px;" placeholder="Start typing your document here..."></textarea>
        </div>
        <div style="width: 18%; display: flex; flex-direction: column;">
            <div>
                <select id="ai-model-select" style="width: 100%; padding: 5px; margin-bottom: 5px;">
                    <option value="liquid-ai">Liquid AI (Puter API)</option>
                    <option value="local-simulation">Local AI Simulation</option>
                    <option value="gpt2">GPT-2</option>
                    <option value="bert">BERT</option>
                    <option value="t5">T5</option>
                    <option value="roberta">RoBERTa</option>
                    <option value="markov">Markov Chain</option>
                    <option value="wordassociation">Word Association</option>
                </select>
                <textarea id="ai-prompt" placeholder="Enter your prompt here" style="width: 100%; padding: 5px; margin-bottom: 5px; height: 60px;"></textarea>
                <button onclick="generateText()" id="generate-btn" style="width: 100%; background-color: #cc0000; color: white; border: none; padding: 5px 10px; cursor: pointer; font-size: 12px;">Create Text</button>
            </div>
            <div id="dictionary-results" style="flex-grow: 1; overflow-y: auto; background-color: #2d2d2d; padding: 10px; border: 1px solid #444; font-size: 12px;">
                <div id="word-info" style="display: none;">
                    <h3 id="word-title" style="color: #cc0000; margin-bottom: 10px;"></h3>
                    <div id="word-definition" style="margin-bottom: 10px;"></div>
                    <div id="word-etymology" style="margin-bottom: 10px; font-style: italic;"></div>
                    <div id="word-thesaurus">
                        <h4 style="color: #cc0000; margin-bottom: 5px;">Synonyms:</h4>
                        <ul id="word-synonyms" style="list-style-type: none; padding-left: 0;"></ul>
                    </div>
                </div>
                <div id="ai-response" style="white-space: pre-wrap;">To use the text generation feature:

1. Choose "Liquid AI" for real AI responses
2. Enter your prompt in the text area
3. Click "Create Text"

The Liquid AI model connects to a live API. If it fails, try the "Local AI Simulation" for offline testing.

Note: Some APIs may have CORS restrictions when running from local files.</div>
            </div>
        </div>
    </div>
    
    <div id="statusbar" style="background-color: #cc0000; display: flex; justify-content: space-between; align-items: center;">
        <span>WordStar Online - Ready</span>
        <span id="word-count" style="font-size: 12px;">Words: 0</span>
        <span style="font-size: 12px;">Â© MMXXIV www.inkrealm.info</span>
        <br>
        <br>
        <iframe width="600" height="600" src="https://inkrealm.info/x2" title="My Site"></iframe>
    </div>
</div>

<script>
    let editor;

    // Initialize editor when the page loads
    window.onload = function() {
        editor = ace.edit("ace-editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/text");
        editor.session.on('change', updateWordCount);
        updateWordCount();
    };

    // ... (all your existing functions remain the same: newDocument, saveDocument, exportTxt, exportRtf, exportPdf, insertPoeticParagraph, insertRandomScientificWord, insertNoteToEditor, updateStatusBar, updateWordCount)

    function newDocument() {
        if (editor) {
            editor.setValue("");
            updateStatusBar("New document created");
            updateWordCount();
        }
    }

    function saveDocument() {
        if (editor) {
            const content = editor.getValue();
            const blob = new Blob([content], {type: "text/plain;charset=utf-8"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "document.txt";
            a.click();
            URL.revokeObjectURL(url);
            updateStatusBar("Document saved");
        }
    }

    function exportTxt() {
        saveDocument();
    }

    function exportRtf() {
        if (editor) {
            const content = editor.getValue();
            const rtfContent = "{\\rtf1\\ansi\\deff0{\\fonttbl{\\f0 Times New Roman;}}\n\n" + content.replace(/\n/g, "\\par\n") + "}";
            const blob = new Blob([rtfContent], {type: "application/rtf"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "document.rtf";
            a.click();
            URL.revokeObjectURL(url);
            updateStatusBar("Document exported as RTF");
        }
    }

    function exportPdf() {
        if (editor && window.jspdf) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const content = editor.getValue();
            doc.text(content, 10, 10);
            doc.save("document.pdf");
            updateStatusBar("Document exported as PDF");
        } else {
            console.error("jsPDF is not available or editor is not initialized");
        }
    }

    function insertPoeticParagraph() {
        if (editor) {
            const poeticParagraphs = [
                "Whispers of twilight dance on autumn leaves,\nAs golden hues paint the sky's canvas,\nNature's symphony echoes through the trees,\nA moment of beauty, forever to last.",
                "Moonlit waves caress the shore,\nStars above, a cosmic dance,\nIn this quiet, forevermore,\nWe find life's gentle romance.",
                "Sunflowers reach for azure skies,\nTheir petals, a sea of gold,\nIn fields where summer never dies,\nAnd stories of light unfold."
            ];
            const randomParagraph = poeticParagraphs[Math.floor(Math.random() * poeticParagraphs.length)];
            editor.insert(randomParagraph + "\n\n");
            updateStatusBar("Poetic paragraph inserted");
            updateWordCount();
        }
    }

    function insertRandomScientificWord() {
        if (editor) {
            const scientificWords = [
                "Quantum", "Photosynthesis", "Entropy", "Mitochondria", "Neuroplasticity",
                "Genome", "Algorithm", "Nanotechnology", "Thermodynamics", "Synapse"
            ];
            const randomWord = scientificWords[Math.floor(Math.random() * scientificWords.length)];
            editor.insert(randomWord + " ");
            updateStatusBar("Random scientific word inserted");
            updateWordCount();
        }
    }

    function insertNoteToEditor() {
        if (editor) {
            const noteContent = document.getElementById('notebookText').value;
            if (noteContent.trim() === '') {
                alert('Note is empty. Please write something before inserting.');
                return;
            }
            editor.insert(noteContent + '\n');
            updateStatusBar("Note inserted into main text area");
            updateWordCount();
        }
    }

    function updateStatusBar(message) {
        const statusBarElement = document.querySelector('#statusbar span');
        if (statusBarElement) {
            statusBarElement.textContent = "WordStar Online - " + message;
        }
    }

    function updateWordCount() {
        if (editor) {
            const content = editor.getValue();
            const wordCount = content.trim().split(/\s+/).length;
            const wordCountElement = document.getElementById('word-count');
            if (wordCountElement) {
                wordCountElement.textContent = `Words: ${wordCount}`;
            }
        }
    }

    // Enhanced AI generation with multiple fallbacks
    async function generateText() {
        const aiPrompt = document.getElementById('ai-prompt').value;
        const aiModel = document.getElementById('ai-model-select').value;
        const aiResponse = document.getElementById('ai-response');
        const generateBtn = document.getElementById('generate-btn');
        
        // Clear previous state
        aiResponse.className = '';
        
        if (!aiPrompt.trim()) {
            aiResponse.textContent = "Please enter a prompt.";
            aiResponse.className = 'error';
            return;
        }
        
        // Disable button during generation
        generateBtn.disabled = true;
        generateBtn.textContent = 'Generating...';
        
        try {
            if (aiModel === 'liquid-ai') {
                await generateWithLiquidAI(aiPrompt, aiResponse);
            } else if (aiModel === 'local-simulation') {
                await generateWithLocalSimulation(aiPrompt, aiResponse);
            } else {
                // Other models use placeholder
                aiResponse.textContent = `Generated text using ${aiModel} model based on prompt: "${aiPrompt}"\n\nThis is a placeholder response. In a full implementation, this would connect to an AI model to generate text.`;
                aiResponse.className = 'success';
                updateStatusBar("Text generated (simulation)");
            }
        } catch (error) {
            console.error("Generation error:", error);
            aiResponse.textContent = `Error: ${error.message}\n\nTry using "Local AI Simulation" instead.`;
            aiResponse.className = 'error';
            updateStatusBar("Error generating text");
        } finally {
            // Re-enable button
            generateBtn.disabled = false;
            generateBtn.textContent = 'Create Text';
        }
    }

    async function generateWithLiquidAI(prompt, responseElement) {
        responseElement.textContent = 'Connecting to Liquid AI... Please wait.';
        responseElement.className = 'loading';
        
        // Try multiple API endpoints as fallbacks
        const apiEndpoints = [
            'https://liquid.puter.com/v1/chat/completions',
            'https://api.puter.com/v1/chat/completions',
            'https://jsonplaceholder.typicode.com/posts' // Fallback for testing
        ];
        
        let lastError = null;
        
        for (const endpoint of apiEndpoints) {
            try {
                console.log(`Trying endpoint: ${endpoint}`);
                
                const requestBody = endpoint.includes('jsonplaceholder') 
                    ? { // Mock request for testing
                        title: prompt,
                        body: "This is a mock response since the real API might be unavailable.",
                        userId: 1
                    }
                    : { // Real Liquid AI request
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        stream: false,
                        max_tokens: 500
                    };
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody),
                    timeout: 10000 // 10 second timeout
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                let generatedText;
                if (endpoint.includes('jsonplaceholder')) {
                    // Mock response
                    generatedText = `Mock AI Response (Real API Unavailable):\n\nBased on your prompt "${prompt}", here is a simulated response demonstrating what the Liquid AI would generate. This appears to be a creative writing piece inspired by your input.\n\nTry running this on a live server or check if the Liquid AI service is available.`;
                } else {
                    // Real Liquid AI response
                    generatedText = data.choices[0].message.content;
                }
                
                responseElement.textContent = generatedText;
                responseElement.className = 'success';
                updateStatusBar("Text generated with Liquid AI");
                return;
                
            } catch (error) {
                console.warn(`Endpoint ${endpoint} failed:`, error);
                lastError = error;
                continue; // Try next endpoint
            }
        }
        
        // If all endpoints failed
        throw new Error(`All API endpoints failed. Last error: ${lastError.message}`);
    }

    async function generateWithLocalSimulation(prompt, responseElement) {
        responseElement.textContent = 'Running local simulation...';
        responseElement.className = 'loading';
        
        // Simulate API delay
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Enhanced local simulation that creates more realistic responses
        const responses = [
            `Based on your prompt "${prompt}", here is a locally generated response:\n\nThis is a simulation of what an AI might generate. The words flow like a river, carrying meaning and emotion through the digital landscape of your imagination.`,
            
            `Local AI Simulation for: "${prompt}"\n\nThe creative process unfolds like a delicate flower, each petal representing a different aspect of your query. In this simulated environment, we explore the boundaries of artificial creativity.`,
            
            `Simulated Response to: "${prompt}"\n\nIn the realm of synthetic thought, your prompt has sparked a chain reaction of linguistic possibilities. This response demonstrates the potential of machine-assisted creativity.`
        ];
        
        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
        responseElement.textContent = randomResponse;
        responseElement.className = 'success';
        updateStatusBar("Text generated (local simulation)");
    }
</script>
</body>
</html>
