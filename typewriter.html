<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base href="https://wordstar-online.com/">
    <meta name="viewport" content="width=1024">
    <meta name="keywords" content="typewriter, writing, retro, vintage, text editor, AI, generative, creative writing">
    <meta name="description" content="Experience the nostalgia of a classic typewriter with Wordstar, a web-based app that combines vintage aesthetics with modern AI-powered writing tools. Generate creative text, experiment with different writing styles, and rediscover the joy of putting words on paper (virtually!).">
    <title>WordStar Nexus - Modern Text Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <!-- Add Puter.js for AI capabilities -->
    <script src="https://js.puter.com/v2/"></script>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #2d2d2d;
            color: #f0f0f0;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        #toolbar {
            background-color: #1e1e1e;
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }
        #editor {
            flex-grow: 1;
            padding: 20px;
            font-size: 16px;
            line-height: 1.6;
            background-color: #1e1e1e;
            color: #f0f0f0;
            border: none;
            resize: none;
        }
        #statusbar {
            background-color: #cc0000;
            color: white;
            padding: 5px 10px;
            font-size: 14px;
        }
        button {
            background-color: #cc0000;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-right: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #990000;
        }
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        #notebook {
            background-color: #cc0000;
            padding: 10px;
            border-radius: 5px;
            margin-left: 10px;
        }
        #notebookText {
            width: 200px;
            background-color: #1e1e1e;
            color: #f0f0f0;
            border: 1px solid black;
            padding: 5px;
        }
        #ace-editor {
            width: 80%;
            height: 100%;
        }
        #main-text-area {
            width: 100%;
            height: 100%;
            background-color: #1e1e1e;
            color: #f0f0f0;
            border: none;
            resize: none;
            font-family: 'Courier New', monospace;
            font-size: 16pt;
            font-weight: bold;
            padding: 10px;
        }
        #dictionary-results {
            flex-grow: 1;
            overflow-y: auto;
            background-color: #2d2d2d;
            padding: 10px;
            border: 1px solid #444;
            font-size: 12px;
        }
        #ai-response {
            white-space: pre-wrap;
            min-height: 200px;
            line-height: 1.4;
        }
        select, textarea {
            background-color: #2d2d2d;
            color: white;
            border: 1px solid #444;
        }
        .loading {
            color: #cc0000;
            font-style: italic;
        }
        .error {
            color: #ff6666;
            background-color: #3a2a2a;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            color: #aaffaa;
            background-color: #2a3a2a;
            padding: 10px;
            border-radius: 4px;
        }
        .ai-section {
            margin-bottom: 15px;
        }
        .insert-buttons {
            margin-top: 10px;
        }
        .insert-buttons button {
            font-size: 11px;
            padding: 3px 6px;
            margin-right: 3px;
        }
        .model-category {
            color: #cc0000;
            font-weight: bold;
            margin-top: 5px;
            font-size: 11px;
        }
    </style>
</head>
<body>
<div class="container">
    <div id="toolbar">
        <div>
            <button onclick="newDocument()">New</button>
            <button onclick="saveDocument()">Save</button>
            <button onclick="exportTxt()">Export TXT</button>
            <button onclick="exportRtf()">Export RTF</button>
            <button onclick="exportPdf()">Export PDF</button>
            <button onclick="insertPoeticParagraph()">Insert Random Poetic Paragraph</button>
            <button onclick="insertRandomScientificWord()">Random Word</button>
        </div>
        <div id="notebook">
            <textarea id="notebookText" rows="3" placeholder="Write your note here..."></textarea>
            <div>
                <button onclick="insertNoteToEditor()" style="background-color: black; color: #cc0000; border: none; padding: 5px 10px; margin-top: 5px; cursor: pointer;">Insert Note</button>
            </div>
        </div>
    </div>
    
    <div id="editor" style="display: flex; justify-content: space-between;">
        <div id="ace-editor" style="width: 80%; height: 100%;">
            <textarea id="main-text-area" style="width: 100%; height: 100%; background-color: #1e1e1e; color: #f0f0f0; border: none; resize: none; font-family: 'Courier New', monospace; font-size: 16pt; font-weight: bold; padding: 10px;" placeholder="Start typing your document here..."></textarea>
        </div>
        <div style="width: 18%; display: flex; flex-direction: column;">
            <div class="ai-section">
                <select id="ai-model-select" style="width: 100%; padding: 5px; margin-bottom: 5px;">
                    <optgroup label="ðŸš€ Liquid AI Models">
                        <option value="liquid/lfm-7b">Liquid LFM-7B</option>
                        <option value="liquid/lfm-3b">Liquid LFM-3B</option>
                    </optgroup>
                    <optgroup label="ðŸ¤– Google Gemma 3">
                        <option value="google/gemma-3-27b-it">Gemma 3 27B</option>
                        <option value="google/gemma-3-12b-it">Gemma 3 12B</option>
                        <option value="google/gemma-3-4b-it">Gemma 3 4B</option>
                    </optgroup>
                    <optgroup label="â­ Google Gemma 3n">
                        <option value="google/gemma-3n-e2b-it:free">Gemma 3n E2B (Free)</option>
                        <option value="google/gemma-3n-e4b-it">Gemma 3n E4B</option>
                    </optgroup>
                    <optgroup label="âš¡ Google Gemini Flash">
                        <option value="google/gemini-2.0-flash-001">Gemini 2.0 Flash</option>
                        <option value="google/gemini-2.0-flash-lite-001">Gemini 2.0 Flash Lite</option>
                        <option value="google/gemini-2.5-flash">Gemini 2.5 Flash</option>
                    </optgroup>
                    <optgroup label="ðŸŽ¯ Google Gemini Pro">
                        <option value="google/gemini-2.5-pro">Gemini 2.5 Pro</option>
                        <option value="google/gemini-pro-1.5">Gemini Pro 1.5</option>
                    </optgroup>
                    <optgroup label="ðŸ”— Other Models">
                        <option value="markov">Markov Chain</option>
                        <option value="wordassociation">Word Association</option>
                    </optgroup>
                </select>
                <textarea id="ai-prompt" placeholder="Enter your creative prompt here..." style="width: 100%; padding: 5px; margin-bottom: 5px; height: 60px;"></textarea>
                <button onclick="generateText()" id="generate-btn" style="width: 100%; background-color: #cc0000; color: white; border: none; padding: 5px 10px; cursor: pointer; font-size: 12px;">âœ¨ Create Text</button>
            </div>
            <div id="dictionary-results">
                <div id="ai-response">
ðŸš€ <strong>AI Text Generator Powered by Puter.js</strong>

â€¢ Choose from various AI models including Liquid AI and Google Gemma
â€¢ Enter your creative prompt above  
â€¢ Click "Create Text" to generate

<em>Note: Uses Puter.js "User Pays" model - free for developers, users cover their own usage costs.</em>
                </div>
                <div class="insert-buttons">
                    <button onclick="insertAIResponse()" style="background-color: #00cc00;">Insert into Document</button>
                    <button onclick="copyAIResponse()" style="background-color: #0066cc;">Copy to Clipboard</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="statusbar" style="background-color: #cc0000; display: flex; justify-content: space-between; align-items: center;">
        <span>WordStar Online - Ready</span>
        <span id="word-count" style="font-size: 12px;">Words: 0</span>
        <span style="font-size: 12px;">Â© MMXXIV www.inkrealm.info</span>
    </div>
</div>

<script>
    let editor;

    // Initialize editor when the page loads
    window.onload = function() {
        editor = ace.edit("ace-editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/text");
        editor.session.on('change', updateWordCount);
        updateWordCount();
    };

    // ... (keep all your existing WordStar functions: newDocument, saveDocument, exportTxt, exportRtf, exportPdf, insertPoeticParagraph, insertRandomScientificWord, insertNoteToEditor, updateStatusBar, updateWordCount)

    function newDocument() {
        if (editor) {
            editor.setValue("");
            updateStatusBar("New document created");
            updateWordCount();
        }
    }

    function saveDocument() {
        if (editor) {
            const content = editor.getValue();
            const blob = new Blob([content], {type: "text/plain;charset=utf-8"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "document.txt";
            a.click();
            URL.revokeObjectURL(url);
            updateStatusBar("Document saved");
        }
    }

    function exportTxt() {
        saveDocument();
    }

    function exportRtf() {
        if (editor) {
            const content = editor.getValue();
            const rtfContent = "{\\rtf1\\ansi\\deff0{\\fonttbl{\\f0 Times New Roman;}}\n\n" + content.replace(/\n/g, "\\par\n") + "}";
            const blob = new Blob([rtfContent], {type: "application/rtf"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "document.rtf";
            a.click();
            URL.revokeObjectURL(url);
            updateStatusBar("Document exported as RTF");
        }
    }

    function exportPdf() {
        if (editor && window.jspdf) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const content = editor.getValue();
            doc.text(content, 10, 10);
            doc.save("document.pdf");
            updateStatusBar("Document exported as PDF");
        } else {
            console.error("jsPDF is not available or editor is not initialized");
        }
    }

    function insertPoeticParagraph() {
        if (editor) {
            const poeticParagraphs = [
                "Whispers of twilight dance on autumn leaves,\nAs golden hues paint the sky's canvas,\nNature's symphony echoes through the trees,\nA moment of beauty, forever to last.",
                "Moonlit waves caress the shore,\nStars above, a cosmic dance,\nIn this quiet, forevermore,\nWe find life's gentle romance.",
                "Sunflowers reach for azure skies,\nTheir petals, a sea of gold,\nIn fields where summer never dies,\nAnd stories of light unfold."
            ];
            const randomParagraph = poeticParagraphs[Math.floor(Math.random() * poeticParagraphs.length)];
            editor.insert(randomParagraph + "\n\n");
            updateStatusBar("Poetic paragraph inserted");
            updateWordCount();
        }
    }

    function insertRandomScientificWord() {
        if (editor) {
            const scientificWords = [
                "Quantum", "Photosynthesis", "Entropy", "Mitochondria", "Neuroplasticity",
                "Genome", "Algorithm", "Nanotechnology", "Thermodynamics", "Synapse"
            ];
            const randomWord = scientificWords[Math.floor(Math.random() * scientificWords.length)];
            editor.insert(randomWord + " ");
            updateStatusBar("Random scientific word inserted");
            updateWordCount();
        }
    }

    function insertNoteToEditor() {
        if (editor) {
            const noteContent = document.getElementById('notebookText').value;
            if (noteContent.trim() === '') {
                alert('Note is empty. Please write something before inserting.');
                return;
            }
            editor.insert(noteContent + '\n');
            updateStatusBar("Note inserted into main text area");
            updateWordCount();
        }
    }

    function updateStatusBar(message) {
        const statusBarElement = document.querySelector('#statusbar span');
        if (statusBarElement) {
            statusBarElement.textContent = "WordStar Online - " + message;
        }
    }

    function updateWordCount() {
        if (editor) {
            const content = editor.getValue();
            const wordCount = content.trim().split(/\s+/).length;
            const wordCountElement = document.getElementById('word-count');
            if (wordCountElement) {
                wordCountElement.textContent = `Words: ${wordCount}`;
            }
        }
    }

    // Enhanced AI generation with Puter.js
    async function generateText() {
        const aiPrompt = document.getElementById('ai-prompt').value;
        const aiModel = document.getElementById('ai-model-select').value;
        const aiResponse = document.getElementById('ai-response');
        const generateBtn = document.getElementById('generate-btn');
        
        // Clear previous state
        aiResponse.className = '';
        
        if (!aiPrompt.trim()) {
            aiResponse.textContent = "âŒ Please enter a prompt to generate text.";
            aiResponse.className = 'error';
            return;
        }
        
        // Disable button during generation
        generateBtn.disabled = true;
        generateBtn.textContent = 'ðŸ”„ Generating...';
        generateBtn.style.backgroundColor = '#666';
        
        try {
            if (aiModel === 'markov' || aiModel === 'wordassociation') {
                await generateWithSimulation(aiPrompt, aiModel, aiResponse);
            } else {
                await generateWithPuterAI(aiPrompt, aiModel, aiResponse);
            }
        } catch (error) {
            console.error("Generation error:", error);
            aiResponse.textContent = `âŒ Error: ${error.message}\n\nðŸ’¡ Try using a different model or check your connection.`;
            aiResponse.className = 'error';
            updateStatusBar("Error generating text");
        } finally {
            // Re-enable button
            generateBtn.disabled = false;
            generateBtn.textContent = 'âœ¨ Create Text';
            generateBtn.style.backgroundColor = '#cc0000';
        }
    }

    async function generateWithPuterAI(prompt, model, responseElement) {
        responseElement.textContent = `ðŸ”„ Connecting to ${model}... Please wait.`;
        responseElement.className = 'loading';
        
        try {
            // Use Puter.js AI chat API [citation:1]
            const response = await puter.ai.chat(prompt, { 
                model: model,
                stream: false
            });
            
            responseElement.textContent = `âœ… ${model} Response:\n\n${response}`;
            responseElement.className = 'success';
            updateStatusBar(`Text generated with ${model}`);
            
        } catch (error) {
            console.error("Puter.js API error:", error);
            
            // Fallback to simulation if Puter.js fails
            responseElement.textContent = `âŒ API Error with ${model}: ${error.message}\n\nðŸ”„ Falling back to local simulation...`;
            await generateWithSimulation(prompt, model, responseElement);
            updateStatusBar("Text generated (fallback simulation)");
        }
    }

    async function generateWithSimulation(prompt, model, responseElement) {
        responseElement.textContent = 'ðŸ”„ Running local simulation...';
        responseElement.className = 'loading';
        
        // Simulate processing delay
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        const simulations = {
            'markov': `ðŸ”— **Markov Chain Simulation**\n\nPrompt: "${prompt}"\n\nThis simulated response demonstrates how a Markov chain would generate text based on probabilistic word transitions and patterns learned from training data.`,
            'wordassociation': `ðŸ§  **Word Association Simulation**\n\nProcessing: "${prompt}"\n\nThis simulation creates text by following semantic connections between words, building associations that creatively expand on your original idea through linguistic patterns.`,
            'default': `ðŸ¤– **AI Simulation**\n\nBased on your prompt "${prompt}", this simulated response demonstrates the kind of text that would be generated by the selected AI model. In a live environment, this would connect to the actual model API.`
        };
        
        const response = simulations[model] || simulations['default'];
        responseElement.textContent = response;
        responseElement.className = 'success';
    }

    // Utility functions for the AI response
    function insertAIResponse() {
        if (editor) {
            const aiResponse = document.getElementById('ai-response').textContent;
            if (aiResponse && !aiResponse.includes('AI Text Generator Powered by Puter.js')) {
                editor.insert('\n\n' + aiResponse + '\n\n');
                updateStatusBar("AI response inserted into document");
                updateWordCount();
            } else {
                alert('No AI response available to insert. Generate some text first.');
            }
        }
    }

    function copyAIResponse() {
        const aiResponse = document.getElementById('ai-response').textContent;
        if (aiResponse && !aiResponse.includes('AI Text Generator Powered by Puter.js')) {
            navigator.clipboard.writeText(aiResponse).then(() => {
                updateStatusBar("AI response copied to clipboard");
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy to clipboard');
            });
        } else {
            alert('No AI response available to copy. Generate some text first.');
        }
    }
</script>
</body>
</html>
