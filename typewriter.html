<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base href="https://wordstar-online.com/">
    <meta name="viewport" content="width=1024">
    <meta name="keywords" content="typewriter, writing, retro, vintage, text editor, AI, generative, creative writing">
    <meta name="description" content="Experience the nostalgia of a classic typewriter with Wordstar, a web-based app that combines vintage aesthetics with modern AI-powered writing tools. Generate creative text, experiment with different writing styles, and rediscover the joy of putting words on paper (virtually!).">
    <title>WordStar Nexus - Modern Text Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #2d2d2d;
            color: #f0f0f0;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        #toolbar {
            background-color: #1e1e1e;
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }
        #editor {
            flex-grow: 1;
            padding: 20px;
            font-size: 16px;
            line-height: 1.6;
            background-color: #1e1e1e;
            color: #f0f0f0;
            border: none;
            resize: none;
        }
        #statusbar {
            background-color: #cc0000;
            color: white;
            padding: 5px 10px;
            font-size: 14px;
        }
        button {
            background-color: #cc0000;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-right: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #990000;
        }
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        #dictionary-select {
            margin-right: 10px;
        }
        #notebook {
            background-color: #cc0000;
            padding: 10px;
            border-radius: 5px;
            margin-left: 10px;
        }
        #notebookText {
            width: 200px;
            background-color: #1e1e1e;
            color: #f0f0f0;
            border: 1px solid black;
            padding: 5px;
        }
        #ace-editor {
            width: 80%;
            height: 100%;
        }
        #main-text-area {
            width: 100%;
            height: 100%;
            background-color: #1e1e1e;
            color: #f0f0f0;
            border: none;
            resize: none;
            font-family: 'Courier New', monospace;
            font-size: 16pt;
            font-weight: bold;
            padding: 10px;
        }
        #dictionary-results {
            flex-grow: 1;
            overflow-y: auto;
            background-color: #2d2d2d;
            padding: 10px;
            border: 1px solid #444;
            font-size: 12px;
        }
        #ai-response {
            white-space: pre-wrap;
            min-height: 200px;
            line-height: 1.4;
        }
        #word-info {
            display: none;
        }
        select, textarea {
            background-color: #2d2d2d;
            color: white;
            border: 1px solid #444;
        }
        .loading {
            color: #cc0000;
            font-style: italic;
        }
        .error {
            color: #ff6666;
            background-color: #3a2a2a;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            color: #aaffaa;
            background-color: #2a3a2a;
            padding: 10px;
            border-radius: 4px;
        }
        .ai-section {
            margin-bottom: 15px;
        }
        .insert-buttons {
            margin-top: 10px;
        }
        .insert-buttons button {
            font-size: 11px;
            padding: 3px 6px;
            margin-right: 3px;
        }
    </style>
</head>
<body>
<div class="container">
    <div id="toolbar">
        <div>
            <button onclick="newDocument()">New</button>
            <button onclick="saveDocument()">Save</button>
            <button onclick="exportTxt()">Export TXT</button>
            <button onclick="exportRtf()">Export RTF</button>
            <button onclick="exportPdf()">Export PDF</button>
            <button onclick="insertPoeticParagraph()">Insert Random Poetic Paragraph</button>
            <button onclick="insertRandomScientificWord()">Random Word</button>
        </div>
        <div id="notebook">
            <textarea id="notebookText" rows="3" placeholder="Write your note here..."></textarea>
            <div>
                <button onclick="insertNoteToEditor()" style="background-color: black; color: #cc0000; border: none; padding: 5px 10px; margin-top: 5px; cursor: pointer;">Insert Note</button>
            </div>
        </div>
    </div>
    
    <div id="editor" style="display: flex; justify-content: space-between;">
        <div id="ace-editor" style="width: 80%; height: 100%;">
            <textarea id="main-text-area" style="width: 100%; height: 100%; background-color: #1e1e1e; color: #f0f0f0; border: none; resize: none; font-family: 'Courier New', monospace; font-size: 16pt; font-weight: bold; padding: 10px;" placeholder="Start typing your document here..."></textarea>
        </div>
        <div style="width: 18%; display: flex; flex-direction: column;">
            <div class="ai-section">
                <select id="ai-model-select" style="width: 100%; padding: 5px; margin-bottom: 5px;">
                    <option value="liquid-ai">🚀 Liquid AI (Live)</option>
                    <option value="local-simulation">💻 Local AI Simulation</option>
                    <option value="gpt2">🤖 GPT-2</option>
                    <option value="markov">🔗 Markov Chain</option>
                    <option value="wordassociation">🧠 Word Association</option>
                </select>
                <textarea id="ai-prompt" placeholder="Enter your creative prompt here..." style="width: 100%; padding: 5px; margin-bottom: 5px; height: 60px;"></textarea>
                <button onclick="generateText()" id="generate-btn" style="width: 100%; background-color: #cc0000; color: white; border: none; padding: 5px 10px; cursor: pointer; font-size: 12px;">✨ Create Text</button>
            </div>
            <div id="dictionary-results">
                <div id="word-info" style="display: none;">
                    <h3 id="word-title" style="color: #cc0000; margin-bottom: 10px;"></h3>
                    <div id="word-definition" style="margin-bottom: 10px;"></div>
                    <div id="word-etymology" style="margin-bottom: 10px; font-style: italic;"></div>
                    <div id="word-thesaurus">
                        <h4 style="color: #cc0000; margin-bottom: 5px;">Synonyms:</h4>
                        <ul id="word-synonyms" style="list-style-type: none; padding-left: 0;"></ul>
                    </div>
                </div>
                <div id="ai-response">
🚀 <strong>Liquid AI Text Generator</strong>

• Choose "Liquid AI" for real AI responses
• Enter your creative prompt above
• Click "Create Text" to generate

<em>Note: Liquid AI connects to a live API. If unavailable, use "Local AI Simulation" for instant results.</em>
                </div>
                <div class="insert-buttons">
                    <button onclick="insertAIResponse()" style="background-color: #00cc00;">Insert into Document</button>
                    <button onclick="copyAIResponse()" style="background-color: #0066cc;">Copy to Clipboard</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="statusbar" style="background-color: #cc0000; display: flex; justify-content: space-between; align-items: center;">
        <span>WordStar Online - Ready</span>
        <span id="word-count" style="font-size: 12px;">Words: 0</span>
        <span style="font-size: 12px;">© MMXXIV www.inkrealm.info</span>
        <br>
        <br>
        <iframe width="600" height="600" src="https://inkrealm.info/x2" title="My Site"></iframe>
    </div>
</div>

<script>
    let editor;

    // Initialize editor when the page loads
    window.onload = function() {
        editor = ace.edit("ace-editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/text");
        editor.session.on('change', updateWordCount);
        updateWordCount();
    };

    // All your existing functions remain here...
    function newDocument() {
        if (editor) {
            editor.setValue("");
            updateStatusBar("New document created");
            updateWordCount();
        }
    }

    function saveDocument() {
        if (editor) {
            const content = editor.getValue();
            const blob = new Blob([content], {type: "text/plain;charset=utf-8"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "document.txt";
            a.click();
            URL.revokeObjectURL(url);
            updateStatusBar("Document saved");
        }
    }

    function exportTxt() {
        saveDocument();
    }

    function exportRtf() {
        if (editor) {
            const content = editor.getValue();
            const rtfContent = "{\\rtf1\\ansi\\deff0{\\fonttbl{\\f0 Times New Roman;}}\n\n" + content.replace(/\n/g, "\\par\n") + "}";
            const blob = new Blob([rtfContent], {type: "application/rtf"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "document.rtf";
            a.click();
            URL.revokeObjectURL(url);
            updateStatusBar("Document exported as RTF");
        }
    }

    function exportPdf() {
        if (editor && window.jspdf) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const content = editor.getValue();
            doc.text(content, 10, 10);
            doc.save("document.pdf");
            updateStatusBar("Document exported as PDF");
        } else {
            console.error("jsPDF is not available or editor is not initialized");
        }
    }

    function insertPoeticParagraph() {
        if (editor) {
            const poeticParagraphs = [
                "Whispers of twilight dance on autumn leaves,\nAs golden hues paint the sky's canvas,\nNature's symphony echoes through the trees,\nA moment of beauty, forever to last.",
                "Moonlit waves caress the shore,\nStars above, a cosmic dance,\nIn this quiet, forevermore,\nWe find life's gentle romance.",
                "Sunflowers reach for azure skies,\nTheir petals, a sea of gold,\nIn fields where summer never dies,\nAnd stories of light unfold."
            ];
            const randomParagraph = poeticParagraphs[Math.floor(Math.random() * poeticParagraphs.length)];
            editor.insert(randomParagraph + "\n\n");
            updateStatusBar("Poetic paragraph inserted");
            updateWordCount();
        }
    }

    function insertRandomScientificWord() {
        if (editor) {
            const scientificWords = [
                "Quantum", "Photosynthesis", "Entropy", "Mitochondria", "Neuroplasticity",
                "Genome", "Algorithm", "Nanotechnology", "Thermodynamics", "Synapse"
            ];
            const randomWord = scientificWords[Math.floor(Math.random() * scientificWords.length)];
            editor.insert(randomWord + " ");
            updateStatusBar("Random scientific word inserted");
            updateWordCount();
        }
    }

    function insertNoteToEditor() {
        if (editor) {
            const noteContent = document.getElementById('notebookText').value;
            if (noteContent.trim() === '') {
                alert('Note is empty. Please write something before inserting.');
                return;
            }
            editor.insert(noteContent + '\n');
            updateStatusBar("Note inserted into main text area");
            updateWordCount();
        }
    }

    function updateStatusBar(message) {
        const statusBarElement = document.querySelector('#statusbar span');
        if (statusBarElement) {
            statusBarElement.textContent = "WordStar Online - " + message;
        }
    }

    function updateWordCount() {
        if (editor) {
            const content = editor.getValue();
            const wordCount = content.trim().split(/\s+/).length;
            const wordCountElement = document.getElementById('word-count');
            if (wordCountElement) {
                wordCountElement.textContent = `Words: ${wordCount}`;
            }
        }
    }

    // Enhanced AI generation with better user experience
    async function generateText() {
        const aiPrompt = document.getElementById('ai-prompt').value;
        const aiModel = document.getElementById('ai-model-select').value;
        const aiResponse = document.getElementById('ai-response');
        const generateBtn = document.getElementById('generate-btn');
        
        // Clear previous state
        aiResponse.className = '';
        
        if (!aiPrompt.trim()) {
            aiResponse.textContent = "❌ Please enter a prompt to generate text.";
            aiResponse.className = 'error';
            return;
        }
        
        // Disable button during generation
        generateBtn.disabled = true;
        generateBtn.textContent = '🔄 Generating...';
        generateBtn.style.backgroundColor = '#666';
        
        try {
            if (aiModel === 'liquid-ai') {
                await generateWithLiquidAI(aiPrompt, aiResponse);
            } else if (aiModel === 'local-simulation') {
                await generateWithLocalSimulation(aiPrompt, aiResponse);
            } else {
                // Other models use enhanced simulation
                await generateWithEnhancedSimulation(aiPrompt, aiModel, aiResponse);
            }
        } catch (error) {
            console.error("Generation error:", error);
            aiResponse.textContent = `❌ Error: ${error.message}\n\n💡 Try using "Local AI Simulation" for instant results.`;
            aiResponse.className = 'error';
            updateStatusBar("Error generating text");
        } finally {
            // Re-enable button
            generateBtn.disabled = false;
            generateBtn.textContent = '✨ Create Text';
            generateBtn.style.backgroundColor = '#cc0000';
        }
    }

    async function generateWithLiquidAI(prompt, responseElement) {
        responseElement.textContent = '🔄 Connecting to Liquid AI... Please wait.';
        responseElement.className = 'loading';
        
        // Try multiple API endpoints with better error handling
        const apiEndpoints = [
            'https://liquid.puter.com/v1/chat/completions',
            'https://api.puter.com/v1/chat/completions'
        ];
        
        let lastError = null;
        
        for (const endpoint of apiEndpoints) {
            try {
                console.log(`Trying Liquid AI endpoint: ${endpoint}`);
                
                const requestBody = {
                    messages: [{
                        role: 'user',
                        content: prompt
                    }],
                    stream: false,
                    max_tokens: 500
                };
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 second timeout
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    const generatedText = data.choices[0].message.content;
                    responseElement.textContent = `✅ Liquid AI Response:\n\n${generatedText}`;
                    responseElement.className = 'success';
                    updateStatusBar("Text generated with Liquid AI");
                    return;
                } else {
                    throw new Error("Invalid response format from API");
                }
                
            } catch (error) {
                console.warn(`Endpoint ${endpoint} failed:`, error);
                lastError = error;
                continue; // Try next endpoint
            }
        }
        
        // If all endpoints failed, fall back to simulation
        console.log("All Liquid AI endpoints failed, falling back to simulation");
        await generateWithLocalSimulation(prompt, responseElement);
        updateStatusBar("Text generated (fallback simulation)");
    }

    async function generateWithLocalSimulation(prompt, responseElement) {
        responseElement.textContent = '🔄 Running local simulation...';
        responseElement.className = 'loading';
        
        // Simulate API delay (shorter for local simulation)
        await new Promise(resolve => setTimeout(resolve, 800));
        
        // Enhanced local simulation with more varied responses
        const promptWords = prompt.toLowerCase().split(/\s+/).slice(0, 5);
        const responses = [
            `🧠 **Local AI Simulation**\n\nBased on your prompt "${prompt}", here's a creative response:\n\nThe digital ink flows like a river of thought, carrying your ideas through the landscape of imagination. Each word builds upon the last, creating a tapestry of meaning that reflects the essence of your query.`,
            
            `💻 **Simulated AI Response**\n\nYour prompt "${prompt}" has sparked a chain of synthetic creativity:\n\nIn the realm of algorithmic composition, your words serve as the foundation for this generated text. The simulation explores linguistic patterns and creative associations to produce meaningful content.`,
            
            `🤖 **AI Simulation Result**\n\nProcessing: "${prompt}"\n\nThis response demonstrates the potential of machine-assisted writing. The words you provided have been expanded into a coherent passage that maintains the spirit of your original idea while introducing new perspectives.`
        ];
        
        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
        responseElement.textContent = randomResponse;
        responseElement.className = 'success';
        updateStatusBar("Text generated (local simulation)");
    }

    async function generateWithEnhancedSimulation(prompt, model, responseElement) {
        responseElement.textContent = `🔄 Simulating ${model}...`;
        responseElement.className = 'loading';
        
        await new Promise(resolve => setTimeout(resolve, 600));
        
        const responses = {
            'gpt2': `🤖 **GPT-2 Simulation**\n\nPrompt: "${prompt}"\n\nThis is a simulated GPT-2 response. The model would generate text by predicting the most likely next words based on patterns learned from vast amounts of text data.`,
            'markov': `🔗 **Markov Chain Simulation**\n\nProcessing: "${prompt}"\n\nA Markov chain model would analyze word transitions and probabilities to generate text that follows similar patterns to its training data.`,
            'wordassociation': `🧠 **Word Association Simulation**\n\nPrompt: "${prompt}"\n\nThis simulation creates text by following semantic connections between words, building associations that expand on your original idea.`
        };
        
        responseElement.textContent = responses[model] || `Simulated ${model} response for: "${prompt}"`;
        responseElement.className = 'success';
        updateStatusBar(`Text generated (${model} simulation)`);
    }

    // New utility functions for the AI response
    function insertAIResponse() {
        if (editor) {
            const aiResponse = document.getElementById('ai-response').textContent;
            if (aiResponse && !aiResponse.includes('Liquid AI Text Generator')) {
                editor.insert('\n\n' + aiResponse + '\n\n');
                updateStatusBar("AI response inserted into document");
                updateWordCount();
            } else {
                alert('No AI response available to insert. Generate some text first.');
            }
        }
    }

    function copyAIResponse() {
        const aiResponse = document.getElementById('ai-response').textContent;
        if (aiResponse && !aiResponse.includes('Liquid AI Text Generator')) {
            navigator.clipboard.writeText(aiResponse).then(() => {
                updateStatusBar("AI response copied to clipboard");
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy to clipboard');
            });
        } else {
            alert('No AI response available to copy. Generate some text first.');
        }
    }
</script>
</body>
</html>
