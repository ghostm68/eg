<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quantum Wordstar Nexus</title>
    <!-- Library for Local Simulation Fallback -->
    <script src="https://unpkg.com/quantum-circuit@0.9.246/dist/quantum-circuit.min.js"></script>

    <style>
        :root {
            --bg-color: #050505;
            --term-red: #ff2a2a;
            --term-dim: #8f0000;
            --text-white: #eeeeee;
            --glass: rgba(20, 0, 0, 0.8);
            --border-grey: #333333;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-white);
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .container {
            width: 900px;
            padding: 2rem;
            border: 1px solid var(--term-dim);
            background: var(--glass);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.15);
            position: relative;
            z-index: 10;
        }

        /* VISUALIZER CONTAINER */
        .visualizer-frame {
            width: 100%;
            height: 120px;
            border: 1px solid #333;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }

        /* THE QUIRK EMBED */
        /* We invert the colors to make it Dark Mode (Black/Neon) */
        iframe {
            width: 100%;
            height: 200%; /* Taller to hide the bottom toolbar */
            border: none;
            filter: invert(1) hue-rotate(180deg) contrast(1.2);
            transform: translateY(-20px); /* Shift up to hide top menu */
        }

        /* Scanline effect */
        .container::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(255, 255, 255, 0.02), rgba(255, 0, 0, 0.03));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        h1 {
            color: var(--term-red);
            letter-spacing: 5px;
            border-bottom: 2px solid var(--term-red);
            padding-bottom: 10px;
            text-shadow: 0 0 8px var(--term-dim);
            margin-top: 0;
        }

        .blink { animation: blinker 1s linear infinite; color: #fff; }
        @keyframes blinker { 50% { opacity: 0; } }

        .split-display {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            height: 200px;
        }

        .output-screen {
            flex: 2;
            background: #000;
            border: 1px solid var(--border-grey);
            border-left: 3px solid var(--term-red);
            padding: 20px;
            font-size: 1.1rem;
            line-height: 1.5;
            color: var(--text-white);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.9);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .qasm-screen {
            flex: 1;
            background: #080000;
            border: 1px solid var(--term-dim);
            padding: 10px;
            font-size: 0.75rem;
            color: #aa4444;
            font-family: 'Consolas', monospace;
            overflow-y: auto;
            white-space: pre;
            opacity: 0.8;
        }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: var(--term-dim); }

        button {
            background: transparent;
            border: 1px solid var(--term-red);
            color: var(--term-red);
            padding: 10px 30px;
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: bold;
        }

        button:hover {
            background: var(--term-red);
            color: #000;
            box-shadow: 0 0 15px var(--term-red);
        }

        .status {
            font-size: 0.8rem;
            color: #666; 
            margin-top: 15px;
            text-align: right;
            border-top: 1px solid #333;
            padding-top: 5px;
        }
        
        .status span { color: var(--term-red); }
    </style>
</head>
<body>

<div class="container">
    <h1>WORDSTAR <span class="blink">NEXUS</span> // QUANTUM MUSE</h1>
    
    <!-- HEADER METADATA -->
    <div style="display: flex; justify-content: space-between; color: #888; font-size: 0.9rem; margin-bottom: 10px;">
        <span>System Status: <span style="color: var(--text-white)">CONNECTED</span></span>
        <span>Register: <span style="color: var(--text-white)">9 QUBITS</span></span>
    </div>

    <!-- QUIRK VISUALIZER (Live from algassert.com, styled Dark via CSS) -->
    <!-- The URL hash defines 9 H gates and 1 Entanglement -->
    <div class="visualizer-frame">
        <iframe src='https://algassert.com/quirk#circuit={"cols":[["H","H","H","H","H","H","H","H","H"],["•",1,1,1,1,1,1,1,"X"]]}'></iframe>
    </div>

    <!-- MAIN DISPLAY -->
    <div class="split-display">
        <div class="output-screen" id="poem-output">
            Awaiting quantum initialization...<br>
            <span style="color: #444">>> Click COLLAPSE to observe.</span>
        </div>
        <div class="qasm-screen" id="qasm-output">// QASM LOG
Waiting for circuit construction...</div>
    </div>

    <button onclick="runQuantumProcess()">COLLAPSE WAVE FUNCTION</button>

    <div class="status" id="log">
        Tunnel: Secured | Crypto-Source: <span style="color:var(--term-red)">Standby</span>
    </div>
</div>

<script>
    // ============================================
    // 1. CONFIGURATION
    // ============================================
    // Paste your key here. If it's empty, it defaults to simulation.
    const ANU_API_KEY = "PASTE_YOUR_KEY_HERE"; 
    
    const numQubits = 9;

    // ============================================
    // 2. DATASETS (Your Expanded Lists)
    // ============================================
    const openers = [
        "In the silence of the neon void,", "Fragments of a lost memory,", "Digital ghosts whisper softly,",
        "Under the weight of a dying sun,", "Between the static and the signal,", "The sky was the color of a dead channel,",
        "Reflections in the obsidian glass,", "Upon the edge of the event horizon,", "A glitch in the fabric of morning,"
    ];

    const middles = [
        "entropy dissolves the concrete,", "wires tangle with human veins,", "the algorithm learns to weep,",
        "time fractures into binary dust,", "the logic gates slam shut,", "a heartbeat echoes in the server room,",
        "shadows stretch across the motherboard,", "data streams bleed into the rain,", "silence overwrites the protocol,"
    ];

    const closers = [
        "seeking a signal that never comes.", "fading into absolute zero.", "dreaming of electric sleep.",
        "waiting for the reboot.", "lost in the infinite loop.", "until the power fails.",
        "becoming one with the noise.", "erasing the user history.", "terminating the session."
    ];

    // ============================================
    // 3. MAIN LOGIC (Hybrid API + Sim)
    // ============================================
    async function runQuantumProcess() {
        const poemDisplay = document.getElementById('poem-output');
        const qasmDisplay = document.getElementById('qasm-output');
        const statusLog = document.getElementById('log');

        poemDisplay.innerHTML = `<span class="blink">Collapsing wave function...</span>`;

        let seedValue = 0;
        let sourceLabel = "";
        let binaryString = "";

        try {
            // STEP A: Try to get Real Quantum Numbers (ANU)
            if (!ANU_API_KEY || ANU_API_KEY === "PASTE_YOUR_KEY_HERE") {
                throw new Error("No Key");
            }

            // Note: ANU V2 API call
            const response = await fetch('https://api.quantumnumbers.anu.edu.au/api/v1/quantum/rand_uint8?length=1&type=uint8', {
                headers: { 'x-api-key': ANU_API_KEY }
            });

            if (!response.ok) throw new Error("API Blocked");

            const data = await response.json();
            seedValue = data.data[0]; // The real quantum number (0-255)
            
            // Convert to binary for display (pad to 9 bits roughly)
            binaryString = seedValue.toString(2).padStart(9, '0');
            sourceLabel = "ANU QUANTUM VACUUM";

        } catch (error) {
            // STEP B: Fallback to Local Simulation
            console.log("Using Local Simulation due to:", error.message);
            
            var circuit = new QuantumCircuit(numQubits);
            for(let i = 0; i < numQubits; i++) { circuit.addGate("h", i, i); }
            circuit.addGate("cx", numQubits-1, [0, numQubits-1]); 
            circuit.run();
            
            const measurement = circuit.measureAll(); 
            binaryString = measurement.join('');
            seedValue = parseInt(binaryString, 2);
            
            // Generate QASM for the right panel
            const rawQASM = circuit.exportToQASM();
            qasmDisplay.innerText = "// OPENQASM 2.0 (9-Qubit Register)\n" + rawQASM;
            
            sourceLabel = "LOCAL SIMULATION CLUSTER";
        }

        // STEP C: Construct Poem
        // We use offsets to get 3 unique lines from 1 seed
        let idx1 = seedValue;
        let idx2 = seedValue + 15; 
        let idx3 = seedValue + 30; 

        let line1 = openers[idx1 % openers.length];
        let line2 = middles[idx2 % middles.length];
        let line3 = closers[idx3 % closers.length];

        // STEP D: Update UI
        poemDisplay.innerHTML = `
            <div style="margin-bottom: 2rem;">
                ${line1}<br>
                ${line2}<br>
                ${line3}
            </div>

            <!-- TECHNICAL FOOTER -->
            <div style="border-top: 1px dashed #333; padding-top: 10px; font-size: 0.8rem; font-family: 'Consolas', monospace; color: #666;">
                <span style="color: var(--term-red);">>> SOURCE:</span> ${sourceLabel}<br>
                <span>>> VECTOR:</span> |${binaryString}⟩<br>
                <span>>> SEED:</span> ${seedValue}
            </div>
        `;

        statusLog.innerHTML = `Tunnel: Secured | Entropy: <span style="color:var(--term-red)">${sourceLabel}</span>`;
    }
</script>

</body>
</html>
