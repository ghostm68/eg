<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quantum Wordstar Nexus</title>
    <!-- Library for Local Quantum Simulation -->
    <script src="https://unpkg.com/quantum-circuit@0.9.246/dist/quantum-circuit.min.js"></script>

  <style>
        :root {
            --bg-color: #050505;
            --term-red: #ff2a2a;
            --term-dim: #8f0000;
            --text-white: #eeeeee;
            --glass: rgba(20, 0, 0, 0.8);
            --border-grey: #333333;
        }

        /* --- THE MAGIC HIGHLIGHT FIX --- */
        /* This makes selected text RED instead of Blue */
        ::selection {
            background: var(--term-red);
            color: #000;
        }
        ::-moz-selection {
            background: var(--term-red);
            color: #000;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-white);
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .container {
            width: 900px;
            padding: 2rem;
            border: 1px solid var(--term-dim);
            background: var(--glass);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.15);
            position: relative;
            z-index: 10;
        }

        /* Scanlines */
        .container::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(255, 255, 255, 0.02), rgba(255, 0, 0, 0.03));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* --- EDITOR STYLES (Replaces Iframe Styles) --- */
        .article-header {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        article {
            display: block;
            width: 100%;
            height: 120px;
            background-color: #080000; /* Darker black for input */
            border: 1px solid #333;
            border-left: 2px solid var(--term-red); /* The Red Stripe */
            color: var(--text-white);
            padding: 15px;
            box-sizing: border-box;
            overflow-y: auto;
            outline: none;
            white-space: pre-wrap; 
            font-size: 0.95rem;
            line-height: 1.4;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        article:focus {
            border-color: var(--term-red);
            background-color: #0c0000;
            box-shadow: inset 0 0 15px rgba(255, 42, 42, 0.05);
        }

        /* Editor Scrollbar */
        article::-webkit-scrollbar { width: 8px; }
        article::-webkit-scrollbar-track { background: #000; }
        article::-webkit-scrollbar-thumb { background: var(--term-dim); }

        /* --- REST OF THE UI --- */
        h1 {
            color: var(--term-red);
            letter-spacing: 5px;
            border-bottom: 2px solid var(--term-red);
            padding-bottom: 10px;
            text-shadow: 0 0 8px var(--term-dim);
            margin-top: 0;
        }

        .blink { animation: blinker 1s linear infinite; color: #fff; }
        @keyframes blinker { 50% { opacity: 0; } }

        .split-display {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            height: 180px;
        }

        .output-screen {
            flex: 2;
            background: #000;
            border: 1px solid var(--border-grey);
            border-left: 3px solid var(--term-red);
            padding: 20px;
            font-size: 1.1rem;
            line-height: 1.5;
            color: var(--text-white);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.9);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .qasm-screen {
            flex: 1;
            background: #080000;
            border: 1px solid var(--term-dim);
            padding: 10px;
            font-size: 0.75rem;
            color: #aa4444;
            font-family: 'Consolas', monospace;
            overflow-y: auto;
            white-space: pre;
            opacity: 0.8;
        }

        button {
            background: transparent;
            border: 1px solid var(--term-red);
            color: var(--term-red);
            padding: 10px 30px;
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: bold;
        }

        button:hover {
            background: var(--term-red);
            color: #000;
            box-shadow: 0 0 15px var(--term-red);
        }

        .status {
            font-size: 0.8rem;
            color: #666; 
            margin-top: 15px;
            text-align: right;
            border-top: 1px solid #333;
            padding-top: 5px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>WORDSTAR <span class="blink">NEXUS</span> // QUANTUM MUSE</h1>
    
    <!-- SYSTEM INFO -->
    <div style="display: flex; justify-content: space-between; color: #888; font-size: 0.9rem; margin-bottom: 15px;">
        <span>System Status: <span style="color: var(--text-white)">CONNECTED</span></span>
        <span>Register: <span style="color: var(--text-white)">9 QUBITS</span></span>
    </div>

    <!-- NEW LIVE EDITOR (Replaces Iframe) -->
    <div class="article-header">
        <span>>> INPUT BUFFER (URL_ENCODED)</span>
        <span>AUTO-SAVE: ACTIVE</span>
    </div>
    <article contenteditable="plaintext-only" spellcheck="false"></article>

    <!-- POETRY OUTPUT -->
    <div class="split-display">
        <div class="output-screen" id="poem-output">
            Awaiting quantum initialization...<br>
            <span style="color: #444">>> Click COLLAPSE to observe.</span>
        </div>
        <div class="qasm-screen" id="qasm-output">// QASM LOG
Waiting for circuit construction...</div>
    </div>

    <button onclick="runQuantumProcess()">COLLAPSE WAVE FUNCTION</button>

    <div class="status" id="log">
        Tunnel: Secured | Crypto-Source: <span style="color:var(--term-red)">Standby</span>
    </div>
</div>

<!-- SCRIPT 1: EDITOR LOGIC (URL HASH SAVE) -->
<script>
(function() {
    const article = document.querySelector('article');
    if (!article) return;

    // Optional: Default text if empty
    if(!location.hash && !localStorage.getItem('article-hash')) {
        article.textContent = "Waiting for input...\nType here to store data in the URL hash.";
    }

    // Event listeners
    article.addEventListener('input', debounce(500, saveArticle));
    window.addEventListener('DOMContentLoaded', loadArticle);
    window.addEventListener('hashchange', loadArticle);

    // Load article from URL or localStorage
    async function loadArticle() {
        try {
            if (location.hash !== '') {
                await setArticle(location.hash);
            } else {
                const saved = localStorage.getItem('article-hash');
                if (saved) await setArticle(saved);
            }
            updateArticleTitle();
        } catch (e) {
            console.log('No article loaded');
        }
    }

    // Save article to URL and localStorage
    async function saveArticle() {
        const hash = await getArticleHash();
        if (location.hash !== hash) {
            history.replaceState({}, '', hash);
        }
        try { 
            localStorage.setItem('article-hash', hash);
        } catch (e) {}
        updateArticleTitle();
    }

    // Set article content from hash
    async function setArticle(hash) {
        const content = await decompressArticle(hash.slice(1));
        article.textContent = content;
    }

    // Get hash from article content
    async function getArticleHash() {
        const content = article.textContent;
        return '#' + await compressArticle(content);
    }

    // Update page title from article
    function updateArticleTitle() {
        const match = article.textContent.match(/^\n*#(.+)\n/);
        if (match) document.title = `${match[1]} - INK REALM`;
    }

    // Compress article content
    async function compressArticle(string) {
        const byteArray = new TextEncoder().encode(string);
        const stream = new CompressionStream('deflate-raw');
        const writer = stream.writable.getWriter();
        writer.write(byteArray);
        writer.close();
        const buffer = await new Response(stream.readable).arrayBuffer();
        return btoa(String.fromCharCode(...new Uint8Array(buffer)))
            .replace(/\+/g, "-").replace(/\//g, "_").replace(/=/g, "");
    }

    // Decompress article content
    async function decompressArticle(b64) {
        const byteArray = Uint8Array.from(
            atob(b64.replace(/-/g, "+").replace(/_/g, "/")), 
            c => c.charCodeAt(0)
        );
        const stream = new DecompressionStream('deflate-raw');
        const writer = stream.writable.getWriter();
        writer.write(byteArray);
        writer.close();
        const buffer = await new Response(stream.readable).arrayBuffer();
        return new TextDecoder().decode(buffer);
    }

    // Debounce helper
    function debounce(ms, fn) {
        let timer;
        return (...args) => {
            clearTimeout(timer);
            timer = setTimeout(() => fn(...args), ms);
        };
    }
})();
</script>

<!-- SCRIPT 2: QUANTUM GENERATOR LOGIC -->
<script>
    // Config
    const ANU_API_KEY = "PASTE_YOUR_KEY_HERE"; 
    const numQubits = 9;

    // Datasets
    const openers = [
        "In the silence of the neon void,", "Fragments of a lost memory,", "Digital ghosts whisper softly,",
        "Under the weight of a dying sun,", "Between the static and the signal,", "The sky was the color of a dead channel,",
        "Reflections in the obsidian glass,", "Upon the edge of the event horizon,", "A glitch in the fabric of morning,"
    ];

    const middles = [
        "entropy dissolves the concrete,", "wires tangle with human veins,", "the algorithm learns to weep,",
        "time fractures into binary dust,", "the logic gates slam shut,", "a heartbeat echoes in the server room,",
        "shadows stretch across the motherboard,", "data streams bleed into the rain,", "silence overwrites the protocol,"
    ];

    const closers = [
        "seeking a signal that never comes.", "fading into absolute zero.", "dreaming of electric sleep.",
        "waiting for the reboot.", "lost in the infinite loop.", "until the power fails.",
        "becoming one with the noise.", "erasing the user history.", "terminating the session."
    ];

    async function runQuantumProcess() {
        const poemDisplay = document.getElementById('poem-output');
        const qasmDisplay = document.getElementById('qasm-output');
        const statusLog = document.getElementById('log');

        poemDisplay.innerHTML = `<span class="blink">Collapsing wave function...</span>`;

        let seedValue = 0;
        let sourceLabel = "";
        let binaryString = "";

        try {
            // Try Real Quantum API
            if (!ANU_API_KEY || ANU_API_KEY === "pqp6gSBSycaEhZ45uSWYH4fMd5xU5ZBn3Jgu1fGQ") { throw new Error("No Key"); }

            const response = await fetch('https://api.quantumnumbers.anu.edu.au/api/v1/quantum/rand_uint8?length=1&type=uint8', {
                headers: { 'x-api-key': ANU_API_KEY }
            });
            if (!response.ok) throw new Error("API Blocked");

            const data = await response.json();
            seedValue = data.data[0];
            binaryString = seedValue.toString(2).padStart(9, '0');
            sourceLabel = "ANU QUANTUM VACUUM";

        } catch (error) {
            // Fallback to Simulation
            var circuit = new QuantumCircuit(numQubits);
            for(let i = 0; i < numQubits; i++) { circuit.addGate("h", i, i); }
            circuit.addGate("cx", numQubits-1, [0, numQubits-1]); 
            circuit.run();
            const measurement = circuit.measureAll(); 
            binaryString = measurement.join('');
            seedValue = parseInt(binaryString, 2);
            
            const rawQASM = circuit.exportToQASM();
            qasmDisplay.innerText = "// OPENQASM 2.0 (9-Qubit Register)\n" + rawQASM;
            sourceLabel = "LOCAL SIMULATION CLUSTER";
        }

        // Generate Poem
        let idx1 = seedValue;
        let idx2 = seedValue + 15; 
        let idx3 = seedValue + 30; 

        let line1 = openers[idx1 % openers.length];
        let line2 = middles[idx2 % middles.length];
        let line3 = closers[idx3 % closers.length];

        poemDisplay.innerHTML = `
            <div style="margin-bottom: 2rem;">
                ${line1}<br>
                ${line2}<br>
                ${line3}
            </div>
            <div style="border-top: 1px dashed #333; padding-top: 10px; font-size: 0.8rem; font-family: 'Consolas', monospace; color: #666;">
                <span style="color: var(--term-red);">>> SOURCE:</span> ${sourceLabel}<br>
                <span>>> VECTOR:</span> |${binaryString}‚ü©<br>
                <span>>> SEED:</span> ${seedValue}
            </div>
        `;

        statusLog.innerHTML = `Tunnel: Secured | Entropy: <span style="color:var(--term-red)">${sourceLabel}</span>`;
    }
</script>

</body>
</html>
