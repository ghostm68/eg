<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>displayWRITERtwo</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
         <style>
/* === DEFINE VARIABLES FIRST === */
:root {
    --red: #ff0033;
    --black: #0a0a0a;
}

/* === NOW selection can use them === */
::selection {
    background: var(--red);
    color: var(--black);
    text-shadow: none;
}
</style>
<style>
:root{
  --bg:#050000;
  --paper:#ffcccc;
  --dim:#884444;
  --iron:#4a2a2a;
  --blood:#ff0000;
  --shadow:#1a0000;
  --crt-glow:rgba(255,0,0,.15);
  --ai-green:#ccffcc;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }

body{
  margin:0;
  /* dvh ensures the mobile address bar doesn't cut off the footer */
  height:100vh;
  height:100dvh;
  display:flex;
  flex-direction:column;
  font-family:'VT323',monospace;
  font-size:24px;
  background:var(--bg);
  color:var(--paper);
  overflow:hidden;
  text-shadow:0 0 2px var(--dim),0 0 5px var(--crt-glow);
  position:relative;
}

/* CRT Scanlines */
body::after{
  content:"";
  position:absolute;
  inset:0;
  background:repeating-linear-gradient(0deg,transparent 0 2px,rgba(0,0,0,.5) 3px 4px),repeating-linear-gradient(90deg,var(--crt-glow),transparent 2px,rgba(0,0,0,.1) 4px);
  pointer-events:none;
  z-index:100;
  mix-blend-mode:multiply;
}

#header-band{
  flex:0 0 30px;
  background:var(--iron);
  color:var(--bg);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 12px;
  text-transform:uppercase;
  font-weight:bold;
  letter-spacing:1px;
  border-bottom:2px solid var(--blood);
  z-index:10;
}

#edit-block{ flex:0 0 auto; padding:8px 12px; border-bottom:1px solid var(--dim); background:var(--bg); }

.dos-box{ border:2px solid var(--dim); position:relative; padding:10px 8px; margin:0; }
.dos-box legend{ position:absolute; top:-12px; left:50%; transform:translateX(-50%); background:var(--bg); padding:0 6px; color:var(--blood); font-weight:bold; white-space:nowrap; }

.menu-grid{ display:flex; gap:20px; justify-content:center; font-size:1rem; flex-wrap:wrap; }

.cmd{ cursor:pointer; transition:color .2s; padding:2px 5px; }
.cmd:hover{ color:var(--blood); text-shadow:0 0 8px var(--blood); }
.cmd:active{ background:var(--blood); color:var(--bg); }
.cmd span{ font-weight:bold; color:var(--blood); margin-right:4px; }
.cmd:active span{ color:var(--bg); }

#ruler{
  flex:0 0 20px;
  padding:0 12px;
  color:var(--dim);
  white-space:pre;
  overflow:hidden;
  border-bottom:1px solid var(--iron);
  transition:border-bottom-color .15s;
}

#viewport{
  flex:1 1 auto;
  padding:15px 12px;
  font-size:24px;
  line-height:1.4;
  overflow-y:auto;
  outline:none;
  cursor:text;
  animation:textFlicker .1s infinite;
  caret-color: var(--blood);
}
@keyframes textFlicker{ 0%,100%{opacity:.99;} 50%{opacity:.97;} }

#viewport:focus{ background: rgba(20,0,0,0.15); }
#viewport b, #viewport strong { color:var(--blood); font-weight:normal; text-shadow:0 0 4px var(--blood); }
#viewport u, #viewport ins { text-decoration:none; border-bottom:2px solid var(--blood); }

#f-key-strip{
  flex:0 0 50px;
  display:flex;
  background:var(--shadow);
  border-top:1px solid var(--blood);
  border-bottom:1px solid var(--blood);
  z-index:10;
  overflow-x: auto;
  scrollbar-width: none;
}
#f-key-strip::-webkit-scrollbar { display: none; }

.f-key{
  flex:1 0 auto;
  min-width: 80px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  border-right:1px solid var(--iron);
  cursor:pointer;
  transition:.1s;
  font-size:18px;
  line-height:1;
}
.f-key:hover{ background:var(--iron); color:var(--paper); }
.f-key:active{ background:var(--blood); color:var(--bg); }
.f-key b{ margin-bottom:2px; color:var(--paper); }

#info-line{
  flex:0 0 24px;
  background:var(--iron);
  color:var(--bg);
  text-align:right;
  padding:0 12px;
  font-size:.8rem;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:15px;
  white-space:nowrap;
}
#info-line span{ color:var(--paper); font-weight:bold; }
.online{ background:var(--blood); color:var(--bg); padding:0 4px; }

/* AI MODAL */
#mode-indicator{ cursor:pointer; transition:all 0.2s; padding:2px 5px; }
#mode-indicator:hover{ text-shadow:0 0 8px var(--blood); color:var(--paper); }

#ai-overlay{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:1000; backdrop-filter:blur(2px); }
#ai-modal{
  display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  width:95%; max-width:600px; max-height:85vh;
  background:var(--bg); border:2px solid var(--blood);
  z-index:1001; box-shadow:0 0 50px rgba(255,0,0,0.3);
  font-family:'VT323',monospace; flex-direction:column;
}
.ai-header{ background:var(--blood); color:var(--bg); padding:10px 15px; display:flex; justify-content:space-between; align-items:center; font-weight:bold; }
.ai-body{ padding:20px; color:var(--paper); overflow-y:auto; flex:1; }
.ai-input-group{ margin-bottom:15px; }
.ai-input-group label{ display:block; margin-bottom:5px; color:var(--dim); font-size:0.9rem; }
.ai-input-group input, .ai-input-group textarea{
  width:100%; padding:10px; background:rgba(30,0,0,0.5); border:1px solid var(--dim);
  color:var(--paper); font-family:'VT323',monospace; font-size:1.1rem; border-radius:0;
}
.ai-input-group input:focus, .ai-input-group textarea:focus{ outline:none; border-color:var(--blood); background:rgba(50,0,0,0.8); }
#aiOutput{ min-height:100px; background:#050505; border:1px solid #a8a3a4; border-left:3px solid #d9c7c7; padding:10px; color:var(--ai-green); white-space:pre-wrap; font-size:1rem; }
.ai-btn-row{ padding:15px; border-top:1px solid var(--iron); background:var(--shadow); display:flex; justify-content:flex-end; gap:10px; }
.ai-btn{ background:var(--iron); color:var(--paper); border:1px solid var(--dim); padding:10px 20px; font-family:'VT323',monospace; font-size:1.2rem; cursor:pointer; }
.ai-btn:hover{ background:var(--dim); color:white; }
.ai-btn.primary{ background:var(--blood); color:var(--bg); border-color:var(--blood); }

/* MOBILE */
@media (max-width: 768px) {
  body, #viewport { font-size: 20px; }
  .menu-grid { gap: 10px; justify-content: space-between; }
  .cmd { font-size: 0.9rem; flex: 1 0 40%; text-align: center; border: 1px solid var(--iron); }
  #ruler { display: none; }
  #f-key-strip { height: 60px; padding-bottom: env(safe-area-inset-bottom); }
  .f-key { min-width: 65px; font-size: 16px; }
}
</style>
</head>
<body>

<!-- AI MODAL -->
<div id="ai-overlay"></div>
<div id="ai-modal">
    <div class="ai-header">
        <span>ðŸ¤–9b-v2</span>
        <button id="closeAiBtn" style="background:transparent;border:none;color:var(--bg);font-size:1.5em;line-height:1;">&times;</button>
    </div>
    <div class="ai-body">
        <div class="ai-input-group">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <label>API KEY:</label>
                <a href="https://build.nvidia.com" target="_blank" style="color:var(--dim);text-decoration:none;">[GET KEY]</a>
            </div>
            <input type="password" id="nvidiaKey" placeholder="nvapi-...">
        </div>
        <div class="ai-input-group">
            <label>PROMPT:</label>
            <textarea id="aiPrompt" placeholder="Describe the neon rain..." rows="3"></textarea>
        </div>
        <div class="ai-input-group">
            <label>OUTPUT:</label>
            <div id="aiOutput">System Ready.</div>
        </div>
    </div>
    <div class="ai-btn-row">
        <button id="cancelAiBtn" class="ai-btn">CANCEL</button>
        <button id="genBtn" class="ai-btn primary">GENERATE</button>
    </div>
</div>

<!-- MAIN APP -->
<div id="header-band">
  <span>C:\QUANTUM.DOC</span>
  <span id="status-readout">L:01 C:01</span>
  <span id="mode-indicator">INSERT | AI MENU</span>
</div>

<div id="edit-block">
  <fieldset class="dos-box">
    <legend>â‰¡ DSTWO â‰¡</legend>
    <div class="menu-grid">
      <div class="cmd prevent-focus" data-fkey="F1"><span>F1</span>GEN</div>
      <div class="cmd prevent-focus" data-fkey="F2"><span>F2</span>HEX</div>
      <div class="cmd prevent-focus" data-fkey="F3"><span>F3</span>SAVE</div>
      <div class="cmd prevent-focus" data-fkey="F6"><span>F6</span>BOLD</div>
    </div>
  </fieldset>
</div>

<div id="ruler">Lâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€R</div>

<div id="viewport" contenteditable="true" spellcheck="false">Initializing Quantum Core...<br>Ready for Input. Gen/F1 qUANTUM cUTs 'a horse struck down by lightning'<br><br>Use as notepad type, exports html- Select, F6 for <b>BOLD</b>.<br>Click TOP RIGHT for AI (responses auto-import into notes...</div>

<div id="f-key-strip">
  <div class="f-key prevent-focus" data-fkey="F1"><b>F1</b><small>GEN</small></div>
  <div class="f-key prevent-focus" data-fkey="F2"><b>F2</b><small>HEX</small></div>
  <div class="f-key prevent-focus" data-fkey="F3"><b>F3</b><small>DISK</small></div>
  <div class="f-key prevent-focus" data-fkey="F4"><b>F4</b><small>PRNT</small></div>
  <div class="f-key prevent-focus" data-fkey="F5"><b>F5</b><small>CLR</small></div>
  <div class="f-key prevent-focus" data-fkey="F6"><b>F6</b><small>BOLD</small></div>
  <div class="f-key prevent-focus" data-fkey="F7"><b>F7</b><small>UNDR</small></div>
  <div class="f-key prevent-focus" data-fkey="F8"><b>F8</b><small>FIND</small></div>
  <div class="f-key prevent-focus" data-fkey="F9"><b>F9</b><small>HELP</small></div>
  <div class="f-key prevent-focus" data-fkey="F10"><b>F10</b><small>BOOT</small></div>
</div>

<div id="info-line">
  Quantum DisplayWriter 370 | Mem: 640K | <span id="entropy-source">INIT...</span>
</div>

<script>
/* ---------- AUDIO ---------- */
let audioCtx = null;
function initAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if (audioCtx.state === 'suspended') audioCtx.resume();
}
function beep(freq=880, type='square', dur=0.05) {
  if (!audioCtx) initAudio();
  if (audioCtx && audioCtx.state === 'running') {
    try {
      const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
      o.type = type; o.frequency.value = freq;
      o.connect(g); g.connect(audioCtx.destination);
      o.start(); g.gain.setValueAtTime(0.05, audioCtx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
      o.stop(audioCtx.currentTime + dur);
    } catch(e){}
  }
}

/* ---------- CORE LOGIC ---------- */
const VIEWPORT = document.getElementById('viewport');
const STATUS = document.getElementById('status-readout');
let liveLex = null;

// The "Prevent Focus" logic - CRITICAL for Bold/Underline buttons
document.querySelectorAll('.prevent-focus').forEach(el => {
    const handleStart = (e) => {
        e.preventDefault(); 
        const fkey = el.getAttribute('data-fkey');
        if(fkey) triggerFKey(fkey);
    };
    el.addEventListener('mousedown', handleStart);
    el.addEventListener('touchstart', handleStart);
});

function cmd(command) {
    document.execCommand(command, false, null);
    VIEWPORT.focus();
    updateUI();
}

function triggerFKey(k) {
  beep(880, 'square');
  VIEWPORT.focus();
  switch(k) {
    case 'F1': generate(); break;
    case 'F2': collapse(); break;
    case 'F3': saveFile(); break;
    case 'F4': window.print(); break;
    case 'F5': if(confirm('PURGE BUFFER?')) VIEWPORT.innerHTML = ''; break;
    case 'F6': cmd('bold'); break;
    case 'F7': cmd('underline'); break;
    case 'F8': {const s=prompt('SEARCH:'); if(s) window.find(s);} break;
    case 'F9': alert('F1-F10: Commands\nRight Corner: AI Menu\nSelect text for BOLD/UNDERLINE'); break;
    case 'F10': location.reload(); break;
  }
}

/* ---------- AI LOGIC (NEMOTRON) ---------- */
const aiModal = document.getElementById('ai-modal');
const aiOverlay = document.getElementById('ai-overlay');
const aiOut = document.getElementById('aiOutput');
const genBtn = document.getElementById('genBtn');

function openAI() {
    beep(1200, 'sine');
    aiModal.style.display = 'flex'; aiOverlay.style.display = 'block';
    const k = localStorage.getItem('quantum_nvidia_key');
    if(k) document.getElementById('nvidiaKey').value = k;
}
function closeAI() {
    aiModal.style.display = 'none'; aiOverlay.style.display = 'none';
    VIEWPORT.focus();
}

document.getElementById('mode-indicator').addEventListener('click', openAI);
document.getElementById('closeAiBtn').addEventListener('click', closeAI);
document.getElementById('cancelAiBtn').addEventListener('click', closeAI);
document.getElementById('ai-overlay').addEventListener('click', closeAI);

genBtn.addEventListener('click', async () => {
    const key = document.getElementById('nvidiaKey').value.trim();
    const prompt = document.getElementById('aiPrompt').value.trim();
    
    if(!key) { aiOut.textContent = ">>> ERR: MISSING KEY"; return; }
    if(!prompt) { aiOut.textContent = ">>> ERR: MISSING PROMPT"; return; }
    
    localStorage.setItem('quantum_nvidia_key', key);
    genBtn.disabled = true; genBtn.textContent = "PROCESSING...";
    aiOut.textContent = ">>> UPLINKING TO NEMOTRON-NANO...";
    
    try {
        const proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent('https://integrate.api.nvidia.com/v1/chat/completions');
        const res = await fetch(proxyUrl, {
            method: 'POST',
            headers: { 'Authorization': 'Bearer '+key, 'Content-Type': 'application/json' },
            body: JSON.stringify({
                model: "nvidia/nvidia-nemotron-nano-9b-v2",
                messages: [{role: "system", content: "You are a creative writing assistant."}, {role: "user", content: prompt}],
                temperature: 0.5, top_p: 1, max_tokens: 512, stream: false
            })
        });
        
        const data = await res.json();
        if(data.error) throw new Error(data.error.message);
        
        let txt = data.choices?.[0]?.message?.content || "[NO_DATA]";
        aiOut.textContent = ">>> RECEIVED:\n" + txt;
        
        VIEWPORT.focus();
        document.execCommand('insertHTML', false, `<br><br><b>[AI]</b> ${txt}<br>`);
        beep(1200, 'sine');
    } catch(e) {
        aiOut.textContent = ">>> FAIL: " + e.message;
        beep(200, 'sawtooth');
    } finally {
        genBtn.disabled = false; genBtn.textContent = "GENERATE";
    }
});

/* ---------- GENERATOR ---------- */
const FB = {
  nouns: ["nebula","echo","whisper","chronometer","void","nexus","fragment","signal","horizon","monolith","algorithm","spectre","isotope","vortex","cipher","drone","glitch","network","phantom","mainframe","reactor","synapse","artifact","shard","memory","paradox","entropy","vector","protocol","silence","shadow","circuit"],
  verbs: ["fractured","hummed","collapsed","drifted","ignited","observed","shattered","pulsed","dissolved","encoded","transmitted","erased","aligned","resonated","orbited","scanned","corrupted","merged","decoded","manifested","echoed","vibrated","locked","severed","mapped","synced","traced","hunted","breached","calibrated","awoke","slept"],
  adjs: ["silent","obsidian","infinite","hollow","electric","forgotten","crimson","static","digital","frozen","luminous","fractal","haunted","cybernetic","terminal","kinetic","dormant","volatile","synthetic","solar","magnetic","spectral","unseen","ancient","liquid","binary","nuclear","astral","chrome","velvet","fading","hidden"]
};

function generate() {
  const words = liveLex || FB.nouns;
  const n = words[Math.floor(Math.random()*words.length)];
  const v = FB.verbs[Math.floor(Math.random()*FB.verbs.length)];
  const a = FB.adjs[Math.floor(Math.random()*FB.adjs.length)];
  document.execCommand('insertHTML', false, ` The <b>${a}</b> ${n} <u>${v}</u>. `);
  updateUI();
}
function collapse() {
  const entropyTypes = [
    // 1. HEX Format (Original)
    () => {
      const hex = [...Array(6)].map(() => 
        Math.floor(Math.random() * 255).toString(16).padStart(2, '0')
      ).join(':');
      return `[ENTROPY:${hex.toUpperCase()}]`;
    },
    
    // 2. Binary String
    () => {
      const binary = [...Array(24)].map(() => 
        Math.random() > 0.5 ? '1' : '0'
      ).join('');
      return `[BITSTREAM:${binary.match(/.{1,8}/g).join(' ')}]`;
    },
    
    // 3. Quantum State Notation
    () => {
      const amps = ['Î±','Î²','Î³','Î´','Îµ','Î¶','Î·','Î¸'];
      const state = `|ÏˆâŸ© = ${(Math.random()*0.9+0.1).toFixed(3)}|0âŸ© + ${(Math.random()*0.9+0.1).toFixed(3)}|1âŸ©`;
      return `[QSTATE:${state}]`;
    },
    
    // 4. DNA-like Sequence
    () => {
      const bases = ['A','T','C','G','X','Î¨','Î©','Î¦'];
      const seq = [...Array(12)].map(() => 
        bases[Math.floor(Math.random() * bases.length)]
      ).join('');
      return `[SEQUENCE:${seq}]`;
    },
    
    // 5. Timestamp Entropy
    () => {
      const now = new Date();
      const ms = now.getMilliseconds().toString().padStart(3, '0');
      const entropy = parseInt(ms) ^ now.getSeconds();
      return `[TIMESTAMP:${now.getHours().toString().padStart(2,'0')}:${now.getMinutes()}:${ms} Î”=${entropy}]`;
    },
    
    // 6. Symbolic Entropy
    () => {
      const symbols = ['Â§','Â¶','â€ ','â€¡','â—Š','âŒ˜','âŒ€','âŒ‚','âŒ¥','âŒ«','âŽ‹','âŽ'];
      const sym = [...Array(8)].map(() => 
        symbols[Math.floor(Math.random() * symbols.length)]
      ).join('');
      return `[SYMBOLS:${sym}]`;
    },
    
    // 7. Word-based Entropy (using your word lists!)
    () => {
      const nouns = liveLex || FB.nouns;
      const verbs = FB.verbs;
      const adjs = FB.adjs;
      const n = quantumChoice(nouns);
      const v = quantumChoice(verbs);
      const a = quantumChoice(adjs);
      return `[LEXICAL:${n}:${v}:${a}]`;
    },
    
    // 8. Pi-based Entropy
    () => {
      const pi = Math.PI.toString().replace('.','');
      const start = Math.floor(Math.random() * (pi.length - 6));
      return `[PI-DIGITS:${pi.substring(start, start+6)}]`;
    }
  ];
  
  // Choose a random entropy type
  const type = Math.floor(Math.random() * entropyTypes.length);
  const entropy = entropyTypes[type]();
  
  // Insert with styling
  VIEWPORT.focus();
  document.execCommand('insertHTML', false, 
    `<br><span style="background:var(--blood);color:var(--bg);font-family:monospace">${entropy}</span><br>`
  );
}
function saveFile() {
  const html = `<!DOCTYPE html><html><body style="background:#000;color:#fcc;font-family:monospace;white-space:pre-wrap;">${VIEWPORT.innerHTML}</body></html>`;
  const blob = new Blob([html], {type: 'text/html'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'quantum_doc.html'; a.click();
}
function updateUI() {
    const t = VIEWPORT.innerText||"";
    STATUS.textContent = `L:${String(t.split('\n').length).padStart(2,'0')} C:${String(t.length).padStart(4,'0')}`;
}

/* ---------- BOOT ---------- */
VIEWPORT.addEventListener('input', updateUI);
VIEWPORT.addEventListener('click', updateUI);
document.addEventListener('keydown', e => {
    initAudio();
    if(e.key.match(/^F([1-9]|10)$/)) { e.preventDefault(); triggerFKey(e.key); }
});

(async()=>{
  VIEWPORT.focus();
  try {
    const r = await fetch('https://raw.githubusercontent.com/ghostm68/eg/refs/heads/main/horse.txt');
    if(r.ok) {
        const t = await r.text();
        liveLex = [...new Set(t.toLowerCase().match(/\b[a-z]{5,}\b/g))];
        document.getElementById('entropy-source').innerHTML = '<span class="online">ONLINE</span>';
        document.getElementById('mode-indicator').classList.add('online');
    }
  } catch(e) { document.getElementById('entropy-source').textContent = 'OFFLINE'; }
})();
</script>
</body>
</html>
