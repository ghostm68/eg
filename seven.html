<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WordStar Nexus: Original Architecture</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

<style>
  :root {
    --bg-color: #050505;
    --panel-bg: #111;
    --text-color: #b0b0b0;
    --accent-red: #cc0000;
    --border-color: #333;
  }

  body, html {
    margin: 0;
    padding: 0;
    font-family: 'VT323', monospace;
    background-color: var(--bg-color);
    color: var(--text-color);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Universal Scrollbar */
  ::-webkit-scrollbar { width: 10px; }
  ::-webkit-scrollbar-track { background: #000; }
  ::-webkit-scrollbar-thumb { background: #333; border: 1px solid #000; }
  ::-webkit-scrollbar-thumb:hover { background: var(--accent-red); }

  /* CRT Overlay */
  .crt::before {
    content: " ";
    display: block;
    position: absolute;
    top: 0; left: 0; bottom: 0; right: 0;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
    z-index: 999;
    background-size: 100% 2px, 3px 100%;
    pointer-events: none;
  }

  /* --- SECTION 1: TOP COMMAND BAR --- */
  #top-bar {
    background-color: var(--panel-bg);
    padding: 5px 10px;
    display: flex;
    justify-content: space-between; /* Spread them out nicely */
    border-bottom: 1px solid var(--accent-red);
    font-size: 1.1rem;
  }
  
  .menu-btn {
    cursor: pointer;
    padding: 2px 8px;
    border: 1px solid transparent;
  }
  .menu-btn:hover {
    background-color: var(--accent-red);
    color: #000;
  }
  .shortcut-key { color: var(--accent-red); margin-right: 4px; }
  .menu-btn:hover .shortcut-key { color: #000; }

  /* --- SECTION 2: EDITOR --- */
  #editor-container {
    flex-grow: 1;
    position: relative;
    background-color: #000;
    display: flex;
    flex-direction: column;
  }

  #ruler {
    display: flex;
    background: #080808;
    color: #444;
    font-size: 1rem;
    padding: 2px 0;
    border-bottom: 1px dashed #222;
  }

  #editor {
    flex-grow: 1;
    background-color: transparent;
    color: #ccc;
    border: none;
    padding: 20px;
    font-size: 1.3rem;
    font-family: 'VT323', monospace;
    resize: none;
    outline: none;
    white-space: pre-wrap;
    line-height: 1.4;
  }

  /* --- SECTION 3: LOWER UI STACK --- */
  #lower-stack {
    border-top: 1px solid var(--border-color);
    background-color: var(--panel-bg);
  }

  /* Tab Row (File, Edit, etc) */
  #tabs-row {
    display: flex;
    background-color: #1a1a1a;
    border-bottom: 1px solid var(--border-color);
  }
  .tab-item {
    padding: 4px 15px;
    cursor: pointer;
    border-right: 1px solid var(--border-color);
    font-size: 1.1rem;
  }
  .tab-item:hover { background-color: #333; }

  /* Status Bar */
  #status-bar {
    background-color: var(--accent-red);
    color: #000;
    padding: 2px 10px;
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    font-size: 1rem;
    text-transform: uppercase;
  }

  /* The "MicroPro" Command Row */
  #bottom-commands {
    display: flex;
    justify-content: space-around;
    padding: 8px 0;
    background-color: #111;
    border-bottom: 1px solid var(--border-color);
    font-size: 1rem;
  }

  /* --- SECTION 4: SYSTEM DECK (Map & GIF) --- */
  #system-deck {
    height: 160px; /* Minimized height */
    display: flex;
    background-color: #000;
    border-top: 2px solid var(--accent-red);
  }

  .deck-panel {
    border-right: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
  }

  /* Map Specifics */
  #map-panel {
    flex-grow: 1; /* Takes up most space */
  }
  #map {
    width: 100%;
    height: 100%;
    filter: grayscale(100%) contrast(1.2) brightness(0.7);
    transition: filter 0.3s;
  }
  #map:hover { filter: grayscale(0%); }

  /* GIF/Logo Specifics */
  #logo-panel {
    width: 200px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #050505;
  }
  #logo-panel img {
    height: 100px;
    /* Red Shift Effect on GIF */
    filter: sepia(100%) hue-rotate(-50deg) saturate(300%) contrast(1.2);
    opacity: 0.8;
  }

  .coord-overlay {
    position: absolute;
    top: 5px; right: 5px;
    background: rgba(0,0,0,0.8);
    color: var(--accent-red);
    padding: 2px 5px;
    font-size: 0.8rem;
    z-index: 500;
    border: 1px solid #333;
  }

</style>
</head>
<body class="crt">

    <!-- 1. TOP SHORTCUTS (The "Above" Commands) -->
    <div id="top-bar">
        <div class="menu-btn" onclick="format('bold')"><span class="shortcut-key">^B</span> Bold</div>
        <div class="menu-btn" onclick="format('italic')"><span class="shortcut-key">^I</span> Italic</div>
        <div class="menu-btn" onclick="format('underline')"><span class="shortcut-key">^U</span> Underline</div>
        <div class="menu-btn" onclick="insertDateTime()"><span class="shortcut-key">^D</span> Date/Time</div>
        <div class="menu-btn" onclick="countWords()"><span class="shortcut-key">^W</span> Count</div>
        <div class="menu-btn" onclick="toggleRuler()"><span class="shortcut-key">^R</span> Ruler</div>
        <div class="menu-btn" onclick="saveDoc()"><span class="shortcut-key">^S</span> Save</div>
        <div class="menu-btn" onclick="window.print()"><span class="shortcut-key">^P</span> Print</div>
        <div class="menu-btn" onclick="toggleReadMode()"><span class="shortcut-key">^M</span> Read Mode</div>
    </div>

    <!-- 2. EDITOR AREA -->
    <div id="editor-container">
        <div id="ruler" style="display:none;"></div>
        <textarea id="editor" spellcheck="false">WORDSTAR NEXUS [ORIGINAL ARCHITECTURE]
------------------------------------
This layout preserves the "Sandwich" interface: 
1. Formatting shortcuts on top.
2. The writing space in the center.
3. System tabs and MicroPro root commands below.

The Map and Signal Monitor have been compacted into the bottom System Deck to reduce visual noise while maintaining the tracking link.</textarea>
    </div>

    <!-- 3. LOWER UI STACK -->
    <div id="lower-stack">
        
        <!-- Tabs -->
        <div id="tabs-row">
            <div class="tab-item">File</div>
            <div class="tab-item">Edit</div>
            <div class="tab-item">Format</div>
            <div class="tab-item">View</div>
            <div class="tab-item">Tools</div>
            <div class="tab-item">Help</div>
        </div>

        <!-- Status Line -->
        <div id="status-bar">
            <span id="cursor-pos">L:01 C:01</span>
            <span id="doc-status">EDITING: UNTITLED</span>
            <span id="insert-state">INSERT</span>
        </div>

        <!-- 4. BOTTOM COMMANDS (The "Below" Commands) -->
        <div id="bottom-commands">
            <div class="menu-btn"><span class="shortcut-key">^K</span> Block</div>
            <div class="menu-btn"><span class="shortcut-key">^O</span> Onscreen</div>
            <div class="menu-btn"><span class="shortcut-key">^Q</span> Quick</div>
            <div class="menu-btn"><span class="shortcut-key">^P</span> Print</div>
            <div class="menu-btn"><span class="shortcut-key">^C</span> Cursor</div>
            <div class="menu-btn"><span class="shortcut-key">^R</span> Reform</div>
            <div class="menu-btn"><span class="shortcut-key">^V</span> Insert</div>
            <div class="menu-btn"><span class="shortcut-key">^D</span> Delete</div>
        </div>

        <!-- 5. SYSTEM DECK (Map + Gif) -->
        <div id="system-deck">
            <!-- Map Panel -->
            <div class="deck-panel" id="map-panel">
                <div id="map"></div>
                <div class="coord-overlay">
                    ISS: <span id="lat">0.00</span>, <span id="lon">0.00</span>
                </div>
            </div>

            <!-- GIF Panel -->
            <div class="deck-panel" id="logo-panel">
                <img src="https://raw.githubusercontent.com/ghostm68/pantheon/main/quirky.gif" alt="System">
                <div style="margin-top:5px; font-size: 0.8rem; color: #666;">SYS.MONITOR</div>
            </div>
        </div>

    </div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    /* --- EDITOR LOGIC --- */
    const editor = document.getElementById('editor');
    const ruler = document.getElementById('ruler');
    
    // Ruler Gen
    for(let i=1; i<=80; i++) {
        ruler.innerHTML += `<span style="flex:0 0 1.25%; text-align:center;">${i%10===0?i/10:i%5===0?'+':'-'}</span>`;
    }

    // Basic Actions
    const format = (cmd) => document.execCommand(cmd);
    const toggleRuler = () => ruler.style.display = (ruler.style.display === 'none' ? 'flex' : 'none');
    const saveDoc = () => {
        const blob = new Blob([editor.value], {type:'text/plain'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'nexus_orig.txt';
        a.click();
    };
    const toggleReadMode = () => {
        editor.style.maxWidth = editor.style.maxWidth ? '' : '800px';
        editor.style.margin = editor.style.margin ? '' : '0 auto';
        editor.style.borderLeft = editor.style.borderLeft ? '' : '1px solid #333';
        editor.style.borderRight = editor.style.borderRight ? '' : '1px solid #333';
    };
    const insertDateTime = () => {
        const d = new Date().toLocaleString();
        editor.setRangeText(d, editor.selectionStart, editor.selectionEnd, 'end');
    };
    const countWords = () => alert("Words: " + editor.value.trim().split(/\s+/).length);

    // Status Bar Update
    editor.addEventListener('input', () => {
        const text = editor.value.substring(0, editor.selectionStart);
        const lines = text.split('\n');
        document.getElementById('cursor-pos').innerText = `L:${lines.length} C:${lines[lines.length-1].length+1}`;
    });

    /* --- MAP LOGIC --- */
    const map = L.map('map', {zoomControl: false, attributionControl:false}).setView([0,0], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
    
    const issIcon = L.icon({
        iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/d/d0/International_Space_Station.svg',
        iconSize: [30, 18], iconAnchor: [15, 9]
    });
    const marker = L.marker([0,0], {icon: issIcon}).addTo(map);

    async function updateISS() {
        try {
            const r = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
            const d = await r.json();
            marker.setLatLng([d.latitude, d.longitude]);
            map.panTo([d.latitude, d.longitude]);
            document.getElementById('lat').innerText = d.latitude.toFixed(2);
            document.getElementById('lon').innerText = d.longitude.toFixed(2);
        } catch(e){}
    }
    setInterval(updateISS, 3000);
    updateISS();

</script>
</body>
</html>
