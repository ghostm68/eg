<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1024, initial-scale=1.0">
  <title>Ataraxia</title>
  
  <!-- MapLibre GL CSS -->
  <link href='https://unpkg.com/maplibre-gl@5.0.1/dist/maplibre-gl.css' rel='stylesheet' />
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Olivetti', 'Courier New', monospace;
      height: 100vh;
      overflow: hidden;
      background: #1a1a1a;
      color: #e0e0e0;
    }

    /* Import ONLY Olivetti fonts */
    @font-face {
      font-family: 'Olivetti';
      src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo/fonts/olivetti/olivetti-typewriter-regular.otf') format('opentype');
      font-weight: normal;
      font-style: normal;
    }
    
    @font-face {
      font-family: 'Olivetti';
      src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo/fonts/olivetti/olivetti-typewriter-bold.otf') format('opentype');
      font-weight: bold;
      font-style: normal;
    }

    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* Header - Monochrome */
    .app-header {
      background: #2a2a2a;
      color: #e0e0e0;
      padding: 10px 15px;
      text-align: center;
      border-bottom: 1px solid #444;
      z-index: 1000;
      flex-shrink: 0;
    }

    .main-title {
      font-family: 'Olivetti', 'Courier New', monospace;
      font-size: 1.8em;
      margin: 0;
    }

    .subtitle {
      font-family: 'Olivetti', 'Courier New', monospace;
      font-size: 0.9em;
      opacity: 0.9;
    }

    /* Main Content - Split Screen */
    .main-content {
      display: flex;
      flex: 1;
      overflow: hidden;
      flex-direction: row-reverse; /* Map on right for desktop */
    }

    /* Map Section */
    .map-section {
      flex: 1;
      position: relative;
      border-left: 1px solid #444;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    .map-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      display: flex;
      gap: 5px;
    }

    .map-btn {
      background: rgba(42, 42, 42, 0.9);
      border: 1px solid #00aaff; /* Neon blue */
      border-radius: 5px;
      padding: 8px 12px;
      cursor: pointer;
      font-family: 'Olivetti', 'Courier New', monospace;
      font-size: 0.8em;
      color: #e0e0e0;
    }

    /* Writing Section */
    .writing-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #2a2a2a;
    }

    .writing-header {
      background: #1a1a1a;
      color: #e0e0e0;
      padding: 10px 15px;
      font-family: 'Olivetti', 'Courier New', monospace;
      font-weight: bold;
      flex-shrink: 0;
      border-bottom: 1px solid #444;
    }

    #writing-area {
      flex: 1;
      width: 100%;
      border: none;
      padding: 15px;
      background: #1a1a1a;
      resize: none;
      outline: none;
      font-family: 'Olivetti', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      color: #e0e0e0;
    }

    .writing-tools {
      background: #1a1a1a;
      padding: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      flex-shrink: 0;
      border-top: 1px solid #444;
    }

    .writing-tools button {
      padding: 8px 12px;
      background: #2a2a2a;
      border: 1px solid #00aaff; /* Neon blue */
      border-radius: 4px;
      cursor: pointer;
      font-family: 'Olivetti', 'Courier New', monospace;
      font-size: 0.8em;
      color: #e0e0e0;
      flex: 1;
      min-width: 120px;
    }

    /* Location Inspiration - Monochrome */
    #location-inspiration {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 400px;
      background: #2a2a2a;
      border: 2px solid #00aaff; /* Neon blue */
      border-radius: 8px;
      padding: 20px;
      z-index: 1001;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      display: none;
    }

    #location-info {
      margin: 15px 0;
      line-height: 1.5;
      color: #e0e0e0;
    }

    #use-inspiration {
      width: 100%;
      padding: 10px;
      background: #00aaff; /* Neon blue */
      color: #1a1a1a;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'Olivetti', 'Courier New', monospace;
      font-weight: bold;
    }

    /* Settings Panel - Monochrome */
    #settings-panel {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 400px;
      max-height: 80vh;
      background: #2a2a2a;
      border: 2px solid #00aaff; /* Neon blue */
      border-radius: 8px;
      padding: 20px;
      z-index: 1001;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      overflow-y: auto;
      display: none;
    }

    .settings-group {
      margin-bottom: 15px;
    }

    .settings-group label {
      display: block;
      margin-bottom: 5px;
      color: #e0e0e0;
      font-family: 'Olivetti', 'Courier New', monospace;
    }

    .settings-group select, .settings-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #444;
      border-radius: 4px;
      background: #1a1a1a;
      color: #e0e0e0;
      font-family: 'Olivetti', 'Courier New', monospace;
    }

    /* Neon blue slider */
    input[type="range"] {
      accent-color: #00aaff;
    }

    .close-btn {
      background: #00aaff; /* Neon blue */
      color: #1a1a1a;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      font-family: 'Olivetti', 'Courier New', monospace;
      font-weight: bold;
      width: 100%;
    }

    /* Mobile Responsive - Text area on top */
    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }
      
      .writing-section {
        order: 1;
        flex: 0.6; /* Smaller text area on mobile */
        border-bottom: 1px solid #444;
      }
      
      .map-section {
        order: 2;
        flex: 0.4; /* Smaller map on mobile */
        border-left: none;
      }
      
      .writing-tools {
        flex-direction: column;
      }
      
      .writing-tools button {
        min-width: auto;
      }
      
      .main-title {
        font-size: 1.5em;
      }
      
      .subtitle {
        font-size: 0.8em;
      }
    }

    /* Location Pins - Monochrome with blue */
    .location-pin {
      background: rgba(42, 42, 42, 0.9);
      color: #e0e0e0;
      padding: 5px 10px;
      border-radius: 15px;
      font-family: 'Olivetti', 'Courier New', monospace;
      font-size: 12px;
      border: 2px solid #00aaff; /* Neon blue */
    }

    /* MapLibre attribution styling */
    .maplibregl-ctrl-attrib {
      background: rgba(42, 42, 42, 0.8) !important;
      color: #e0e0e0 !important;
    }

    .maplibregl-ctrl-attrib a {
      color: #00aaff !important;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <div class="app-header">
      <div class="main-title">Ataraxia</div>
      <div class="subtitle">World Building Sanctuary</div>
    </div>

    <!-- Main Split Screen Content -->
    <div class="main-content">
      <!-- Map Section - Right on Desktop -->
      <div class="map-section">
        <div id="map"></div>
        <div class="map-controls">
          <button class="map-btn" id="settings-btn">Settings</button>
          <button class="map-btn" id="inspiration-btn">Get Inspired</button>
        </div>
      </div>

      <!-- Writing Section - Left on Desktop -->
      <div class="writing-section">
        <div class="writing-header">
          üìù Your World Awaits...
        </div>
        <textarea id="writing-area" placeholder="Begin your world-building journey here...&#10;&#10;Click 'Get Inspired' for location prompts, or create your own stories."></textarea>
        <div class="writing-tools">
          <button id="generate-poem">Generate Poem</button>
          <button id="save-location">Pin to Map</button>
          <button id="clear-text">Clear</button>
          <button id="export-text">Export Text</button>
        </div>
      </div>
    </div>

    <!-- Location Inspiration Modal -->
    <div id="location-inspiration">
      <h3 style="color: #e0e0e0; font-family: 'Olivetti', 'Courier New', monospace;">üìç Location Inspiration</h3>
      <p id="location-info"></p>
      <button id="use-inspiration">Use in Writing</button>
      <button class="close-btn" id="close-inspiration">Close</button>
    </div>

    <!-- Settings Modal -->
    <div id="settings-panel">
      <h3 style="color: #e0e0e0; font-family: 'Olivetti', 'Courier New', monospace;">Ataraxia Settings</h3>
      
      <div class="settings-group">
        <label for="map-theme">Map Theme:</label>
        <select id="map-theme">
          <option value="dark" selected>Dark</option>
          <option value="light">Light</option>
          <option value="satellite">Satellite</option>
          <option value="terrain">Terrain</option>
        </select>
      </div>
      
    <div class="settings-group">
      <label for="font-family">olivetti:</label>
      <select id="font-family">
        <option value="olivetti-typewriter-regular.otf" selected>Olivetti Typewriter</option>
        <option value="olivetti-typewriter-bold.otf">Olivetti Typewriter Bold</option>
        <option value="olivetti-typewriter-italic.otf">Olivetti Typewriter Italic</option>
        <option value="olivetti-underwood-regular.otf">Olivetti Underwood</option>
        <option value="olivetti-underwood-bold.otf">Olivetti Underwood Bold</option>
      </select>
    </div>
      <div class="settings-group">
        <label for="font-size">Font Size: <span id="font-size-value" style="color: #00aaff;">14px</span></label>
        <input type="range" id="font-size" min="12" max="24" value="14">
      </div>

      <div class="settings-group">
        <label for="writing-mode">Writing Mode:</label>
        <select id="writing-mode">
          <option value="world-building">World Building</option>
          <option value="poetry">Poetry Generation</option>
          <option value="free-write">Free Writing</option>
        </select>
      </div>

      <button class="close-btn" id="close-settings">Apply & Close</button>
    </div>
  </div>

  <!-- MapLibre GL JS -->
  <script src='https://unpkg.com/maplibre-gl@5.0.1/dist/maplibre-gl.js'></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Initialize MapLibre GL Map with proper street-level styles
      const map = new maplibregl.Map({
        container: 'map',
        style: 'https://tiles.openfreemap.org/styles/liberty', // Detailed street map style
        center: [-96, 37.8], // Center on United States
        zoom: 4,
        attributionControl: true
      });

      // Add navigation controls
      map.addControl(new maplibregl.NavigationControl(), 'top-right');

      // Map styles for different themes - using proper OpenStreetMap-based styles
      const mapStyles = {
        dark: 'https://openmaptiles.github.io/dark-matter-gl-style/style-cdn.json',
        light: 'https://openmaptiles.github.io/positron-gl-style/style-cdn.json',
        satellite: 'https://api.maptiler.com/maps/satellite/style.json?key=get_your_own_OpIi9ZULNHzrESv6TWL',
        terrain: 'https://api.maptiler.com/maps/topo/style.json?key=get_your_own_OpIi9ZULNHzrESv6TWL'
      };

      // Alternative free styles that work without API keys
      const freeMapStyles = {
        dark: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
        light: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json',
        satellite: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
        terrain: 'https://tiles.openfreemap.org/styles/liberty' // Default liberty style
      };

      // UI Elements
      const writingArea = document.getElementById('writing-area');
      const settingsBtn = document.getElementById('settings-btn');
      const inspirationBtn = document.getElementById('inspiration-btn');
      const settingsPanel = document.getElementById('settings-panel');
      const locationInspiration = document.getElementById('location-inspiration');
      const locationInfo = document.getElementById('location-info');
      const closeSettings = document.getElementById('close-settings');
      const closeInspiration = document.getElementById('close-inspiration');
      const useInspiration = document.getElementById('use-inspiration');

      // Simple modal controls
      settingsBtn.addEventListener('click', () => {
        settingsPanel.style.display = 'block';
      });

      inspirationBtn.addEventListener('click', () => {
        getRandomLocationInspiration();
      });

      closeSettings.addEventListener('click', () => {
        settingsPanel.style.display = 'none';
        applySettings();
      });

      closeInspiration.addEventListener('click', () => {
        locationInspiration.style.display = 'none';
      });

      useInspiration.addEventListener('click', () => {
        writingArea.value += '\n\n' + locationInfo.textContent;
        locationInspiration.style.display = 'none';
      });

      // Writing Tools
      document.getElementById('generate-poem').addEventListener('click', () => {
        const poems = [
          "The mountains stand in silent grace,\nTheir shadows fall on time and space.\nRivers weave through ancient stone,\nIn whispered tales of lands unknown.",
          
          "Where ocean meets the waiting shore,\nAnd waves crash with their endless roar.\nThe salt-kissed air, the seabird's cry,\nBeneath the vast and cloud-strewn sky.",
          
          "Through forest deep where shadows dance,\nThe sunlight steals a fleeting glance.\nAmong the trees, a world apart,\nWhere nature weaves her living art."
        ];
        
        writingArea.value += '\n\n' + poems[Math.floor(Math.random() * poems.length)];
      });

      document.getElementById('save-location').addEventListener('click', () => {
        const center = map.getCenter();
        if (writingArea.value.trim()) {
          // Create a custom marker element
          const el = document.createElement('div');
          el.className = 'location-pin';
          el.innerHTML = 'üìå';
          el.style.width = '30px';
          el.style.height = '30px';
          el.style.display = 'flex';
          el.style.alignItems = 'center';
          el.style.justifyContent = 'center';
          el.style.fontSize = '20px';

          const marker = new maplibregl.Marker(el)
            .setLngLat([center.lng, center.lat])
            .setPopup(new maplibregl.Popup({ offset: 25 })
              .setHTML(`<strong>Saved Note:</strong><br>${writingArea.value.substring(0, 100)}...`))
            .addTo(map);
          
          alert('Note pinned to map!');
        } else {
          alert('Please write something first!');
        }
      });

      document.getElementById('clear-text').addEventListener('click', () => {
        if (confirm('Clear all text?')) {
          writingArea.value = '';
        }
      });

      document.getElementById('export-text').addEventListener('click', () => {
        const text = writingArea.value;
        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ataraxia-notes.txt';
        a.click();
        URL.revokeObjectURL(url);
      });

      // Settings
      const fontSizeSlider = document.getElementById('font-size');
      const fontSizeValue = document.getElementById('font-size-value');

      function applySettings() {
        const theme = document.getElementById('map-theme').value;
        const fontSize = fontSizeSlider.value;
        
        // Apply map theme using free styles
        if (freeMapStyles[theme]) {
          map.setStyle(freeMapStyles[theme]);
        }
        
        // Apply font size
        writingArea.style.fontSize = fontSize + 'px';
        fontSizeValue.textContent = fontSize + 'px';
      }

      fontSizeSlider.addEventListener('input', () => {
        fontSizeValue.textContent = fontSizeSlider.value + 'px';
      });

      // Font selection
      const fontSelector = document.getElementById('font-family');
      fontSelector.addEventListener('change', (e) => {
        applyFont(e.target.value);
      });

      function applyFont(fontFile) {
        const fontFace = `
          @font-face {
            font-family: 'SelectedFont';
            src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo/fonts/olivetti/${fontFile}') format('opentype');
          }
        `;
        
        let styleElement = document.getElementById('dynamic-font');
        if (!styleElement) {
          styleElement = document.createElement('style');
          styleElement.id = 'dynamic-font';
          document.head.appendChild(styleElement);
        }
        styleElement.textContent = fontFace;
        
        writingArea.style.fontFamily = 'SelectedFont, "Courier New", monospace';
      }

      // Apply default font on load
      applyFont('olivetti-typewriter-regular.otf');

      // Location Inspiration
      function getRandomLocationInspiration() {
        const prompts = [
          "Describe a hidden civilization in these mountains",
          "What magical creatures live in these forests?",
          "Create a legend about this river's origin",
          "What secrets does this coastline hold?",
          "Design a city that could thrive in this landscape",
          "What ancient ruins might be buried here?",
          "Describe the sounds and smells of this place at dawn",
          "What adventures await explorers in this terrain?",
          "Create a myth about how these lands were formed",
          "What would daily life be like for people living here?"
        ];
        
        const terrains = [
          "majestic mountain ranges",
          "rolling hills and valleys", 
          "dense ancient forests",
          "vast open plains",
          "coastal landscapes",
          "desert expanses",
          "river deltas",
          "frozen wilderness",
          "tropical islands",
          "urban landscapes"
        ];
        
        const terrain = terrains[Math.floor(Math.random() * terrains.length)];
        const prompt = prompts[Math.floor(Math.random() * prompts.length)];
        
        locationInfo.innerHTML = `
          <strong>A landscape of ${terrain}</strong><br><br>
          <em>Writing Prompt:</em><br>
          ${prompt}
        `;
        
        locationInspiration.style.display = 'block';
      }

      // Close modals when clicking outside
      window.addEventListener('click', (e) => {
        if (e.target === settingsPanel) {
          settingsPanel.style.display = 'none';
        }
        if (e.target === locationInspiration) {
          locationInspiration.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>
