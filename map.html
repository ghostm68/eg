<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Constellation of Stories - WordStar Nexus</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        /* Base Styles */
        :root {
            --primary: #DC143C;   /* Crimson */
            --secondary: #FF4444; /* Brighter Red for visibility */
            --dim: #500000;       /* Dark Red for background lines */
            --bg: #050505;
            --panel: rgba(10, 10, 10, 0.95);
            --border: #333;
            --text: #ffffff;
            --header-height: 60px;
            --footer-height: 30px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Courier New', monospace;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .sys-header {
            height: var(--header-height);
            background: #000;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 200;
        }

        .brand {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary);
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .header-nav a {
            color: #666;
            text-decoration: none;
            font-size: 0.8rem;
            margin-left: 20px;
            transition: color 0.3s;
            text-transform: uppercase;
        }
        .header-nav a:hover { color: var(--primary); }

        /* Workspace */
        .workspace {
            display: flex;
            flex: 1;
            height: calc(100vh - var(--header-height) - var(--footer-height));
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            height: 100%;
            background: var(--panel);
            border-right: 1px solid var(--border);
            padding: 20px;
            overflow-y: auto;
            position: absolute;
            left: 0; top: 0; z-index: 100;
            transform: translateX(-100%); /* Hidden by default */
            transition: transform 0.3s ease;
        }

        .sidebar.active { transform: translateX(0); }

        .sidebar-toggle {
            background: none;
            border: 1px solid var(--border);
            color: var(--primary);
            padding: 5px 10px;
            cursor: pointer;
            margin-right: 15px;
        }
        .sidebar-toggle:hover { background: #1a1a1a; }

        .sidebar-link {
            display: block;
            color: #888;
            text-decoration: none;
            padding: 5px 0;
            font-size: 12px;
            transition: color 0.2s;
            border-bottom: 1px dotted #222;
        }
        .sidebar-link:hover { color: var(--secondary); padding-left: 5px; }
        .sidebar h3 { color: var(--primary); font-size: 12px; margin-top: 20px; margin-bottom: 10px; text-transform: uppercase; }

        /* Main Map Area */
        .main-content {
            flex: 1;
            position: relative;
            background: radial-gradient(circle at center, #111 0%, #000 100%);
            overflow: hidden;
            width: 100%;
        }

        #map-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        svg {
            width: 100%;
            height: 100%;
            max-width: 1200px; /* Prevents it from getting too spread out on huge screens */
        }

        /* --- STAR & LINE STYLES --- */
        
        /* Lines connecting stars */
        .constellation-line {
            stroke: var(--dim);
            stroke-width: 1px;
            opacity: 0.4;
            transition: stroke 0.3s, opacity 0.3s;
        }

        /* Main Category Stars */
        .star-point.main {
            fill: #000; /* Black center */
            stroke: var(--primary);
            stroke-width: 2px;
            cursor: pointer;
        }

        /* The actual links (Territories) */
        .star-point.territory {
            fill: var(--secondary);
            cursor: pointer;
            transition: r 0.3s;
        }
        
        /* Outer / Other links */
        .star-point.outer {
            fill: #800000; /* Darker red, but still red */
            opacity: 0.7;
            cursor: pointer;
        }

        /* Hover Effects */
        .star-point:hover {
            fill: #FFF !important;
            filter: drop-shadow(0 0 8px var(--primary));
        }

        /* Labels */
        .territory-label {
            fill: var(--text);
            font-size: 10px;
            text-anchor: middle;
            pointer-events: none;
            font-weight: bold;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .main-label {
            fill: var(--primary);
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
            pointer-events: none;
            text-shadow: 0 2px 4px #000;
        }

        /* Popup */
        .gsap-popup {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--primary);
            padding: 10px 15px;
            pointer-events: none;
            opacity: 0;
            z-index: 50;
        }
        .gsap-popup h3 { color: var(--primary); font-size: 14px; margin-bottom: 5px; }
        .gsap-popup p { color: #ccc; font-size: 11px; }

        /* Footer */
        .sys-footer {
            height: var(--footer-height);
            background: #000;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 10px;
            color: #444;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="sys-header">
        <div style="display:flex; align-items:center;">
            <button id="sidebar-toggle" class="sidebar-toggle">â˜° MENU</button>
            <a href="https://wordstar.nexus/" class="brand">WordStar Nexus</a>
        </div>
        <nav class="header-nav">
            <a href="https://wordstar.nexus/home">Home</a>
            <a href="https://wordstar.nexus/about">About</a>
        </nav>
    </header>

    <div class="workspace">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="sidebar">
            <div id="sidebar-links-container"></div>
        </aside>

        <!-- Main Map -->
        <main class="main-content">
            <div id="map-container">
                <svg id="star-map" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid meet">
                    <!-- Connections Group -->
                    <g id="lines"></g>
                    <!-- Stars Group -->
                    <g id="stars"></g>
                    <!-- Labels Group -->
                    <g id="labels"></g>
                </svg>
            </div>
            
            <!-- Hover Popup -->
            <div id="popup" class="gsap-popup">
                <h3 id="popup-title">Title</h3>
                <p id="popup-sub">Click to navigate</p>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="sys-footer">
        <span>STATUS: STABLE</span>
        <span>WordStar Nexus &copy; 2025</span>
    </footer>

    <script>
        gsap.registerPlugin();

        // Data
        const sitemapUrls = [
            "https://wordstar.nexus/home", "https://wordstar.nexus/dreamweaver", "https://wordstar.nexus/wip",
            "https://wordstar.nexus/dejavuglitches", "https://wordstar.nexus/displaywriter", "https://wordstar.nexus/bakedalaska",
            "https://wordstar.nexus/citadelle", "https://wordstar.nexus/ten", "https://wordstar.nexus/nine",
            "https://wordstar.nexus/38", "https://wordstar.nexus/custompad", "https://wordstar.nexus/typecast",
            "https://wordstar.nexus/typespace", "https://wordstar.nexus/nvidiapad", "https://wordstar.nexus/z",
            "https://wordstar.nexus/w", "https://wordstar.nexus/textcraft", "https://wordstar.nexus/typewriter",
            "https://wordstar.nexus/birch", "https://wordstar.nexus/macwritepro", "https://wordstar.nexus/everex",
            "https://wordstar.nexus/ministral14b", "https://wordstar.nexus/wortschatz", "https://wordstar.nexus/menageatrois",
            "https://wordstar.nexus/q", "https://wordstar.nexus/trinity", "https://wordstar.nexus/grok4",
            "https://wordstar.nexus/queer", "https://wordstar.nexus/triad", "https://wordstar.nexus/pen",
            "https://wordstar.nexus/iwa", "https://wordstar.nexus/enigma", "https://wordstar.nexus/conceptweave",
            "https://wordstar.nexus/alt", "https://wordstar.nexus/granite", "https://wordstar.nexus/ataraxia",
            "https://wordstar.nexus/daslexikon", "https://wordstar.nexus/ai", "https://wordstar.nexus/nc17",
            "https://wordstar.nexus/netherlands", "https://wordstar.nexus/ighsau", "https://wordstar.nexus/90263"
        ];

        // --- 1. Processing Data ---
        
        function getPrettyName(url) {
            const path = url.split('/').pop();
            if(!path || path === 'home') return 'HOME BASE';
            // Custom renames for specific paths
            const map = {
                'dreamweaver': 'DREAMWEAVER', 'wip': 'W.I.P.', 'nvidiapad': 'NVIDIA AI',
                'ministral14b': 'MINISTRAL 14B', 'macwritepro': 'MAC WRITE', 'grok4': 'X-GROK',
                'nc17': 'NC-17', 'ighsau': 'IOWA SPORTS', '90263': 'MARTHA K.'
            };
            return map[path] || path.toUpperCase().replace(/-/g, ' ');
        }

        function getCategory(url) {
            const p = url.toLowerCase();
            if (p.includes('home')) return 'main';
            if (p.includes('dream') || p.includes('novel') || p.includes('story') || p.includes('ten') || p.includes('nine') || p.includes('wip')) return 'fiction';
            if (p.includes('ai') || p.includes('grok') || p.includes('gpt') || p.includes('nvidia') || p.includes('trinity')) return 'ai';
            if (p.includes('type') || p.includes('pad') || p.includes('write') || p.includes('tool')) return 'tools';
            if (p.includes('character') || p.includes('netherlands') || p.includes('kessler')) return 'people';
            return 'archive';
        }

        // --- 2. Build the Map ---

        function buildMap() {
            const width = 800;
            const height = 600;
            const cx = width / 2;
            const cy = height / 2;

            const groups = {
                main: { x: cx, y: cy, label: 'NEXUS', items: [] },
                fiction: { x: cx - 200, y: cy - 100, label: 'FICTION', items: [] },
                ai: { x: cx + 200, y: cy - 100, label: 'AI SYNTH', items: [] },
                tools: { x: cx - 150, y: cy + 180, label: 'TOOLS', items: [] },
                people: { x: cx + 150, y: cy + 180, label: 'PERSONAE', items: [] },
                archive: { x: cx, y: cy - 220, label: 'ARCHIVE', items: [] }
            };

            // Sort URLs into groups
            sitemapUrls.forEach(url => {
                const cat = getCategory(url);
                if(groups[cat]) groups[cat].items.push({ url: url, name: getPrettyName(url) });
                else groups.archive.items.push({ url: url, name: getPrettyName(url) }); // Fallback
            });

            const svgLines = document.getElementById('lines');
            const svgStars = document.getElementById('stars');
            const svgLabels = document.getElementById('labels');

            // Draw Structure
            Object.keys(groups).forEach(key => {
                const group = groups[key];
                
                // 1. Draw Main Category Nodes (Big Stars)
                if (key !== 'main') {
                    // Line from Center to Category
                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.setAttribute("x1", cx); line.setAttribute("y1", cy);
                    line.setAttribute("x2", group.x); line.setAttribute("y2", group.y);
                    line.setAttribute("class", "constellation-line");
                    svgLines.appendChild(line);
                }

                // Category Node
                const node = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                node.setAttribute("cx", group.x); node.setAttribute("cy", group.y);
                node.setAttribute("r", key === 'main' ? 12 : 8);
                node.setAttribute("class", "star-point main");
                svgStars.appendChild(node);

                // Category Label
                const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
                label.setAttribute("x", group.x); label.setAttribute("y", group.y + 25);
                label.setAttribute("class", "main-label");
                label.textContent = group.label;
                svgLabels.appendChild(label);

                // 2. Draw Child Nodes (The actual links) around the Category
                const count = group.items.length;
                const radius = 45; // Distance from category center
                
                group.items.forEach((item, index) => {
                    const angle = (index / count) * Math.PI * 2;
                    const sx = group.x + Math.cos(angle) * radius;
                    const sy = group.y + Math.sin(angle) * radius;

                    // Line from Category to Item
                    const subLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    subLine.setAttribute("x1", group.x); subLine.setAttribute("y1", group.y);
                    subLine.setAttribute("x2", sx); subLine.setAttribute("y2", sy);
                    subLine.setAttribute("class", "constellation-line");
                    subLine.setAttribute("style", "opacity: 0.2"); // Fainter lines for items
                    svgLines.appendChild(subLine);

                    // Item Node
                    const star = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    star.setAttribute("cx", sx); star.setAttribute("cy", sy);
                    star.setAttribute("r", 4);
                    star.setAttribute("class", "star-point territory");
                    star.setAttribute("data-name", item.name);
                    star.setAttribute("data-url", item.url);
                    svgStars.appendChild(star);

                    // Item Label (Only if distinct enough, optional)
                    // We can skip labels on map to reduce clutter, showing them in popup instead.
                });
            });
        }

        // --- 3. Interactions ---

        function setupInteractions() {
            const popup = document.getElementById('popup');
            const title = document.getElementById('popup-title');
            
            // Sidebar Toggle
            const toggle = document.getElementById('sidebar-toggle');
            const sidebar = document.getElementById('sidebar');
            toggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });

            // Populate Sidebar List
            const sbContainer = document.getElementById('sidebar-links-container');
            sitemapUrls.forEach(url => {
                const a = document.createElement('a');
                a.href = url;
                a.textContent = getPrettyName(url);
                a.className = 'sidebar-link';
                sbContainer.appendChild(a);
            });

            // Star Hover Logic
            document.querySelectorAll('.star-point.territory').forEach(star => {
                star.addEventListener('mouseenter', (e) => {
                    const name = star.getAttribute('data-name');
                    
                    // Show Popup
                    title.textContent = name;
                    
                    // Position Popup near mouse
                    const rect = star.getBoundingClientRect();
                    const container = document.querySelector('.main-content').getBoundingClientRect();
                    
                    gsap.to(popup, {
                        opacity: 1,
                        left: (rect.left - container.left) + 20,
                        top: (rect.top - container.top) - 10,
                        duration: 0.2
                    });

                    // Highlight Line (optional, finds the previous sibling line)
                    // In this DOM structure, lines are in a different group, so we skip complex line highlighting for simplicity/performance
                });

                star.addEventListener('mouseleave', () => {
                    gsap.to(popup, { opacity: 0, duration: 0.2 });
                });

                star.addEventListener('click', () => {
                    const url = star.getAttribute('data-url');
                    window.location.href = url;
                });
            });
        }

        // --- 4. Init ---
        buildMap();
        setupInteractions();

        // Subtle "Alive" Animation (No rotation, just breathing)
        gsap.to('.star-point', {
            r: "+=1",
            duration: 2,
            yoyo: true,
            repeat: -1,
            stagger: {
                amount: 2,
                from: "random"
            },
            ease: "sine.inOut"
        });

    </script>
</body>
</html>
