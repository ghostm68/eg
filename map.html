<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Constellation of Stories - Micro Territories</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        /* Previous styles plus new micro-territory styles */
        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }

        .video-background video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translateX(-50%) translateY(-50%);
            object-fit: cover;
        }

        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            position: relative;
        }

        #map-container {
            position: relative;
            width: 90vw;
            height: 90vh;
            max-width: 1200px;
            max-height: 800px;
            z-index: 1;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        /* Micro Territory Styles */
        .micro-territory {
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .micro-territory.visible {
            opacity: 1;
        }

        .micro-territory:hover {
            opacity: 1 !important;
            transform: scale(1.5);
        }

        .micro-territory.core {
            fill: #DC143C;
            stroke: #FFFFFF;
            stroke-width: 1;
        }

        .micro-territory.software {
            fill: #8B0000;
            stroke: #FFFFFF;
            stroke-width: 1;
        }

        .micro-territory.ai {
            fill: #696969;
            stroke: #FFFFFF;
            stroke-width: 1;
        }

        .micro-territory.character {
            fill: #2F2F2F;
            stroke: #DC143C;
            stroke-width: 1;
        }

        .micro-territory.resource {
            fill: #A9A9A9;
            stroke: #8B0000;
            stroke-width: 1;
        }

        /* Existing star point styles */
        .star-point {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .star-point:hover {
            filter: brightness(1.3);
        }

        .star-point.outer {
            fill: #8B0000;
            stroke: #FFFFFF;
            stroke-width: 2;
        }

        .center-hub {
            fill: #DC143C;
            stroke: #FFFFFF;
            stroke-width: 3;
            cursor: pointer;
        }

        /* GSAP Popup */
        .gsap-popup {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #DC143C;
            color: #FFFFFF;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transform: translateY(10px);
            max-width: 250px;
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        .gsap-popup h3 {
            margin: 0 0 8px 0;
            color: #DC143C;
            font-size: 16px;
        }

        .gsap-popup p {
            margin: 0;
            line-height: 1.4;
        }

        /* Loading screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-text {
            color: #DC143C;
            font-size: 24px;
            font-weight: bold;
        }
    </style>
<base target="_blank">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading-screen">
        <div class="loading-text">Loading Micro Territories...</div>
    </div>

    <!-- Video Background -->
    <div class="video-background">
        <video autoplay muted loop playsinline>
            <source src="https://cdn.pixabay.com/vimeo/328940881/creative-typing-23294.mp4?width=1280&hash=8f8e9b9b9b9b9b9b9b9b9b9b9b9b9b9b" type="video/mp4">
        </video>
    </div>
    <div class="video-overlay"></div>

    <!-- Main Map Content -->
    <div id="map-container">
        <svg id="main-svg" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
            <!-- Outer Circle Territory -->
            <circle cx="400" cy="300" r="280" fill="none" stroke="#696969" stroke-width="1" stroke-dasharray="5,5" opacity="0.6"/>
            
            <!-- Star Points -->
            <g id="star-constellation">
                <!-- Point 1: Novels & Screenplays (Top) -->
                <polygon id="point1" class="star-point outer" 
                         points="400,80 410,110 440,110 418,130 428,160 400,140 372,160 382,130 360,110 390,110"/>
                
                <!-- Point 2: Writing Software (Top-Right) -->
                <polygon id="point2" class="star-point outer" 
                         points="540,150 550,180 580,180 558,200 568,230 540,210 512,230 522,200 500,180 530,180"/>
                
                <!-- Point 3: AI Applications (Bottom-Right) -->
                <polygon id="point3" class="star-point outer" 
                         points="540,450 550,480 580,480 558,500 568,530 540,510 512,530 522,500 500,480 530,480"/>
                
                <!-- Point 4: Characters & Stories (Bottom-Left) -->
                <polygon id="point4" class="star-point outer" 
                         points="260,450 270,480 300,480 278,500 288,530 260,510 232,530 242,500 220,480 250,480"/>
                
                <!-- Point 5: Resources & Downloads (Top-Left) -->
                <polygon id="point5" class="star-point outer" 
                         points="260,150 270,180 300,180 278,200 288,230 260,210 232,230 242,200 220,180 250,180"/>
            </g>
            
            <!-- Center Hub -->
            <circle id="center" cx="400" cy="300" r="25" class="center-hub"/>
            
            <!-- Micro Territories Group -->
            <g id="micro-territories"></g>
        </svg>
        
        <!-- GSAP Popup -->
        <div id="popup" class="gsap-popup">
            <h3 id="popup-title"></h3>
            <p id="popup-content"></p>
        </div>
    </div>

    <script>
        // Initialize GSAP
        gsap.registerPlugin();

        // Get elements
        const popup = document.getElementById('popup');
        const popupTitle = document.getElementById('popup-title');
        const popupContent = document.getElementById('popup-content');
        const loading = document.getElementById('loading');
        const svg = document.getElementById('main-svg');

        // Micro territory data - organized by star point regions
        const microTerritories = {
            // Point 1: Novels & Screenplays (Top region)
            point1: [
                { x: 395, y: 85, link: "https://wordstar.nexus/custompad", title: "Art Notes", type: "core" },
                { x: 405, y: 95, link: "https://wordstar.nexus/displaywriter", title: "DisplayWriter", type: "core" },
                { x: 385, y: 105, link: "https://wordstar.nexus/dejavuglitches", title: "Deja Vu Glitches", type: "core" },
                { x: 415, y: 115, link: "https://wordstar.nexus/wip", title: "Work in Progress", type: "core" }
            ],
            // Point 2: Writing Software (Top-Right region)
            point2: [
                { x: 535, y: 155, link: "https://wordstar.nexus/typecast", title: "Typecast", type: "software" },
                { x: 545, y: 165, link: "https://wordstar.nexus/typespace", title: "Typespace", type: "software" },
                { x: 525, y: 175, link: "https://wordstar.nexus/textcraft", title: "Text Craft", type: "software" },
                { x: 555, y: 185, link: "https://wordstar.nexus/typewriter", title: "Software Typewriter", type: "software" }
            ],
            // Point 3: AI Applications (Bottom-Right region)
            point3: [
                { x: 535, y: 455, link: "https://wordstar.nexus/nvidiapad", title: "Nvidia Nemotron", type: "ai" },
                { x: 545, y: 465, link: "https://wordstar.nexus/trinity", title: "Kimi Assistant", type: "ai" },
                { x: 525, y: 475, link: "https://wordstar.nexus/q", title: "Q-AI", type: "ai" },
                { x: 555, y: 485, link: "https://wordstar.nexus/grok4", title: "X-Grok", type: "ai" }
            ],
            // Point 4: Characters & Stories (Bottom-Left region)
            point4: [
                { x: 255, y: 455, link: "https://wordstar.nexus/netherlands", title: "L.Hale Netherlands", type: "character" },
                { x: 265, y: 465, link: "https://wordstar.nexus/90263", title: "Martha Kessler", type: "character" },
                { x: 245, y: 475, link: "https://wordstar.nexus/ighsau", title: "Iowa IGHSAU", type: "character" },
                { x: 275, y: 485, link: "https://wordstar.nexus/nc17", title: "NC-17 Stories", type: "character" }
            ],
            // Point 5: Resources & Downloads (Top-Left region)
            point5: [
                { x: 255, y: 155, link: "https://wordstar.nexus/daslexikon", title: "Dictionary", type: "resource" },
                { x: 265, y: 165, link: "https://wordstar.nexus/ai", title: "AI Resources", type: "resource" },
                { x: 245, y: 175, link: "https://wordstar.nexus/custompad", title: "Custom Pad", type: "resource" },
                { x: 275, y: 185, link: "https://wordstar.nexus/wortschatz", title: "Wortschatz", type: "resource" }
            ],
            // Center region
            center: [
                { x: 390, y: 290, link: "https://wordstar.nexus/", title: "Home Base", type: "core" },
                { x: 410, y: 290, link: "https://wordstar.nexus/home", title: "Dashboard", type: "core" },
                { x: 400, y: 275, link: "https://wordstar.nexus/citadelle", title: "Citadelle", type: "core" }
            ]
        };

        // Create hover timeline for popup
        let popupTl = gsap.timeline({ paused: true });

        // Hide loading screen
        window.addEventListener('load', function() {
            setTimeout(() => {
                gsap.to(loading, {
                    opacity: 0,
                    duration: 1,
                    onComplete: () => loading.style.display = 'none'
                });
            }, 1000);
        });

        // Enhanced micro territory creation function
        function addMicroTerritory(x, y, link, title, type, parentId) {
            // Create link element
            const territory = document.createElementNS("http://www.w3.org/2000/svg", "a");
            territory.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", link);
            territory.setAttribute("target", "_self");
            territory.setAttribute("data-parent", parentId);
            territory.setAttribute("data-title", title);
            territory.setAttribute("data-type", type);

            // Create circle element
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("cx", x);
            circle.setAttribute("cy", y);
            circle.setAttribute("r", "3");
            circle.setAttribute("class", `micro-territory ${type}`);
            circle.setAttribute("opacity", "0");

            territory.appendChild(circle);
            
            // Add to micro territories group
            const microGroup = document.getElementById('micro-territories');
            microGroup.appendChild(territory);

            // Add interactivity
            addMicroTerritoryInteractivity(territory, circle, title, type, link);
            
            return territory;
        }

        // Add interactivity to micro territories
        function addMicroTerritoryInteractivity(territory, circle, title, type, link) {
            // Mouse events
            territory.addEventListener('mouseenter', function(e) {
                // Show popup
                popupTitle.textContent = title;
                popupContent.textContent = `Micro territory: ${type} tool`;
                
                const rect = circle.getBoundingClientRect();
                const containerRect = document.getElementById('map-container').getBoundingClientRect();
                
                popup.style.left = (rect.left - containerRect.left + rect.width / 2 - popup.offsetWidth / 2) + 'px';
                popup.style.top = (rect.top - containerRect.top - popup.offsetHeight - 10) + 'px';
                
                popupTl.clear()
                    .to(popup, {
                        opacity: 1,
                        y: 0,
                        duration: 0.2,
                        ease: "power2.out"
                    });
                popupTl.play();

                // Highlight effect
                gsap.to(circle, {
                    scale: 2,
                    opacity: 1,
                    duration: 0.2,
                    ease: "power2.out"
                });
            });

            territory.addEventListener('mouseleave', function() {
                popupTl.reverse();
                
                gsap.to(circle, {
                    scale: 1,
                    opacity: 0.7,
                    duration: 0.2,
                    ease: "power2.out"
                });
            });

            // Click animation
            territory.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Pulse effect
                gsap.to(circle, {
                    scale: 3,
                    duration: 0.1,
                    yoyo: true,
                    repeat: 1,
                    ease: "power2.inOut",
                    onComplete: () => {
                        window.location.href = link;
                    }
                });
            });
        }

        // Populate micro territories
        function populateMicroTerritories() {
            Object.keys(microTerritories).forEach(parentId => {
                const territories = microTerritories[parentId];
                territories.forEach(territory => {
                    addMicroTerritory(
                        territory.x, 
                        territory.y, 
                        territory.link, 
                        territory.title, 
                        territory.type,
                        parentId
                    );
                });
            });
        }

        // Add main territory interactivity
        function addMainTerritoryInteractivity() {
            const mainElements = document.querySelectorAll('.star-point, .center-hub');
            
            mainElements.forEach(element => {
                element.addEventListener('mouseenter', function() {
                    // Show related micro territories
                    const parentId = this.id;
                    const relatedMicros = document.querySelectorAll(`[data-parent="${parentId}"] circle`);
                    
                    gsap.to(relatedMicros, {
                        opacity: 0.8,
                        scale: 1.2,
                        duration: 0.3,
                        stagger: 0.05,
                        ease: "power2.out"
                    });
                });

                element.addEventListener('mouseleave', function() {
                    // Hide micro territories
                    const micros = document.querySelectorAll('.micro-territory');
                    gsap.to(micros, {
                        opacity: 0,
                        scale: 1,
                        duration: 0.3,
                        ease: "power2.out"
                    });
                });
            });
        }

        // Initialize everything
        function initializeMap() {
            populateMicroTerritories();
            addMainTerritoryInteractivity();

            // Initial animation sequence
            gsap.timeline()
                .from('#star-constellation', {
                    scale: 0,
                    rotation: -180,
                    duration: 2,
                    ease: "power2.out"
                })
                .from('.micro-territory', {
                    scale: 0,
                    opacity: 0,
                    stagger: 0.02,
                    duration: 0.5,
                    ease: "back.out(1.7)"
                }, "-=1")
                .to('.micro-territory', {
                    opacity: 0,
                    duration: 0.5,
                    ease: "power2.out"
                }, "-=0.5");

            // Subtle breathing animation for main territories
            gsap.to('.star-point', {
                scale: 1.02,
                duration: 4,
                yoyo: true,
                repeat: -1,
                ease: "sine.inOut",
                stagger: 0.3
            });
        }

        // Start the map
        initializeMap();
    </script>
</body>
</html>
