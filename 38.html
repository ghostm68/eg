<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>.38 SPECIAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --blood-deep: #8B0000;
            --blood-dark: #5C0000;
            --crimson: #DC143C;
            --iron: #2B2B2B;
            --steel: #4A4A4A;
            --ash: #D3D3D3;
            --amber: #FFB347;
            --shadow: rgba(0, 0, 0, 0.8);
        }
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Crimson Pro',serif;background:var(--iron);color:var(--ash);line-height:1.8;overflow-x:hidden}
        .geometry{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;opacity:.15}
        .geometry-line{position:absolute;background:var(--blood-deep)}
        .geometry-line.vertical{width:1px;height:100%;top:0}
        .geometry-line.horizontal{height:1px;width:100%;left:0}
        .v1{left:15%}.v2{left:35%}.v3{left:65%}.v4{left:85%}
        .h1{top:20%}.h2{top:50%}.h3{top:80%}

        /* nav */
        .nav{position:fixed;top:2rem;right:2rem;z-index:1000;font-family:'IBM Plex Mono',monospace;font-size:.85rem}
        .nav-toggle{background:var(--blood-deep);color:var(--ash);border:1px solid var(--crimson);padding:.75rem 1.5rem;cursor:pointer;text-transform:uppercase;letter-spacing:.1em;transition:all .3s ease}
        .nav-toggle:hover{background:var(--crimson);box-shadow:0 0 20px rgba(220,20,60,.5)}
        .nav-menu{position:absolute;top:100%;right:0;background:var(--iron);border:1px solid var(--blood-deep);margin-top:.5rem;max-height:0;overflow:hidden;transition:max-height .3s ease}
        .nav-menu.open{max-height:800px}
        .nav-link{display:block;padding:.75rem 1.5rem;color:var(--ash);text-decoration:none;border-bottom:1px solid var(--steel);transition:all .2s ease}
        .nav-link:hover{background:var(--blood-deep);padding-left:2rem}

        /* hero */
        .hero{height:100vh;display:flex;align-items:center;justify-content:center;position:relative;background:linear-gradient(135deg,var(--iron) 0%,var(--blood-dark) 100%)}
        .hero-content{position:relative;z-index:1;text-align:center;max-width:1200px;padding:2rem}
        .hero-carousel{width:400px;height:400px;max-width:90%;margin:0 auto 3rem;position:relative;perspective:1000px}
        .hero-carousel-container{width:100%;height:100%;position:relative;transform-style:preserve-3d;animation:rotate 30s infinite linear}
        @keyframes rotate{from{transform:rotateY(0deg)}to{transform:rotateY(360deg)}}
        .hero-carousel-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;border:2px solid var(--crimson);box-shadow:0 0 40px rgba(220,20,60,.3);overflow:hidden}
        .hero-carousel-face img{width:100%;height:100%;object-fit:cover;filter:grayscale(40%) contrast(1.2)}
        .hero-carousel-caption{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to top,rgba(0,0,0,.9),transparent);padding:1rem;font-family:'IBM Plex Mono',monospace;font-size:.7rem;color:var(--ash);text-align:center}
        .hero-carousel-face:nth-child(1){transform:rotateY(0deg) translateZ(200px)}
        .hero-carousel-face:nth-child(2){transform:rotateY(60deg) translateZ(200px)}
        .hero-carousel-face:nth-child(3){transform:rotateY(120deg) translateZ(200px)}
        .hero-carousel-face:nth-child(4){transform:rotateY(180deg) translateZ(200px)}
        .hero-carousel-face:nth-child(5){transform:rotateY(240deg) translateZ(200px)}
        .hero-carousel-face:nth-child(6){transform:rotateY(300deg) translateZ(200px)}
        .hero-carousel:hover .hero-carousel-container{animation-play-state:paused}
        @media(max-width:768px){.hero-carousel{width:300px;height:300px}.hero-carousel-face{transform:rotateY(var(--angle)) translateZ(150px)}}

        .hero-title{font-size:clamp(2.5rem,8vw,6rem);font-weight:700;line-height:1.1;margin-bottom:1rem;color:var(--crimson);text-shadow:2px 2px 0 var(--blood-dark),4px 4px 10px var(--shadow);letter-spacing:-.02em}
        .hero-subtitle{font-size:clamp(1rem,2vw,1.5rem);color:var(--ash);font-weight:400;margin-bottom:2rem;opacity:.9}
        .hero-author{font-family:'IBM Plex Mono',monospace;font-size:.9rem;color:var(--amber);text-transform:uppercase;letter-spacing:.2em}
        .scroll-indicator{position:absolute;bottom:3rem;left:50%;transform:translateX(-50%);color:var(--crimson);font-family:'IBM Plex Mono',monospace;font-size:.8rem;text-transform:uppercase;letter-spacing:.2em;animation:pulse 2s ease-in-out infinite}
        @keyframes pulse{0%,100%{opacity:.5;transform:translateX(-50%) translateY(0)}50%{opacity:1;transform:translateX(-50%) translateY(-10px)}}

        /* chapters */
        .chapter{min-height:100vh;padding:8rem 2rem;opacity:0;transform:translateY(50px);transition:opacity .8s ease,transform .8s ease}
        .chapter.visible{opacity:1;transform:translateY(0)}
        .chapter-container{max-width:1400px;margin:0 auto;display:flex;gap:4rem;align-items:flex-start}
        .prose{flex:1;font-size:clamp(1.1rem,2vw,1.3rem);line-height:1.9}
        .image-rail{position:sticky;top:8rem;width:30%;max-height:calc(100vh - 10rem);overflow-y:auto;padding-right:1rem}
        .image-rail::-webkit-scrollbar{width:6px}
        .image-rail::-webkit-scrollbar-track{background:var(--iron)}
        .image-rail::-webkit-scrollbar-thumb{background:var(--blood-deep);border-radius:3px}
        .rail-image{margin-bottom:2rem;cursor:pointer}
        .rail-image img{width:100%;display:block;filter:grayscale(40%) contrast(1.1);border:2px solid var(--steel);transition:all .3s ease}
        .rail-image:hover img{filter:grayscale(0%) contrast(1);border-color:var(--crimson);box-shadow:0 0 20px rgba(220,20,60,.4)}
        .rail-image-caption{font-family:'IBM Plex Mono',monospace;font-size:.7rem;color:var(--steel);margin-top:.5rem;text-align:center;font-style:italic}
        @media(max-width:968px){.chapter-container{flex-direction:column}.image-rail{position:static;width:100%;max-height:none;margin-top:3rem}}

        .prose p{margin-bottom:1.5rem}
        .prose p:first-of-type::first-letter{font-size:4em;line-height:.8;float:left;margin:.1em .1em 0 0;color:var(--crimson);font-weight:700}
        .prose em{color:var(--amber)}
        .prose strong{color:var(--crimson)}

        /* annotations */
        .annotation-trigger{color:var(--amber);text-decoration:underline;text-decoration-style:dotted;cursor:pointer}
        .annotation-trigger:hover{color:var(--crimson)}
        .annotation-modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:9999}
        .annotation-modal-overlay.active{display:block}
        .annotation-modal{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--blood-dark);border:2px solid var(--crimson);padding:3rem;max-width:600px;width:90%;z-index:10000;box-shadow:0 0 50px rgba(220,20,60,.5)}
        .annotation-modal.active{display:block}
        .annotation-modal-close{position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--ash);font-size:2rem;cursor:pointer}
        .annotation-modal-close:hover{color:var(--crimson)}
        .annotation-modal-label{font-family:'IBM Plex Mono',monospace;font-size:.85rem;color:var(--crimson);text-transform:uppercase;letter-spacing:.2em;margin-bottom:1.5rem}
        .annotation-modal-content{font-size:1.05rem;line-height:1.7}

        /* lightbox */
        .lightbox{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);z-index:9999;justify-content:center;align-items:center;cursor:pointer}
        .lightbox.active{display:flex}
        .lightbox img{max-width:90%;max-height:90%;box-shadow:0 0 50px rgba(220,20,60,.5)}
        .lightbox-close{position:absolute;top:2rem;right:2rem;color:var(--ash);font-size:3rem;cursor:pointer}
        .lightbox-close:hover{color:var(--crimson)}

        /* footer */
        .footer{background:var(--blood-dark);padding:3rem 2rem;text-align:center;border-top:1px solid var(--crimson)}
        .footer-text{font-family:'IBM Plex Mono',monospace;font-size:.9rem;color:var(--steel)}
    </style>
</head>
<body>
<div class="geometry">
    <div class="geometry-line vertical v1"></div><div class="geometry-line vertical v2"></div>
    <div class="geometry-line vertical v3"></div><div class="geometry-line vertical v4"></div>
    <div class="geometry-line horizontal h1"></div><div class="geometry-line horizontal h2"></div>
    <div class="geometry-line horizontal h3"></div>
</div>

<nav class="nav">
    <button class="nav-toggle" onclick="document.getElementById('navMenu').classList.toggle('open')">Chapters</button>
    <div class="nav-menu" id="navMenu"></div>
</nav>

<section class="hero">
    <div class="hero-content">
        <div class="hero-carousel"><div class="hero-carousel-container" id="heroCarousel"></div></div>
        <h1 id="heroTitle"></h1>
        <p id="heroSubtitle"></p>
        <p id="heroAuthor"></p>
    </div>
    <div class="scroll-indicator">↓ Scroll to Begin</div>
</section>

<div id="chapters-container"></div>

<footer class="footer">
    <p class="footer-text">© 2024 Inky | www.inkrealm.info</p>
</footer>

<!-- lightbox -->
<div class="lightbox" id="lightbox" onclick="this.classList.remove('active')">
    <span class="lightbox-close">×</span>
    <img id="lightbox-img" src="" alt="">
</div>

<script>
/* ----------  fetch full JSON  ---------- */
let contentData = null;
async function loadContent(){
  try{
    const res = await fetch('https://raw.githubusercontent.com/ghostm68/eg/refs/heads/main/content.json');
    if(!res.ok) throw new Error(res.status);
    contentData = await res.json();
    renderPage();
  }catch(err){
    console.error(err);
    document.body.innerHTML = '<p style="color:var(--crimson);text-align:center;padding:3rem">Could not load content.json</p>';
  }
}

/* ----------  identical render  ---------- */
function renderPage(){
  const hc=document.getElementById('heroCarousel');
  contentData.heroCarousel.forEach(it=>{
    const f=document.createElement('div');f.className='hero-carousel-face';
    f.innerHTML=`<img src="${it.src}" alt="${it.alt}"><div class="hero-carousel-caption">${it.caption}</div>`;
    hc.appendChild(f);
  });
  ['heroTitle','heroSubtitle','heroAuthor'].forEach(id=>{
    document.getElementById(id).textContent=contentData[id.replace('hero','').toLowerCase()];
  });
  const nav=document.getElementById('navMenu');
  contentData.chapters.forEach(ch=>{
    const a=document.createElement('a');a.href=`#${ch.id}`;a.className='nav-link';a.textContent=ch.number;
    a.onclick=()=>nav.classList.remove('open');nav.appendChild(a);
  });
  const cont=document.getElementById('chapters-container');
  contentData.chapters.forEach(ch=>{
    const s=document.createElement('section');s.className='chapter';s.id=ch.id;
    let h=`
      <div class="chapter-container">
        <div class="chapter-header">
          <div class="chapter-number">${ch.number}</div>
          <h2 class="chapter-title">${ch.title}</h2>
          ${ch.meta?`<div class="chapter-meta">${ch.meta}</div>`:''}
        </div>
        <div class="chapter-content">
          <div class="prose">`;
    ch.content.forEach(p=>{
      p=p.replace(/{{([^|]+)\|([^}]+)}}/g,'<span class="annotation-trigger" data-ann="$1" data-chap="'+ch.id+'">$2</span>');
      h+=`<p>${p}</p>`;
    });
    h+=`</div><div class="image-rail">`;
    (ch.images||[]).forEach(img=>{
      h+=`<div class="rail-image" onclick="openLightbox(this)">
            <img src="${img.src}" alt="${img.alt}">
            <div class="rail-image-caption">${img.caption||''}</div>
          </div>`;
    });
    h+=`</div></div></div>`;s.innerHTML=h;cont.appendChild(s);
    s.querySelectorAll('.annotation-trigger').forEach(tr=>{
      tr.addEventListener('click',()=>showAnn(tr.dataset.chap,tr.dataset.ann));
    });
  });
  const io=new IntersectionObserver(es=>es.forEach(e=>e.isIntersecting&&e.target.classList.add('visible')),{threshold:.1});
  document.querySelectorAll('.chapter').forEach(c=>io.observe(c));
}
function showAnn(chapId,key){
  const chap=contentData.chapters.find(c=>c.id===chapId);
  if(!chap||!chap.annotations||!chap.annotations[key])return;
  const ann=chap.annotations[key];
  document.getElementById('ann-label').textContent=ann.label;
  document.getElementById('ann-content').textContent=ann.content;
  document.getElementById('ann-overlay').classList.add('active');
  document.getElementById('ann-modal').classList.add('active');
}
function openLightbox(el){
  const img=el.querySelector('img');
  document.getElementById('lightbox-img').src=img.src;
  document.getElementById('lightbox').classList.add('active');
}
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){document.getElementById('lightbox').classList.remove('active');document.getElementById('ann-modal').classList.remove('active');document.getElementById('ann-overlay').classList.remove('active');}
});
loadContent();
</script>

<!-- annotation modal -->
<div class="annotation-modal-overlay" id="ann-overlay" onclick="this.classList.remove('active');document.getElementById('ann-modal').classList.remove('active')"></div>
<div class="annotation-modal" id="ann-modal">
  <button class="annotation-modal-close" onclick="document.getElementById('ann-modal').classList.remove('active');document.getElementById('ann-overlay').classList.remove('active')">×</button>
  <div class="annotation-modal-label" id="ann-label"></div>
  <div class="annotation-modal-content" id="ann-content"></div>
</div>
</body>
</html>
