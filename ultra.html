<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LEXICON 2741 v4.5 | Webster-Logic-Germanic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nova+Mono&family=Special+Elite&family=Fira+Code:wght@300;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --red: #ff0000;
            --black: #050505;
            --dark-grey: #121212;
            --mid-grey: #1a1a1a;
            --white: #d1d1d1;
        }
        
        body { 
            background: var(--black); 
            color: var(--white); 
            font-family: 'Nova Mono', monospace; 
            margin: 0; height: 100vh; overflow: hidden;
        }

        .app-grid {
            display: grid;
            grid-template-columns: 300px 1fr 320px;
            grid-template-rows: 50px 1fr 300px 30px;
            height: 100vh;
            gap: 1px;
            background: #222;
        }

        /* Writing Area Styling */
        #editor-container {
            grid-column: 2;
            grid-row: 3;
            background: var(--dark-grey);
            border-top: 2px solid var(--red);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        #editor {
            flex-grow: 1;
            padding: 25px;
            font-family: 'Special Elite', serif;
            font-size: 1.2rem;
            line-height: 1.6;
            outline: none;
            overflow-y: auto;
            color: #eee;
            background: #151515;
        }

        /* Dictionary & Logic Display */
        .explorer-pane {
            grid-column: 2;
            grid-row: 2;
            background: var(--black);
            overflow-y: auto;
            padding: 20px;
            border-bottom: 1px solid #333;
        }

        .section-header {
            font-size: 0.7rem;
            color: var(--red);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 20px 0 10px 0;
            border-bottom: 1px solid #333;
        }

        .webster-entry {
            background: rgba(255,255,255,0.03);
            padding: 15px;
            border-left: 4px solid var(--red);
            font-family: serif;
            font-size: 1.1rem;
            color: #ccc;
        }

        .german-entry {
            background: rgba(255, 204, 0, 0.05);
            padding: 15px;
            border-left: 4px solid #d4af37;
            font-family: 'Fira Code', monospace;
        }

        /* Sidebars */
        .sidebar { background: var(--black); padding: 15px; overflow-y: auto; }
        .sidebar-right { border-left: 1px solid #333; }

        input, button {
            background: #111;
            border: 1px solid #333;
            color: white;
            padding: 8px;
            font-family: inherit;
        }

        button:hover { background: var(--red); cursor: pointer; }

        .loading-bar {
            height: 2px;
            background: var(--red);
            width: 0%;
            transition: width 0.3s;
        }

        .word-link {
            display: block;
            padding: 5px;
            font-size: 0.8rem;
            color: #888;
            cursor: pointer;
        }
        .word-link:hover { color: var(--red); background: #111; }

        #splash-screen {
            position: fixed; inset: 0; background: black; z-index: 5000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<div id="splash-screen" onclick="this.style.display='none'">
    <h1 class="text-red-600 text-6xl font-bold italic">LEXICON_2741</h1>
    <p class="text-zinc-500 animate-pulse mt-4">LOAD DICTIONARY MATRIX [CLICK TO ENTER]</p>
</div>

<div class="app-grid">
    <!-- TOP NAV -->
    <header class="col-span-3 flex items-center justify-between px-5 border-b border-red-900 bg-black">
        <div class="flex items-center gap-4">
            <span class="text-red-600 font-bold">LX_2741_v4.5</span>
            <div id="loader-msg" class="text-[9px] text-zinc-500">SYSTEM READY</div>
        </div>
        <div id="global-progress" class="loading-bar"></div>
    </header>

    <!-- LEFT SIDEBAR -->
    <aside class="sidebar border-r border-zinc-800">
        <div class="mb-6">
            <label class="section-header block">Query Engine</label>
            <div class="flex gap-1">
                <input type="text" id="word-input" class="w-full" placeholder="Search..." onkeypress="if(event.key==='Enter') searchAll()">
                <button onclick="searchAll()">GO</button>
            </div>
        </div>

        <div>
            <label class="section-header block">Local History</label>
            <div id="history-box"></div>
        </div>
    </aside>

    <!-- CENTER TOP: EXPLORER -->
    <div class="explorer-pane">
        <div id="word-title" class="text-4xl font-bold mb-2">LEXICON</div>
        
        <div class="section-header">I. Webster's 1913 Unabridged</div>
        <div id="webster-out" class="webster-entry">Search a term to retrieve Webster's data...</div>

        <div class="section-header">II. German Logic Connection</div>
        <div id="german-out" class="german-entry">Awaiting linguistic bridge...</div>

        <div class="section-header">III. Semantic Field (Datamuse)</div>
        <div id="semantic-out" class="grid grid-cols-3 gap-2"></div>
    </div>

    <!-- CENTER BOTTOM: WRITING AREA (THE EDITOR) -->
    <div id="editor-container">
        <div class="bg-red-800 text-[10px] px-3 py-1 flex justify-between uppercase">
            <span>Manuscript Editor</span>
            <span id="word-count">0 words</span>
        </div>
        <div id="editor" contenteditable="true" spellcheck="false">
            Start writing here... Use the dictionary above to find connections.
        </div>
    </div>

    <!-- RIGHT SIDEBAR: AI & JUXTAPOSITION -->
    <aside class="sidebar sidebar-right">
        <label class="section-header block">Juxtaposition Logic</label>
        <input type="password" id="api-key" class="w-full mb-2 text-[10px]" placeholder="OpenRouter API Key">
        
        <div id="ai-console" class="text-[10px] h-64 overflow-y-auto bg-zinc-900 p-2 mb-2 text-zinc-400">
            AI Analyst standing by. Enter API key to activate philosophical synthesis.
        </div>
        
        <button onclick="getJuxtaposition()" class="w-full text-[10px] py-2 mb-2">GENERATE JUXTAPOSITION</button>
        
        <div class="mt-4">
            <button onclick="exportDoc()" class="w-full text-xs opacity-50">EXPORT LOG (.TXT)</button>
        </div>
    </aside>

    <!-- FOOTER -->
    <footer class="col-span-3 bg-black flex justify-between items-center px-4 text-[8px] text-zinc-700">
        <span>WEBSTER_JSON_LOADED // GERMAN_JSON_LOADED</span>
        <span>2025 LEXICON REAL-TIME INTERFACE</span>
    </footer>
</div>

<script>
    // Dictionary URLs
    const SOURCES = {
        webster1: "https://raw.githubusercontent.com/matthewreagan/WebstersEnglishDictionary/master/dictionary.json",
        webster2: "https://raw.githubusercontent.com/adambom/dictionary/master/dictionary.json",
        german: "https://raw.githubusercontent.com/hathibelagal/German-English-JSON-Dictionary/master/german_english.json"
    };

    let dictData = { webster: null, german: null };

    // Initialize/Load Large Dictionaries
    async function loadDicts() {
        if (dictData.webster) return; // Already loaded

        document.getElementById('loader-msg').innerText = "LOADING CORE MATRICES...";
        try {
            // Fetching Webster (Adam Bom version is usually most reliable for JS keys)
            const wRes = await fetch(SOURCES.webster2);
            dictData.webster = await wRes.json();
            
            // Fetching German
            const gRes = await fetch(SOURCES.german);
            dictData.german = await gRes.json();
            
            document.getElementById('loader-msg').innerText = "SYSTEM ONLINE";
        } catch (e) {
            document.getElementById('loader-msg').innerText = "LOAD ERROR";
            console.error(e);
        }
    }

    async function searchAll() {
        const word = document.getElementById('word-input').value.trim().toLowerCase();
        if (!word) return;

        await loadDicts();
        
        document.getElementById('word-title').innerText = word.toUpperCase();
        
        // 1. Webster Lookup
        const websterBox = document.getElementById('webster-out');
        const entry = dictData.webster[word.toUpperCase()] || dictData.webster[word];
        websterBox.innerHTML = entry ? entry : "Word not found in Webster's Unabridged.";

        // 2. German Reverse Lookup (Finding English word in German dictionary)
        const germanBox = document.getElementById('german-out');
        let germanFound = [];
        // The German JSON is usually German-to-English, so we loop to find the English value
        for (let [germanWord, englishDef] of Object.entries(dictData.german)) {
            if (englishDef.toLowerCase().includes(word)) {
                germanFound.push(`${germanWord} (${englishDef})`);
                if(germanFound.length > 2) break;
            }
        }
        germanBox.innerHTML = germanFound.length > 0 ? 
            `<strong>German Connections:</strong><br>${germanFound.join('<br>')}` : 
            "No direct German logical connection found.";

        // 3. Datamuse Semantic Field
        const semBox = document.getElementById('semantic-out');
        const semRes = await fetch(`https://api.datamuse.com/words?ml=${word}&max=9`);
        const semData = await semRes.json();
        semBox.innerHTML = semData.map(w => `<div class="word-link" onclick="quickSearch('${w.word}')">${w.word}</div>`).join('');

        addToHistory(word);
    }

    function quickSearch(w) {
        document.getElementById('word-input').value = w;
        searchAll();
    }

    function addToHistory(w) {
        const box = document.getElementById('history-box');
        const link = document.createElement('div');
        link.className = "word-link";
        link.innerText = `> ${w.toUpperCase()}`;
        link.onclick = () => quickSearch(w);
        box.prepend(link);
    }

    // AI Juxtaposition
    async function getJuxtaposition() {
        const key = document.getElementById('api-key').value;
        const currentWord = document.getElementById('word-title').innerText;
        if (!key) return alert("Enter API Key");

        const consoleBox = document.getElementById('ai-console');
        consoleBox.innerHTML += `<br>> Synthesizing ${currentWord}...`;

        try {
            const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${key}`
                },
                body: JSON.stringify({
                    model: "google/gemini-2.0-flash-001",
                    messages: [{
                        role: "system",
                        content: "You are a philosophical lexicographer. Provide a short, brutalist juxtaposition between the current word and a contrasting concept."
                    }, {
                        role: "user",
                        content: `Juxtapose: ${currentWord}`
                    }]
                })
            });
            const data = await response.json();
            const result = data.choices[0].message.content;
            consoleBox.innerHTML += `<br><span class="text-white">${result}</span>`;
            
            // Insert into Editor
            const ed = document.getElementById('editor');
            ed.innerHTML += `<p style="color:red; margin-top:10px;">${result}</p>`;
        } catch (e) {
            consoleBox.innerHTML += `<br>> AI_ERROR: Check key or connection.`;
        }
    }

    // Word Count
    document.getElementById('editor').addEventListener('input', () => {
        const text = document.getElementById('editor').innerText;
        const count = text.trim().split(/\s+/).length;
        document.getElementById('word-count').innerText = `${count} words`;
    });

    function exportDoc() {
        const text = document.getElementById('editor').innerText;
        const blob = new Blob([text], {type: "text/plain"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `lexicon_manuscript_${Date.now()}.txt`;
        a.click();
    }
</script>

</body>
</html>
